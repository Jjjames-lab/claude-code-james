import{r as y,a9 as N,j as h}from"./main-BC3yBi8Q.js";function z(x){const g=/\[(\d{1,2}:\d{2}(?::\d{2})?)\]/g;return x.replace(g,(m,v)=>{const r=v.split(":");if(r.length===2){const[l,a]=r;return`[${l}:${a}]`}else if(r.length===3){const[l,a,S]=r,c=parseInt(l);return c===0?`[${a}:${S}]`:`[${c<10?c.toString():c.toString().padStart(2,"0")}:${a}:${S}]`}else return m})}const w=({text:x,seek:g,indexAt:m=1,className:v,timeIndexMap:r})=>{const l=y.useMemo(()=>z(x),[x]),a=y.useCallback(s=>{const p=/\[(\d{1,2}:\d{2}:\d{2}|\d{2}:\d{2})\]/g,f=/\d{1,2}:\d{2}:\d{2}|\d{2}:\d{2}/,d=s.match(p)?.map(t=>t.slice(1,-1)),u=new Map(d?.map(t=>[N(t),t]).sort((t,e)=>t[0]-e[0]).map((t,e)=>[t[1],{time:t[0],index:r?r[t[1]]!==void 0?r?.[t[1]]+m:void 0:e+m}]).filter(t=>t[1].index!==void 0)),o=s.split(p).filter(t=>!!t.trim()),i=[],j=/[,.!?，。？！]/;for(let t=0;t<o.length;t++){const e=i[i.length-1];let T=u.get(o[t])?.index;if(f.test(o[t])){if(T===void 0)continue;let n;e?.type!=="time"&&e&&!j.test(e.text[e.text.length-1])&&(n=e.text[e.text.length-1],e.text=e.text.slice(0,e.text.length-1)),u.get(o[t-1])?.index,e?.type==="time"?e.data.push({time:o[t],text:`${T}`}):i.push({type:"time",data:[{time:o[t],text:`${T}`}],prefix:n})}else if(o[t]){let n=o[t].trim(),$;e&&n.length>1&&($=n[0],n=n.slice(1),e.suffix=$),i[i.length-1]?.type==="time"&&!i[i.length-1].suffix?i[i.length-1].suffix=n:i.push({type:"text",text:n})}}return i},[m,r]),c=y.useMemo(()=>a(l),[l,a]).map((s,p)=>{switch(s.type){case"text":return s.text;case"time":const f=h.jsx("span",{className:"inline-flex gap-1 mx-1 align-middle",children:s.data.map((d,u)=>d&&h.jsx("span",{onClick:()=>g(d.time),className:"text-[hsl(var(--episode-vibrant))] bg-[hsl(var(--episode-vibrant))]/25 inline-flex items-center justify-center size-5 rounded text-xs relative font-medium cursor-pointer opacity-70 hover-hover:active:scale-125 transition",children:d.text},u))});return s.prefix||s.suffix?h.jsxs("span",{className:"text-nowrap",children:[s.prefix,f,s.suffix]},p):f}});return h.jsx("div",{className:v,children:c})};export{w as T};
