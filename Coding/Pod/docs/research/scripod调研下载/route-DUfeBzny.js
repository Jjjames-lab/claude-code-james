import{bf as Es,bg as ve,j as e,c as p,aL as ss,aa as ts,r,at as je,w as De,U as le,aI as Ne,I as k,a_ as as,a8 as ce,Q as Ee,L as U,B as C,u as J,q as Te,s as Ie,v as $e,ae as ye,bh as ns,t as F,S as de,y as Ts,E as P,bi as Is,bj as $s,aV as rs,W as we,X as ke,bk as Se,Y as Ce,Z as ue,bl as Ms,bm as zs,bn as Qe,aK as Rs,aM as Os,d as is,G as os,H as ls,p as cs,bo as Ps,o as Ve,a9 as Je,bp as Ls,a$ as Fs,au as fe,bq as As,af as Hs,a4 as qs,ag as ge,br as Gs,bs as re,ah as ie,bt as oe,ab as L,aH as B,ar as Ze,a5 as Xe,bu as Bs,bv as _s,h as Ye,ay as Ws,bw as Us,O as Ks,ac as Qs}from"./main-BC3yBi8Q.js";import{u as ds}from"./useSuspenseQuery-DxWLkiby.js";import{d as Vs,Q as Js,O as Zs,u as Xs}from"./oauth-connect-button-DvujzzwP.js";import{g as Ys}from"./list-COLvY6D9.js";import{S as us}from"./suspense-fade-C0sNl5C8.js";const et={normal:(n,t)=>t,multiply:(n,t)=>n*t,screen:(n,t)=>n+t-n*t,"hard-light":(n,t)=>t<.5?n*2*t:2*t*(1-n)-1,overlay:(n,t)=>n<.5?t*2*n:2*n*(1-t)-1,darken:(n,t)=>Math.min(n,t),lighten:(n,t)=>Math.max(n,t),"color-dodge":(n,t)=>n===0?0:t===1?1:Math.min(1,n/(1-t)),"color-burn":(n,t)=>n===1?1:t===0?0:1-Math.min(1,(1-n)/t),"soft-light":(n,t)=>t<.5?n-(1-2*t)*n*(1-n):n+(2*t-1)*((n<.25?((16*n-12)*n+4)*n:Math.sqrt(n))-n),difference:(n,t)=>Math.abs(n-t),exclusion:(n,t)=>n+t-2*n*t},be=(n,t="normal",d="rgb")=>{let o=typeof t=="function"?t:et[t],u=ve(d),l=Es(d).channels;return n.map(f=>{let c=u(f);return c.alpha===void 0&&(c.alpha=1),c}).reduce((f,c)=>{if(f===void 0)return c;let v=c.alpha+f.alpha*(1-c.alpha);return l.reduce((a,m)=>(m!=="alpha"&&(v===0?a[m]=0:(a[m]=c.alpha*(1-f.alpha)*c[m]+c.alpha*f.alpha*o(f[m],c[m])+(1-c.alpha)*f.alpha*f[m],a[m]=Math.max(0,Math.min(1,a[m]/v)))),a),{mode:d,alpha:v})})},st=()=>e.jsx("div",{className:"flex flex-col flex-1 animate-fade-in",children:e.jsxs("div",{role:"status",className:"animate-pulse",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full w-48 mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[330px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[300px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px]"}),e.jsx("span",{className:"sr-only",children:"Loading..."})]})}),W=({children:n,className:t,...d})=>e.jsx("div",{className:p("px-4 sm:px-8 md:px-0",t),...d,children:n}),tt=()=>e.jsxs("div",{className:"box-border py-0 md:py-12 px-0 md:px-20 lg:p-24 [--image-size:8.5rem] xl:px-32 max-w-7xl mx-auto w-full ",children:[e.jsxs("div",{role:"status",className:"md:hidden w-full animate-pulse pwa:pt-0",children:[e.jsx("div",{className:"h-[200px] pt-safe-offset-4 bg-foreground/10 box-content",children:e.jsxs(W,{className:"",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[480px] mb-4 mt-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[96px] mb-4"}),e.jsxs("div",{className:"flex mt-8",children:[e.jsx("div",{className:"size-10 rounded bg-foreground/10"}),e.jsxs("div",{className:"flex-1 ml-4 justify-center flex flex-col",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[96px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[48px]"})]})]}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px] mb-4 mt-8"})]})}),e.jsxs(W,{className:"mt-6",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full w-48 mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[330px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[300px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px]"})]})]}),e.jsxs("div",{role:"status",className:"hidden md:block w-full animate-pulse pwa:pt-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"size-(--image-size) rounded bg-foreground/10"}),e.jsxs("div",{className:"flex-1 ml-10",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[480px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[240px] mb-12"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[96px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[48px]"})]})]}),e.jsxs("div",{className:"flex mt-10 ",children:[e.jsxs("div",{className:"w-(--image-size) flex flex-col",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[96px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[48px] mb-4"})]}),e.jsxs("div",{className:"flex-1 ml-10",children:[e.jsx("div",{className:"h-2 bg-card/50 rounded-full mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full max-w-[360px] mb-4"}),e.jsx("div",{className:"h-2 bg-card/50 rounded-full w-48 mb-4"})]})]})]}),e.jsx("span",{className:"sr-only",children:"Loading..."})]}),at=({ref:n})=>{const{currentId:t,setCurrentId:d}=ss(),{scroller:o}=ts(),u=r.useMemo(()=>{if(t!==void 0)return document.getElementById(t)},[t]),l=r.useCallback((T,I)=>{const Z=window.innerHeight/2,O=I.getBoundingClientRect(),y=O.left+O.width/2,X=O.top+O.height/2,w=y-0,K=X-Z;return Math.atan2(K,w)},[]),x=r.useRef(null),[f,c]=r.useState(0),v=r.useCallback(T=>{const I=T.getBoundingClientRect(),R=window.innerHeight||document.documentElement.clientHeight;return!(I.bottom<0||I.top>R)},[]),[a,m]=r.useState(!1),{pathname:j}=je();r.useLayoutEffect(()=>{m(!1),d(void 0)},[j,d]),r.useEffect(()=>{const T=()=>{const I=!!u&&!v(u);if(setTimeout(()=>{m(I)},100),!x.current||!u)return null;const R=l(x.current,u);c(R)};return o?.addEventListener("scroll",T),T(),()=>{o?.removeEventListener("scroll",T)}},[u,v,o,a,l]);const g=De(),{audio:S,episode:h}=le()||{},z=r.useCallback(()=>{if(!h)return;if(!(j?.startsWith(`/episode/${h.id}/chapters`)||j?.startsWith(`/episode/${h.id}/transcript`))){o?.scrollTo({top:0,behavior:"smooth"});return}g.navigate({to:j,search:I=>I,hash:Ne(S.currentTime),mask:{to:j,hash:void 0},replace:!0})},[S,j,h]);return r.useImperativeHandle(n,()=>({scrollToCurrent:z}),[z]),e.jsx("div",{ref:x,onClick:z,className:p("transition-opacity duration-500 cursor-pointer absolute left-[calc(100%+0.4rem)] top-1/2 -translate-y-1/2",{"opacity-0 pointer-events-none":!a}),children:e.jsx("div",{className:"group size-5 rounded-full inline-flex items-center justify-center align-bottom",style:{transform:`rotate(${f}rad)`},children:e.jsx(k.arrow,{className:"cursor-pointer h-4 ml-0.5 stroke-primary "})})})},nt=()=>{const{debug:n}=as({from:"/episode/$eid"}),{episode:t}=ce()||{},{handleClickEnableAI:d}=ce()||{},{user:o}=Ee(),u=r.useMemo(()=>Vs(o?.emailNotifications),[o]),l=r.useMemo(()=>e.jsx("div",{className:"text-center",children:u.processingDone?e.jsxs(e.Fragment,{children:["Email notifications is on. We'll notify you when it's ready. You can manage it in the"," ",e.jsx(U,{to:"/account/settings",viewTransition:{types:["slide-left"]},children:e.jsx(C,{className:"rounded-full h-7 m-1.5",children:"Settings"})})]}):e.jsxs(e.Fragment,{children:["Email notifications is off. You can enable it in the"," ",e.jsx(U,{to:"/account/settings",viewTransition:{types:["slide-left"]},children:e.jsx(C,{className:"rounded-full h-7 m-1.5",children:"Settings"})})]})}),[u]),{openDialog:x,renderDialog:f}=J({title:"Processing Episode",children:l}),c=r.useMemo(()=>t?.ai?.isCreateByUser?e.jsx(C,{className:"ml-auto rounded-full bg-background/50! text-foreground/70!",onClick:()=>x(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k.bell,{className:"size-4"}),u.processingDone?"On":"Off"]})}):null,[x,t?.ai?.isCreateByUser]),v=r.useMemo(()=>{if(!t?.ai?.queuePosition)return null;const m=(t.ai.queuePosition+1)*8;return m<10?"10 minutes":m<30?"30 minutes":m<45?"45 minutes":m<60?"1 hour":`${Math.ceil(m/60)} hours`},[t?.ai?.queuePosition]);return r.useMemo(()=>{if(!t)return null;const{asr:m,summary:j}=t.ai||{};let g=m==="DONE"&&j==="DONE"?"DONE":[m,j].includes("PROCESSING")?"PROCESSING":[m,j].includes("FAILED")?"FAILED":[m,j].includes("ABORTED")?"ABORTED":[m,j].includes("PENDING")?"PENDING":"";return g==="PENDING"&&t.ai?.queuePosition===0&&(g="PROCESSING"),e.jsxs(e.Fragment,{children:[f(),g!=="DONE"&&e.jsxs("div",{className:p("relative flex flex-wrap items-center gap-3 mt-6 md:mt-12 mx-4 sm:mx-8 px-4 md:mx-0 py-4 rounded-xl border-white font-medium","text-[hsl(var(--episode-text))]",{"bg-[hsl(var(--episode-bg-card))]":!(g==="PENDING"||g==="PROCESSING"),"bg-linear-to-r from-10% to-90% from-[hsl(var(--episode-bg-card))] via-[hsl(var(--episode-bg-card))]/60 to-[hsl(var(--episode-bg-card))]":g==="PENDING"||g==="PROCESSING","animate-text":g==="PENDING"||g==="PROCESSING"}),children:[!g&&e.jsxs(e.Fragment,{children:["Unprocessed episode, you can be the first!",e.jsx(C,{className:"group ml-auto rounded-full bg-background/50! text-foreground ring-[1px] ring-foreground/10 hover-active:ring-2 hover-active:ring-foreground/60 transition",onClick:d,children:e.jsxs("div",{className:"flex items-center gap-2 mix-blend-plus-lighter opacity-60 group-hover-active:opacity-100 transition-opacity",children:[e.jsx(k.ai,{className:"size-4"}),"Run AI Processing"]})})]}),g==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(k.ai,{className:"size-8"}),e.jsx("div",{children:t.ai?.queuePosition&&e.jsxs(e.Fragment,{children:["The episode will be ready in approximately"," ",v]})}),n&&e.jsx(C,{className:"ml-auto rounded-full",onClick:d,children:"debug AI Process"})]}),g==="PROCESSING"&&e.jsxs(e.Fragment,{children:[e.jsx(k.ai,{className:"size-8"}),"The episode is under processing. Ready in a few minutes!",c,n&&e.jsx(C,{className:"ml-auto rounded-full",onClick:d,children:"debug AI Process"})]}),g==="FAILED"&&e.jsxs(e.Fragment,{children:["There is something went wrong. We'll fix it soon!",n&&e.jsx(C,{className:"ml-auto rounded-full",onClick:d,children:"debug AI Process"})]}),g==="ABORTED"&&e.jsxs(e.Fragment,{children:["This episode seems to require access permissions and we are unable to process it.",n&&e.jsx(C,{className:"ml-auto rounded-full",onClick:d,children:"debug AI Process"})]})]}),g==="DONE"&&e.jsx(e.Fragment,{children:n&&e.jsx(C,{className:"ml-auto rounded-full",onClick:d,children:"debug AI Process"})})]})},[t,n,d,c,f,v])},rt=Ie("3d5223ec05b0a2fc20a25bca6d9c9fc0faa8df0d067933bac881461cd7e32d85"),it=Te({method:"POST"}).handler(rt);$e("/api/access/$eid")({});const ot=({children:n,className:t,enabled:d=!0})=>{const{user:o}=Ee(),{openLoginDialog:u}=ye(),{checkLogin:l}=ye(),{episode:x,refetchEpisode:f}=ce(),{quotaData:c,isLoading:v,refetch:a}=ns({episodeId:x.id,enabled:d}),m=De();r.useEffect(()=>{c?.accessingRemaining===0&&m.preloadRoute({to:"/pricing"}).catch()},[c?.accessingRemaining,m]);const j=r.useCallback(()=>{l()&&m.navigate({to:"/pricing",viewTransition:{types:["slide-left"]}})},[l,m]),g=r.useCallback(async()=>{l()&&await it({data:{episodeId:x.id,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}).then(h=>h.json()).then(h=>{h.access&&(f(),F.success("Access unlocked!"))}).catch(h=>{throw F.error(JSON.parse(h.message).message),h})},[l,x,f,a]);return d?e.jsxs("div",{ref:S=>{S&&(S.scrollTop=0)},className:p("relative max-h-screen -mt-3 pt-3 -ml-2 pl-2 md:-mr-20 md:pr-20 overflow-hidden bg-background",t),"data-masked":"true",children:[n,e.jsx("div",{className:"absolute inset-x-0 bottom-0 z-50 h-96 bg-linear-to-b from-transparent to-background px-4 sm:px-8 pt-0!",children:e.jsx("div",{className:"w-full bg-[hsl(var(--episode-vibrant))]/60 text-foreground/80 backdrop-blur-3xl shadow-[0_0_20px_rgba(0,0,0,0.2)] rounded-xl flex items-center justify-center",children:o?e.jsxs("div",{className:"flex flex-col gap-6 px-4 items-center pt-4 pb-3",children:[e.jsxs("span",{children:[e.jsx("div",{className:"inline-flex items-center gap-1",children:v?e.jsx(de,{className:"relative -bottom-0.5",size:16}):c?.accessLimit})," ","episodes for free per week,"," ",v?e.jsx(de,{className:"relative -bottom-0.5",size:16}):c?.accessingRemaining," ","left"]}),e.jsx(C,{className:"mt-1.5 rounded-full h-9 w-fit px-9 bg-foreground/80",onClick:c?.accessingRemaining===0?j:g,disabled:v,children:c?.accessingRemaining===0?"Subscribe":"Unlock"}),e.jsxs("div",{className:"flex items-center gap-2",children:["Subscribe to unlock unlimited access, and more",e.jsx(C,{className:"px-3 rounded-full h-8 w-fit gap-2 bg-foreground/80",onClick:j,children:e.jsx(k.arrowRight,{className:"size-3"})})]})]}):e.jsxs("div",{className:"flex flex-col gap-4 px-4 items-center py-10",children:[e.jsx("p",{className:"text-md font-medium mix-blend-plus-lighter",children:"Please sign in to continue"}),e.jsx(C,{className:"mx-2 rounded-full h-8 w-fit",onClick:()=>u(),children:"Sign in"})]})})})]}):e.jsx("div",{className:p(t),"data-masked":"false",children:n})},lt=Ie("5224ebf1f45bc868d56faf07773eb2cfa9693c7d024ff3ddc4da95cce79ae88b"),ct=Te({method:"GET"}).handler(lt);$e("/api/notion/databases")({});Ts({dataSourceId:P(),episodeId:P(),title:P(),date:Is(),artwork:P(),channelTitle:P(),duration:P(),url:P(),audioUrl:P()});const dt=Ie("b169faddf6dfe834765860053276aaa529fdc56429bba787da0bf8b00f42b842"),ut=Te({method:"POST"}).handler(dt);$e("/api/notion/create")({});const mt=({onSelect:n})=>{const{isConnected:t}=rs("notion"),{data:d}=ds({queryKey:["notion","dataSources"],queryFn:async()=>t?(await ct().then(u=>u.json()).catch(u=>(F.error(JSON.parse(u.message).message),null)))?.results.map(u=>{const l=u;return{id:l.id,title:l.title[0]?.plain_text||"Untitled data source"}})||[]:null});return t?e.jsx("div",{className:"space-y-2",children:e.jsxs(we,{onValueChange:n,children:[e.jsx(ke,{className:"bg-foreground/10 h-12",children:e.jsx(Se,{placeholder:"Select a data source"})}),e.jsxs(Ce,{children:[d?.length===0&&e.jsx(ue,{value:"none",disabled:!0,children:"No data sources found"}),d?.map(o=>e.jsx(ue,{value:o.id,children:o.title},o.id))]})]})}):e.jsx("div",{children:"Please sign in to Notion"})},ht=({onFinish:n,episode:t})=>{const[d,o]=r.useState(),u=r.useCallback(async f=>{await ut({data:{dataSourceId:f,episodeId:t.id,title:t.title,artwork:t.channel.image||"",date:new Date(t.pubDate),channelTitle:t.channel.title,duration:$s(t.itunesDuration||t.ai?.audioDuration),url:`https://scripod.com/episode/${t.id}`,audioUrl:t.enclosureUrl}}).then(c=>{F.success("Exported to Notion",{description:"The episode transcript has been exported to Notion"}),n?.()}).catch(c=>(F.error(JSON.parse(c.message).message),null))},[t,n]),{isConnected:l}=rs("notion"),x=r.useCallback(f=>{o(f)},[]);return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"text-md text-muted-foreground flex items-center gap-2",children:[e.jsx(k.notion,{className:"size-5"}),"Export to Notion",l&&e.jsxs(Js,{children:["If you don","'","t see your data source you want to export to, you may need to reconnect Notion with updated permissions in Settings."]})]}),e.jsx(Zs,{provider:"notion"})]}),l&&e.jsxs(r.Suspense,{fallback:e.jsx("div",{className:"h-12 animate-pulse bg-foreground/5 rounded-md flex items-center gap-2 px-4",children:e.jsx(de,{})}),children:[e.jsx(mt,{onSelect:x}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(C,{className:"h-8 ml-auto",disabled:!d,onClick:()=>d&&u(d),children:"Export"})})]})]})},pt=n=>{const t=r.useRef(null),d=r.useMemo(()=>e.jsx(ht,{episode:n,onFinish:()=>{t.current?.closeDialog()}}),[n]),o=J({title:"Export Transcript",children:d,drawerContentClassName:"pb-2",dialogContentClassName:"px-2"},[d]);return t.current=o,o},xt=n=>{const t=r.useRef(null),d=r.useMemo(()=>[{value:"en",label:"English",flag:"En"},{value:"zh-Hans",label:"简体中文",flag:"中"},{value:"zh-Hant",label:"繁體中文",flag:"繁"},{value:"ja",label:"日本語",flag:"Ja"},{value:"ko",label:"한국어",flag:"Ko"},{value:"es",label:"Español",flag:"Es"},{value:"fr",label:"Français",flag:"Fr"},{value:"de",label:"Deutsch",flag:"De"},{value:"it",label:"Italiano",flag:"It"}],[]),o=r.useMemo(()=>{const h=n.ai?.lang?.split("-")[0]||n.channel?.language?.split("-")[0];return h==="zh"?"zh-Hans":h},[n]),u=r.useCallback(()=>{const h=Ms();return!d.find(T=>T.value===h)||!o||o.split("-")[0]===h?null:h},[d,o]),l=r.useMemo(()=>d.filter(h=>h.value!==o),[d,o]),[x,f]=zs(`translateLanguage-${o}`,u()),[c,v]=r.useState(x),a=r.useCallback(()=>{c&&f(x===c?null:c)},[x,c,f]),[m,j]=r.useState(!1);r.useEffect(()=>{j(x===c&&!!x)},[x,c]);const g=r.useMemo(()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs(we,{value:o,disabled:!0,children:[e.jsx(ke,{className:"h-10 bg-background/50 border-none pl-2",chevronClassName:"hidden",children:e.jsx(Se,{})}),e.jsx(Ce,{children:e.jsx(Qe,{children:d.map(h=>e.jsxs(ue,{value:h.value,children:[e.jsx("div",{className:"size-6 mr-2 text-[12px] text-foreground/80 inline-flex items-center justify-center bg-foreground/10 rounded",children:h.flag}),e.jsx("span",{children:h.label})]},h.value))})})]}),e.jsx(k.arrowLeftRight,{className:"w-8 opacity-50"}),e.jsxs(we,{value:c||void 0,onValueChange:h=>{v(h)},children:[e.jsx(ke,{className:"h-10 bg-foreground/5 border border-foreground/5 pl-2",children:e.jsx(Se,{placeholder:"Select a language"})}),e.jsx(Ce,{children:e.jsx(Qe,{children:l.map(h=>e.jsxs(ue,{value:h.value,children:[e.jsx("div",{className:"size-6 mr-2 text-[12px] text-foreground/80 inline-flex items-center justify-center bg-foreground/10 rounded",children:h.flag}),e.jsx("span",{children:h.label})]},h.value))})})]})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs(C,{variant:"outline",className:"rounded-full h-9 border border-foreground/5",disabled:!c,onClick:()=>{a(),t.current?.closeDialog()},children:["Turn translator ",m?"off":"on"]})})]}),[a,m,o,l,c,d]),S=J({title:"Translator",children:g,drawerContentClassName:"pb-2",dialogContentClassName:"px-2"},[g]);return t.current=S,r.useMemo(()=>({...S,translateLanguage:x,translateTargetLanguage:c,enableTranslate:m}),[S,x,c,m])},ft=({children:n,fadeDuration:t=500,holdOnDuration:d=5e3,visible:o,className:u,visibleClassName:l,invisibleClassName:x,style:f})=>{const[c,v]=r.useState(o);Os(()=>{o?(m(!0),requestAnimationFrame(()=>{v(!0)})):setTimeout(()=>{v(!1),setTimeout(()=>{m(!1)},t)},d)},[d,o]);const[a,m]=r.useState(o);return a?e.jsx("div",{className:p("transition-all duration-1000",`duration-${t}`,{"opacity-0":!c,[`${l}`]:c,[`${x}`]:!c},u),style:f,children:n}):null},gt=()=>{const{headerHeightRem:n=0}=ce()||{};let{episode:t,daiDetected:d,daiStatus:o,daiAlign:u,daiProgress:l,status:x}=le()||{};const{renderDialog:f,openDialog:c}=J({render:()=>e.jsxs("div",{className:"space-y-4 text-foreground/80 leading-relaxed",children:[e.jsxs("p",{children:["This podcast uses"," ",e.jsx("strong",{className:"text-foreground",children:"dynamic ad insertion"}),", which means different listeners may hear different ads at different times."]}),e.jsx("p",{children:"When this happens, we need to realign the transcript to match the audio you're currently hearing, ensuring the text syncs perfectly with what you're listening to."}),e.jsxs("div",{className:"bg-foreground/5 rounded-lg px-4 py-2 mt-6 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2.5 bg-foreground/5 -mx-4 px-4 -mt-2 py-2",children:[e.jsx(k.infoCircle,{className:"size-4 shrink-0 opacity-60"}),e.jsx("div",{className:"text-foreground text-sm",children:"what to expect"})]}),e.jsx("div",{className:"flex items-start gap-2 mt-2 text-sm",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1 opacity-80 pl-1.5",children:[e.jsx("li",{children:"this process usually takes 10-30 seconds"}),e.jsx("li",{children:"you can continue listening during alignment"}),e.jsx("li",{children:"transcript will update automatically when ready"})]})})]})]})});return e.jsxs(e.Fragment,{children:[f(),e.jsx(ft,{visible:o==="pending",visibleClassName:p("h-8 mb-8"),invisibleClassName:"h-0 mb-0",holdOnDuration:o==="error"?5e3:2e3,style:{top:`${n+.5}rem`},className:p("box-content sticky z-10","-mx-3 sm:mx-0 rounded shadow-md shadow-background transition-all"),children:e.jsxs("div",{onClick:c,className:p("box-content cursor-pointer sticky z-10 bg-gray-600/50 text-foreground/80 backdrop-blur-2xl backdrop-saturate-200","rounded ","py-2 px-4 text-sm flex items-center gap-4",{"animate-text bg-linear-to-r from-0% from-foreground/10 via-foreground/30 to-foreground/10 to-90%":o==="pending"||o==="ready","bg-linear-to-r from-red-500/50 to-red-500/70":o==="error"}),children:[e.jsxs("div",{className:p("shrink-0 font-medium text-nowrap flex items-center text-center justify-center",{"flex-1":o!=="pending"}),children:[o==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(de,{size:16,tickWidth:2,className:"mr-3"}),"Aligning Transcript"]}),o==="ready"&&"Aligned",o==="error"&&"Syncing content failed, transcript may out of sync"]}),e.jsx("div",{className:p("flex items-center",{"w-0":o!=="pending","flex-1":o==="pending"}),children:e.jsx("div",{className:p("h-1.5 bg-background/30 rounded-full overflow-clip w-full"),children:e.jsx("div",{className:"h-full bg-foreground/60 transition-all duration-500",style:{width:`${l*100}%`}})})}),e.jsx(k.question,{className:"size-4 opacity-60 hover-active:opacity-100"})]})})]})},bt=Rs.memo(gt);function Ct(){const n=is(),{eid:t}=os({from:"/episode/$eid"}),d=n.getQueryData(["episode",t,"preview"]),o=ls({from:"/episode/$eid"});return e.jsx(us,{className:"flex flex-col flex-1 min-h-0",fallback:e.jsx(tt,{}),children:d?e.jsx(es,{}):e.jsx(cs,{promise:o.episode,children:()=>e.jsx(es,{})})})}const _=({active:n,title:t,href:d,suffix:o,onClick:u,disabled:l,rel:x})=>l?e.jsx("h2",{className:"opacity-20! relative whitespace-nowrap font-bold text-2xl uppercase cursor-pointer hover:opacity-100 transition-opacity duration-200 leading-5 mb-4",onClick:u,children:t}):e.jsx(U,{to:d,onClick:u,rel:x,children:e.jsxs("h2",{className:p("relative whitespace-nowrap font-bold text-2xl uppercase cursor-pointer hover:opacity-100 transition-opacity duration-200 leading-5 mb-4",{"opacity-50":!n}),children:[t,o]})}),es=()=>{const{episode:n}=le()||{},{user:t}=Ee(),d=De(),{debug:o}=as({from:"/episode/$eid"}),u=je().pathname;r.useEffect(()=>{const s=document.querySelector(`a[id="mobile-nav${u}"]`);if(!s)return;const i=s.parentElement,{scrollWidth:b}=i;i.scrollTo({left:s.offsetLeft+s.offsetWidth/2-i.offsetWidth/2,behavior:"smooth"})},[u]);const{eid:l}=os({from:"/episode/$eid"}),x=is(),f=r.useMemo(()=>x.getQueryData(["episode",l,"preview"]),[x,l]),c=r.useCallback(s=>{const i=s.state.data;return!(!i||!i.ai||i.ai.asr==="DONE"&&i.ai.summary==="DONE")},[]),v=ls({from:"/episode/$eid"}),{data:a,refetch:m}=ds({queryKey:["episode",l],queryFn:async()=>await Ps({data:{episodeId:l}}).then(s=>s.json()).catch(s=>{throw F.error(JSON.parse(s.message).message),s}),refetchOnMount:c,refetchOnReconnect:c,refetchOnWindowFocus:c,refetchInterval(s){const{ai:i}=s.state.data||{};if(!i)return!1;const{asr:b,summary:E}=i;return b==="PENDING"?1e3*60*3:b==="PROCESSING"||E==="PROCESSING"?1e3*60:!1},initialData:f||r.use(v.episode)});r.useEffect(()=>{f&&v.episode.then(s=>{x.setQueryData(["episode",l],s),x.removeQueries({queryKey:["episode",l,"preview"]})})},[v.episode]);const{data:j}=Ve({queryKey:["episode",l,"pins"],queryFn:async()=>await Ys({data:{episodeId:l}}).then(s=>s.json()).catch(s=>{throw F.error(JSON.parse(s.message).message),s}),enabled:!!t,refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1}),g=r.useMemo(()=>{const{asr:s,summary:i}=a.ai||{};return s==="DONE"&&i==="DONE"?"DONE":[s,i].includes("PROCESSING")?"PROCESSING":[s,i].includes("FAILED")?"FAILED":[s,i].includes("PENDING")?"PROCESSING":"UNPROCESSED"},[a]),S=r.useMemo(()=>{const{asr:s,summary:i}=a.ai||{};return i==="DONE"&&s==="DONE"},[a]),{daiAlign:h,audioDuration:z}=le({episode:a})||{},T=r.useMemo(()=>h?a.ai?.outline.map(s=>{if(typeof s=="string")return s;const i=h.aToB(Je(s.time));return i>(z||1/0)?null:{...s,time:Ne(i)}}).filter(s=>!!s):a.ai?.outline,[a.ai?.outline,h,z]),I=r.useMemo(()=>h?a.ai?.highlights?.map(s=>{const i=h.aToB(Je(s.time));return i>(z||1/0)?null:{...s,time:Ne(i)}}).filter(s=>!!s):a.ai?.highlights,[a.ai?.highlights,h,z]),R=r.useMemo(()=>[{nav:"shownote",title:"Overview",Component:_,href:`/episode/${l}`,rel:"canonical"},{nav:"shownote",title:"Shownote",Component:_,href:`/episode/${l}/shownote`},{nav:"summary",title:"Highlights",Component:_,href:`/episode/${l}/summary`,disabled:g!=="DONE"},{nav:"transcript",title:"Transcript",Component:_,href:`/episode/${l}/transcript`,disabled:g!=="DONE"},{nav:"chapters",title:"Chapters",Component:_,href:`/episode/${l}/chapters`,disabled:g!=="DONE"},{nav:"pins",title:j?.length?e.jsxs("div",{className:"flex gap-1 md:gap-1.5 items-top md:flex-row-reverse",children:["Pins",e.jsx("div",{className:"tracking-normal top-0 text-xs md:text-sm font-bold bg-foreground h-4 min-w-4 md:h-5 md:min-w-5 text-background rounded flex items-center justify-center",children:j.length})]}):"Pins",Component:_,href:`/episode/${l}/pins`,disabled:g!=="DONE"}],[l,j,g]),{hash:Z}=je(),O=r.useMemo(()=>!!Z,[Z]),[y,X]=r.useState(O),[w,K]=r.useState(O),[Me,ze]=r.useState(!w),Re=r.useRef(null),Oe=Ls(),[Pe,Le]=r.useState(O?0:1),Y=Fs(),{isMaxMd:me}=fe("md","max"),{isMd:ee}=fe("md"),{isLg:Fe}=fe("lg"),Ae=r.useCallback(()=>{if(me){const s=!Y&&!ee?4:0;return(6.5+(pe.current?.offsetHeight||0)/16+s)*16}return Fe?200:144},[me,Y,ee,Fe]),{scrollTo:he,scroller:$}=ts(),se=r.useCallback(()=>Math.min($?.scrollTop||0,Ae()),[Ae,$]);As(async({scrollYRem:s})=>{const i=(E,H,Ds)=>1-Math.min(Math.max((Ds-E)/(H-E),0),1);let b=0;switch(Oe){case"sm":case"md":case"lg":b=3;break;default:b=6}if(s>b?X(!0):X(!1),me){const E=!Y&&!ee?4:0,H=8.2+E;s>H?K(!0):K(!1),s>H*3?ze(!1):ze(!0),Le(i(E,H,s))}else K(!1),Le(1)},[Oe]);const N=Hs(a.channel.image),ms=r.useMemo(()=>typeof window<"u"?parseInt(window.getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-top")||"0"):0,[]),He=0+(ee?3:4.375)+ms/16,{currentId:hs}=ss(),pe=r.useRef(null),{renderDialog:ps,openDialog:xs}=pt(a),{renderDialog:fs,openDialog:xe,translateLanguage:te,enableTranslate:D}=xt(a),{renderActionSheet:gs,openActionSheet:Q}=Xs({actions:[{label:a.user?.fav?"Remove from favorites":"Add to favorites",action:()=>{V()&&a&&(async()=>{const{ok:s}=await qs({data:{episodeId:a.id,type:"fav",fav:!a.user?.fav}});s&&(x.setQueryData(["episode",l],i=>({...i,user:{...i.user,fav:!i.user?.fav}})),F(a.user?.fav?"Episode unfaved":"Episode faved"))})()}},{label:"Translator",action:()=>{V()&&xe()}},{label:"Export Transcript",visible:g==="DONE",action:()=>{V()&&xs()}},{label:"Share Episode",render:()=>e.jsxs("div",{className:"w-full flex items-center justify-between",onClick:()=>{if(!a)return;const s=location.origin+location.pathname+"?utm_source=share";navigator.share({title:a.channel.title,url:s})},children:[e.jsx("span",{className:"shrink-0 mr-4",children:"Share Episode"}),e.jsx("span",{className:"min-w-0 flex-1 rounded-full text-right opacity-50 font-normal text-nowrap text-ellipsis overflow-hidden",children:a.title})]})}]},[l,a,u]),qe=r.useMemo(()=>{if(!N)return"";const s=ge(`hsl(${N.backgroundMuted})`);s.c>.03&&(s.c=.03);const i=Gs(s);return`${i.r*255},${i.g*255},${i.b*255}`},[N]),A=r.useMemo(()=>{if(!N)return;const s=ge(`hsl(${N.backgroundMuted})`);return s.l=.18,s.c>.02&&(s.c=.02),re(ie(s))},[N]),bs=r.useMemo(()=>{if(!A||!N)return;const s=ve("rgb"),i=s(oe(`hsl(${A})`)),b=s(oe(`hsl(${N.vibrantSafe})`)),E=be([`rgba(${i.r*255},${i.g*255},${i.b*255},1)`,`rgba(${b.r*255},${b.g*255},${b.b*255},0.07)`]);return re(ie(E))},[N,A]),ae=r.useMemo(()=>{if(!A||!N)return;const s=ve("rgb"),i=s(oe(`hsl(${A})`)),b=s(oe(`hsl(${N.vibrantSafe})`)),E=be([`rgba(${i.r*255},${i.g*255},${i.b*255},1)`,`rgba(${b.r*255},${b.g*255},${b.b*255},0.25)`]);return re(ie(E))},[N,A]),ne=r.useCallback(async s=>{if(s.disabled)return;if(s.href===u){Be.current?.scrollToCurrent();return}const i=se();await d.navigate({to:s.href}),$?.scrollTo({top:i,behavior:"instant"})},[se,$,u,n,l]),{data:M}=Ve({queryKey:["episode",a.id,"translate",te,"title"],queryFn:async()=>{const i=(await Qs([a.title],void 0,te))?.map(b=>{const E=b.detectedLanguage?.language,H=b.translations[0].to;if(E!==H)return b.translations[0].text});if(i)return i[0]},enabled:D,staleTime:"static"}),{renderDialog:vs,openDialog:Ge}=J({children:e.jsxs("div",{className:"text-xl  ",children:[e.jsx("h1",{children:L.spacingText(a.title)}),D&&M&&e.jsx("h1",{className:p("opacity-50 mt-2"),children:L.spacingText(M)})]})},[a.title,M,D]),q=r.useCallback(()=>{w||y||Ge()},[Ge,w,y]),js=r.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:p("max-md:hidden sticky h-16 z-50 -mt-1 mb-1 overflow-hidden top-0",{"cursor-n-resize h-12 mb-5":y}),onClick:()=>{$?.scrollTo({behavior:"smooth",top:0})},children:[e.jsx("h1",{children:e.jsx(B,{className:p("text-2xl transition-transform origin-top-left",{"w-full":!y,"scale-75 w-[calc(4/3*100%)] translate-y-[0.7rem]":y}),clamp:y||D?1:2,cacheKey:`episode-layout-title-desktop:${a.id}`,onClickIfTruncated:q,ellipsis:!0,children:L.spacingText(a.title)})}),e.jsx("h1",{children:D&&!y&&e.jsx(B,{className:p("text-2xl opacity-50"),clamp:1,cacheKey:`episode-layout-title-desktop-translate:${a.id}`,onClickIfTruncated:q,ellipsis:!0,children:M?L.spacingText(M):""})})]}),e.jsx("div",{className:p("max-md:hidden flex flex-col h-(--image-size) -mt-16"),children:e.jsxs("div",{className:"flex mt-auto ",children:[e.jsxs("div",{className:"min-w-0 mr-32",children:[e.jsxs(U,{className:"text-[hsl(var(--episode-vibrant))] flex hover:opacity-80 transition-colors items-center",to:"/channel/$cid",params:{cid:a.channel.id},viewTransition:{types:["slide-left"]},children:[e.jsx("h3",{className:"text-xl text-ellipsis truncate mr-2",children:e.jsx(B,{clamp:1,cacheKey:`episode-layout-desktop-channel-title:${a.id}`,children:a.channel.title})}),e.jsx(k.arrow,{className:"h-4 stroke-current"})]}),e.jsx("div",{className:"text-sm opacity-50 mt-2 uppercase font-medium leading-none mb-[-2px]",children:Ze(new Date(a.pubDate))})]}),e.jsx("div",{className:"shrink-0 ml-auto mt-1",children:e.jsx(Xe,{className:"text-[hsl(var(--episode-vibrant))] sm:[--inline-progress:none] sm:[--bottom-progress:block] [--progress-height:6px] sm:[--progress-margin-top-hidden:-14px] sm:[--progress-margin-top-shown:10px]",episode:a})})]})})]}),[a,y,$,D,M,q]),Be=r.useRef(null),Ns=r.useMemo(()=>{if(!N)return;const s=ge(be([`hsl(${N.backgroundMuted})`,"rgba(255,255,255,0.8)"]));return re(ie(s))},[N]);r.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx("title",{children:a.title?`${a.title} | Scripod`:"Scripod"}),e.jsx("meta",{name:"description",content:a.channel.title||"Scripod"}),e.jsx("meta",{property:"og:title",content:a.title?`${a.title} | Scripod`:"Scripod"}),e.jsx("meta",{property:"og:description",content:a.channel.title||"Scripod"}),e.jsx("meta",{property:"og:image",content:Bs(a.channel.image||"")}),e.jsx("meta",{property:"og:audio",content:a.enclosureUrl})]}),[a]);const{checkLogin:V}=ye(),{openDialog:_e,closeDialog:ys,renderDialog:ws}=_s({episodeId:l,onAfterSubmit:async()=>{await m(),ys()}}),G=r.useCallback(()=>{!l||!V()||_e()},[l,V,_e]),ks=r.useMemo(()=>({episode:a,outlineWithDai:T,highlightsWithDai:I,palette:N,isTitleSticky:y,headerHeightRem:He,enableTranslate:D,translateLanguage:te,handleClickEnableAI:G,scrollTo:he,aiStatus:g,aiReady:S,refetchEpisode:async()=>{await m()},getRouteChangeScrollTop:se}),[a,T,I,N,y,He,D,te,G,he,g,S,m,se]),Ss=r.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 z-50 h-0 flex",children:e.jsx(W,{className:p("pl-0! ml-auto flex items-center h-18 group cursor-pointer transition-opacity duration-500",{"opacity-0 pointer-events-none":!w}),onClick:Q,children:e.jsx("div",{className:"size-9 border border-foreground/15 bg-foreground/10 backdrop-blur-sm group-hover-active:bg-foreground/30 rounded-full flex items-center justify-center transition",children:e.jsx(k.ellipsisHorizontal,{className:"size-4 text-foreground/70"})})})}),e.jsxs("div",{className:p("md:hidden sticky h-0 top-0 z-30"),children:[e.jsx("div",{className:p("absolute top-0 pointer-events-none w-full h-24 bg-linear-to-b from-[hsl(var(--episode-bg-75))] to-[hsl(var(--episode-bg-75))]/0")}),e.jsxs(W,{className:p("overflow-hidden box-content pt-safe-offset-2 z-10 will-change-[height]",{"h-8":w}),onClick:()=>{$?.scrollTo({behavior:"smooth",top:0})},children:[e.jsx("div",{className:p("flex relative text-xl font-bold",{"pr-8":w}),children:e.jsx(B,{clamp:w?1:2,cacheKey:`episdoe-layout-mobile-title:${a.id}`,onClickIfTruncated:q,children:e.jsx("h1",{children:L.spacingText(a.title)})})}),D&&!w&&M&&e.jsx("h1",{className:p("text-xl font-bold opacity-50"),children:e.jsx(B,{clamp:w?1:2,cacheKey:`episdoe-layout-mobile-title-translate:${a.id}`,onClickIfTruncated:q,children:L.spacingText(M)})})]})]}),e.jsxs("div",{className:p("sticky z-20 md:hidden will-change-[overflow] pb-[3.7rem]"),style:{top:`${-6.3-(pe.current?.offsetHeight||0)/16}rem`},children:[e.jsx("div",{className:"absolute inset-0 shadow-[inset_0_-0.5px_0_rgba(255,255,255,0.1)] bg-linear-to-b from-[hsl(var(--episode-bg-75))] to-[hsl(var(--episode-bg-50))]/70 backdrop-blur-3xl",children:e.jsx("div",{className:"absolute h-full w-full left-0 top-1/2 overflow-clip pointer-events-none",children:e.jsx("div",{className:"absolute w-full h-1/2 top-0 left-0",style:{boxShadow:w?"":`0 0 100px rgba(${qe},0.8)`}})})}),e.jsxs(W,{className:p("flex flex-col pt-safe-offset-2 transition-opacity"),children:[e.jsxs("div",{ref:pe,className:"invisible",children:[e.jsx("h1",{className:p("text-xl font-bold line-clamp-2"),children:L.spacingText(a.title)}),D&&M&&e.jsx("h1",{className:p("text-xl font-bold opacity-50 line-clamp-2"),children:L.spacingText(M)})]}),e.jsxs("div",{className:p("flex mt-6 will-change-[opacity]",{"pointer-events-none opacity-0":w,"opacity-100":!w}),style:{opacity:Pe},children:[e.jsx(Ye,{className:p("h-20 max-w-40 min-w-0 rounded mt-auto mr-4 shrink-0"),src:a.itunesImage||a.channel.image||"",fallbackSrc:a.channel.image,ref:Re,alt:a.channel.title}),e.jsxs("div",{className:"flex flex-1 flex-col min-w-0",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"min-w-0 mr-10",children:[e.jsxs(U,{className:"text-[hsl(var(--episode-vibrant))] flex items-center hover-active:opacity-80 transition-colors cursor-pointer",to:`/channel/${a.channel.id}`,viewTransition:{types:["slide-left"]},children:[e.jsx("h3",{className:"text-base min-w-0 text-nowrap",children:e.jsx(B,{clamp:1,cacheKey:`episode-layout-mobile-channel-title:${a.id}`,children:a.channel.title})}),e.jsx(Ws,{className:"size-5 align-bottom shrink-0"})]}),e.jsx("div",{className:"text-sm mt-1.5 opacity-50 uppercase font-medium leading-none -mb-px",children:Ze(new Date(a.pubDate))})]}),e.jsx("div",{className:"shrink-0 size-9 ml-auto border border-foreground/15 bg-foreground/10 backdrop-blur-sm hover-active:bg-foreground/30 rounded-full flex items-center justify-center transition",onClick:Q,children:e.jsx(k.ellipsisHorizontal,{className:"size-4 text-foreground/70"})})]}),e.jsx("div",{className:"text-[hsl(var(--episode-vibrant))] mt-auto flex items-center justify-between",children:e.jsx(Xe,{className:"ml-auto",episode:a})})]})]})]})]}),e.jsxs("div",{className:p("md:hidden sticky z-40 top-2.5 -mt-15 overflow-scroll text-nowrap whitespace-nowrap will-change-scroll no-scrollbar snap-x snap-mandatory px-4 sm:px-8",w&&"mask-[linear-gradient(to_right,black,black_calc(100%-4.5rem),transparent_calc(100%-2rem))]"),children:[R.map((s,i)=>s.disabled?e.jsx("div",{onClick:a.ai?void 0:G,className:"snap-center mr-4 opacity-20 will-change-[opacity] nav transition inline-block uppercase pb-3 pt-8 font-bold text-base cursor-pointer duration-300 leading-none",children:s.title},i):e.jsx(U,{id:`mobile-nav${s.href}`,to:s.href,...s.rel?{rel:s.rel}:void 0,className:p("snap-center mr-4 will-change-[opacity] nav transition hover:opacity-80 inline-block uppercase pb-3 pt-8 font-bold text-base cursor-pointer duration-300 leading-none",{"opacity-50":u!==s.href,"cursor-not-allowed":s.disabled}),onClick:b=>{b.preventDefault(),ne(s)},children:s.title},i)),e.jsx("span",{className:"inline-block w-20 shrink-0"})]})]}),[a,w,R,hs,l,n,$,he,Pe,u,Q,qe,G,ne,D,M,q]),Cs=r.useMemo(()=>e.jsxs("div",{className:"max-md:hidden w-(--image-size) xl:-ml-40 select-none relative z-30",children:[e.jsx("div",{className:"size-(--image-size) top-0 sticky z-50 pointer-events-none",children:e.jsx("div",{className:"h-full w-[200%] absolute right-0",children:e.jsx(Ye,{alt:a.title,className:p("h-(--image-size) origin-top-right transition absolute right-0 pointer-events-auto",{"scale-[0.3529411765]":y,"rounded-none cursor-n-resize":y,"rounded-sm":!y}),onClick:()=>{$?.scrollTo({behavior:"smooth",top:0})},src:a.itunesImage||a.channel.image||"",fallbackSrc:a.channel.image,ref:Re})})}),e.jsxs("div",{className:p("mt-12 w-(--image-size) flex flex-col items-end tracking-widest sticky top-20"),children:[R.map((s,i)=>e.jsx("div",{className:"mb-2",children:e.jsx(s.Component,{active:u===s.href,title:s.title,href:s.href,disabled:s.disabled,...s.rel?{rel:s.rel}:void 0,onClick:b=>{if(b.preventDefault(),s.disabled&&!a.ai){G?.();return}ne(s)},suffix:u===s.href?e.jsx(at,{ref:Be}):void 0})},i)),e.jsx("div",{className:"",children:e.jsx("div",{className:"size-9 flex items-center justify-center border bg-foreground/10 backdrop-blur-sm border-foreground/20 rounded-full cursor-pointer hover-active:bg-foreground/15 transition",onClick:s=>{Q()},children:e.jsx(k.ellipsisHorizontal,{className:"size-5"})})}),D&&e.jsxs("div",{onClick:()=>{xe()},className:"h-9 px-2 gap-1 flex items-center justify-center mt-5 border bg-foreground/10  border-foreground/20 rounded-full cursor-pointer hover-active:bg-foreground/15 backdrop-blur-sm transition",children:[e.jsx(k.translate,{className:"size-5"}),e.jsx("div",{className:"text-xs",children:"Translator"})]})]})]}),[y,a,R,$,u,G,D,ne,Q,xe]),{quotaData:We,isFetching:Ue}=ns({episodeId:l}),Ke=r.useMemo(()=>{if(u?.endsWith("/transcript")||u?.endsWith("/chapters")){if(!t)return!0;if(Ue)return!1;if(!We?.episodeAccessAllowed)return!0}return!1},[u,t,We,Ue]);return r.useEffect(()=>{if(ae)return document.documentElement.style.setProperty("background",`hsl(${ae})`),()=>{document.documentElement.style.removeProperty("background")}},[ae]),e.jsxs(Us.Provider,{value:ks,children:[e.jsx("title",{children:a.title?`${a.title} | Scripod`:"Scripod"}),ws(),ps(),fs(),gs(),vs(),e.jsxs("main",{className:p("[--image-size:8.5rem] bg-background flex flex-col flex-1",Ke?"min-h-[720px]":"min-h-auto","before:[block] md:before:content-none vt:before:hidden before:h-1/2 before:w-[calc(100%-var(--scrollbar-width))] before:bg-[hsl(var(--episode-bg-75))] before:absolute before:top-0 before:left-0 before:-z-1","before:content-none",Me&&"max-md:before:content-['']"),style:{"--episode-vibrant":N?.vibrantSafe,"--episode-bg-card":N?.backgroundCard,"--episode-bg":N?.backgroundMuted,"--episode-bg-25":A,"--episode-bg-50":bs,"--episode-bg-75":ae,"--episode-text":N?.text,"--episode-vibrant-secondary":Ns,"--theme-blend-mode":N?.cardTheme==="dark"?"plus-lighter":"plus-darker"},children:[e.jsx("div",{className:p("max-md:hidden h-0 w-full shrink-0 sticky top-0 z-30"),children:e.jsx("div",{className:p("w-full absolute h-12 bg-background/50 backdrop-blur-3xl backdrop-saturate-200 box-content border-b-[0.5px] border-primary/0 transition duration-500",{"cursor-n-resize border-primary/20":y}),onClick:()=>{y&&$?.scrollTo({behavior:"smooth",top:0})}})}),e.jsx("div",{className:"flex flex-col flex-1 min-h-0 items-center justify-between py-0 md:py-12 px-0 md:pl-18 md:pr-8 lg:p-24 xl:px-32 max-w-5xl mx-auto w-full pb-0!",children:e.jsxs("div",{className:"w-full flex flex-1 gap-10",children:[Cs,e.jsxs("div",{className:"min-w-0 flex-1 flex flex-col min-h-0",children:[js,Ss,e.jsx(nt,{}),e.jsx(W,{className:p("md:mt-12 bg-background"),children:e.jsxs(us,{className:"max-md:pt-6 pb-safe-offset-64 min-h-[calc(100vh-4rem)] md:min-h-[calc(100vh-9rem)]",fallback:e.jsx(st,{}),children:[u?.endsWith("/transcript")&&a.id===n?.id&&e.jsx(bt,{}),e.jsx(cs,{promise:v.episode,children:()=>e.jsx(e.Fragment,{children:e.jsx(ot,{enabled:Ke,children:e.jsx(Ks,{})})})})]},u)})]})]})})]})]})};export{Ct as component};
