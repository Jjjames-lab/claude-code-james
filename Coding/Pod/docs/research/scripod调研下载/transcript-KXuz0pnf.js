const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/snapdom-Djw2CRx0.js","assets/main-BC3yBi8Q.js","assets/main-whlr5EYK.css"])))=>i.map(i=>d[i]);
import{aK as U,r as u,j as N,c as Oe,aI as wn,bx as Fe,aM as Mt,aN as eo,aO as to,aP as no,aQ as ro,aR as oo,by as so,B as _e,bz as io,bA as ao,I as sn,bB as lo,u as co,af as hr,aY as uo,h as fo,w as ho,G as go,a8 as xn,d as mo,t as po,U as vo,ag as dt,aa as bo,at as yo,a9 as Sn,aL as wo,ah as Cn}from"./main-BC3yBi8Q.js";import{a as At,g as xo,s as So,S as Co}from"./splitIntoParagraphs-C7o5RN-7.js";import{u as Eo}from"./useSuspenseQuery-DxWLkiby.js";import{S as Ro}from"./switch-DFkDWCBS.js";import{u as Do}from"./useAsync-CF3boK0R.js";import"./text-fit-DbHj2sFO.js";import"./list-COLvY6D9.js";const gr=U.forwardRef(({id:e,segment:t,audio:n,seek:r,sentenceIndex:o,daiDetected:s,daiAlign:i,segmentIndex:a,selectingMode:l},c)=>{const d=u.useRef(null);u.useImperativeHandle(c,()=>d.current);const h=o!==void 0,{from:m,to:f}=u.useMemo(()=>{let S=t.sentences[0].start;const R=t.sentences[0].end;return{from:S,to:R}},[t]),b=s&&!i,[y,E]=u.useState(0);return u.useEffect(()=>{if(!h||b){E(0);return}if(h){const S=R=>{let v=((R?.detail.currentTime||n.currentTime)-m)/(f-m);v<0?v=0:v>1&&(v=1),E(v)};return S(),n.addEventListener("customUpdate",S),()=>{n.removeEventListener("customUpdate",S)}}},[h,n,m,f,b]),f-m<8||l?null:N.jsxs("div",{id:e,ref:d,className:Oe("relative cursor-pointer hover-hover:hover:bg-foreground/5 active:bg-foreground/10 shadow-[inset_0_0_0_2px_hsla(0_0_10%)] flex flex-col justify-center -mx-3 sm:mx-0 px-3 py-3 sm:px-8 text-sm rounded-md overflow-clip transition-all",{"shadow-[inset_0_0_0_3px_hsla(0_0_15%)] border-foreground/20":h,"mt-8":a!==0}),onClick:()=>{r({start:t.sentences[0].start,end:t.sentences[0].end,segmentIndex:a,sentenceIndex:0},!0)},children:[N.jsx("div",{className:Oe("absolute h-full left-0 top-0 bg-foreground/10 transition-opacity",{"opacity-0":!h}),style:{width:`${y*100}%`}}),N.jsxs("div",{className:Oe("mix-blend-difference text-foreground/30",h&&"text-foreground/50"),children:["Dynamic Content   ",wn(m)," - ",wn(f)]})]})});gr.displayName="SegmentDynamic";const Io=U.memo(gr);function No(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const St=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ke(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function un(e){return"nodeType"in e}function te(e){var t,n;return e?Ke(e)?e:un(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function dn(e){const{Document:t}=te(e);return e instanceof t}function ot(e){return Ke(e)?!1:e instanceof te(e).HTMLElement}function mr(e){return e instanceof te(e).SVGElement}function Ve(e){return e?Ke(e)?e.document:un(e)?dn(e)?e:ot(e)||mr(e)?e.ownerDocument:document:document:document}const be=St?u.useLayoutEffect:u.useEffect;function Ct(e){const t=u.useRef(e);return be(()=>{t.current=e}),u.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Mo(){const e=u.useRef(null),t=u.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=u.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function nt(e,t){t===void 0&&(t=[e]);const n=u.useRef(e);return be(()=>{n.current!==e&&(n.current=e)},t),n}function st(e,t){const n=u.useRef();return u.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function pt(e){const t=Ct(e),n=u.useRef(null),r=u.useCallback(o=>{o!==n.current&&t?.(o,n.current),n.current=o},[]);return[n,r]}function vt(e){const t=u.useRef();return u.useEffect(()=>{t.current=e},[e]),t.current}let Tt={};function it(e,t){return u.useMemo(()=>{if(t)return t;const n=Tt[e]==null?0:Tt[e]+1;return Tt[e]=n,e+"-"+n},[e,t])}function pr(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((s,i)=>{const a=Object.entries(i);for(const[l,c]of a){const d=s[l];d!=null&&(s[l]=d+e*c)}return s},{...t})}}const He=pr(1),bt=pr(-1);function Ao(e){return"clientX"in e&&"clientY"in e}function Et(e){if(!e)return!1;const{KeyboardEvent:t}=te(e.target);return t&&e instanceof t}function To(e){if(!e)return!1;const{TouchEvent:t}=te(e.target);return t&&e instanceof t}function yt(e){if(To(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Ao(e)?{x:e.clientX,y:e.clientY}:null}const je=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[je.Translate.toString(e),je.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),En="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ko(e){return e.matches(En)?e:e.querySelector(En)}const Bo={display:"none"};function Lo(e){let{id:t,value:n}=e;return U.createElement("div",{id:t,style:Bo},n)}function Po(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return U.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function Oo(){const[e,t]=u.useState("");return{announce:u.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const vr=u.createContext(null);function jo(e){const t=u.useContext(vr);u.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Fo(){const[e]=u.useState(()=>new Set),t=u.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[u.useCallback(r=>{let{type:o,event:s}=r;e.forEach(i=>{var a;return(a=i[o])==null?void 0:a.call(i,s)})},[e]),t]}const _o={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Uo={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function zo(e){let{announcements:t=Uo,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=_o}=e;const{announce:s,announcement:i}=Oo(),a=it("DndLiveRegion"),[l,c]=u.useState(!1);if(u.useEffect(()=>{c(!0)},[]),jo(u.useMemo(()=>({onDragStart(h){let{active:m}=h;s(t.onDragStart({active:m}))},onDragMove(h){let{active:m,over:f}=h;t.onDragMove&&s(t.onDragMove({active:m,over:f}))},onDragOver(h){let{active:m,over:f}=h;s(t.onDragOver({active:m,over:f}))},onDragEnd(h){let{active:m,over:f}=h;s(t.onDragEnd({active:m,over:f}))},onDragCancel(h){let{active:m,over:f}=h;s(t.onDragCancel({active:m,over:f}))}}),[s,t])),!l)return null;const d=U.createElement(U.Fragment,null,U.createElement(Lo,{id:r,value:o.draggable}),U.createElement(Po,{id:a,announcement:i}));return n?Fe.createPortal(d,n):d}var K;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(K||(K={}));function wt(){}function Rn(e,t){return u.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function qo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const ye=Object.freeze({x:0,y:0});function $o(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ho(e,t){const n=yt(e);if(!n)return"0 0";const r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}function Ko(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Vo(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Yo(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Dn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Jo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Dn(t,t.left,t.top),s=[];for(const i of r){const{id:a}=i,l=n.get(a);if(l){const c=$o(Dn(l),o);s.push({id:a,data:{droppableContainer:i,value:c}})}}return s.sort(Ko)};function Xo(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),i=o-r,a=s-n;if(r<o&&n<s){const l=t.width*t.height,c=e.width*e.height,d=i*a,h=d/(l+c-d);return Number(h.toFixed(4))}return 0}const Go=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const s of r){const{id:i}=s,a=n.get(i);if(a){const l=Xo(a,t);l>0&&o.push({id:i,data:{droppableContainer:s,value:l}})}}return o.sort(Vo)};function Wo(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function br(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ye}function Qo(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o.reduce((i,a)=>({...i,top:i.top+e*a.y,bottom:i.bottom+e*a.y,left:i.left+e*a.x,right:i.right+e*a.x}),{...n})}}const Zo=Qo(1);function yr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function es(e,t,n){const r=yr(t);if(!r)return e;const{scaleX:o,scaleY:s,x:i,y:a}=r,l=e.left-i-(1-o)*parseFloat(n),c=e.top-a-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),d=o?e.width/o:e.width,h=s?e.height/s:e.height;return{width:d,height:h,top:c,right:l+d,bottom:c+h,left:l}}const ts={ignoreTransform:!1};function Ye(e,t){t===void 0&&(t=ts);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:c,transformOrigin:d}=te(e).getComputedStyle(e);c&&(n=es(n,c,d))}const{top:r,left:o,width:s,height:i,bottom:a,right:l}=n;return{top:r,left:o,width:s,height:i,bottom:a,right:l}}function In(e){return Ye(e,{ignoreTransform:!0})}function ns(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function rs(e,t){return t===void 0&&(t=te(e).getComputedStyle(e)),t.position==="fixed"}function os(e,t){t===void 0&&(t=te(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const s=t[o];return typeof s=="string"?n.test(s):!1})}function fn(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(dn(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!ot(o)||mr(o)||n.includes(o))return n;const s=te(e).getComputedStyle(o);return o!==e&&os(o,s)&&n.push(o),rs(o,s)?n:r(o.parentNode)}return e?r(e):n}function wr(e){const[t]=fn(e,1);return t??null}function kt(e){return!St||!e?null:Ke(e)?e:un(e)?dn(e)||e===Ve(e).scrollingElement?window:ot(e)?e:null:null}function xr(e){return Ke(e)?e.scrollX:e.scrollLeft}function Sr(e){return Ke(e)?e.scrollY:e.scrollTop}function an(e){return{x:xr(e),y:Sr(e)}}var Y;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Y||(Y={}));function Cr(e){return!St||!e?!1:e===document.scrollingElement}function Er(e){const t={x:0,y:0},n=Cr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,i=e.scrollTop>=r.y,a=e.scrollLeft>=r.x;return{isTop:o,isLeft:s,isBottom:i,isRight:a,maxScroll:r,minScroll:t}}const ss={x:.2,y:.2};function is(e,t,n,r,o){let{top:s,left:i,right:a,bottom:l}=n;r===void 0&&(r=10),o===void 0&&(o=ss);const{isTop:c,isBottom:d,isLeft:h,isRight:m}=Er(e),f={x:0,y:0},b={x:0,y:0},y={height:t.height*o.y,width:t.width*o.x};return!c&&s<=t.top+y.height?(f.y=Y.Backward,b.y=r*Math.abs((t.top+y.height-s)/y.height)):!d&&l>=t.bottom-y.height&&(f.y=Y.Forward,b.y=r*Math.abs((t.bottom-y.height-l)/y.height)),!m&&a>=t.right-y.width?(f.x=Y.Forward,b.x=r*Math.abs((t.right-y.width-a)/y.width)):!h&&i<=t.left+y.width&&(f.x=Y.Backward,b.x=r*Math.abs((t.left+y.width-i)/y.width)),{direction:f,speed:b}}function as(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:i}=window;return{top:0,left:0,right:s,bottom:i,width:s,height:i}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Rr(e){return e.reduce((t,n)=>He(t,an(n)),ye)}function ls(e){return e.reduce((t,n)=>t+xr(n),0)}function cs(e){return e.reduce((t,n)=>t+Sr(n),0)}function Dr(e,t){if(t===void 0&&(t=Ye),!e)return;const{top:n,left:r,bottom:o,right:s}=t(e);wr(e)&&(o<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const us=[["x",["left","right"],ls],["y",["top","bottom"],cs]];class hn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=fn(n),o=Rr(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,i,a]of us)for(const l of i)Object.defineProperty(this,l,{get:()=>{const c=a(r),d=o[s]-c;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ze{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function ds(e){const{EventTarget:t}=te(e);return e instanceof t?e:Ve(e)}function Bt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var ge;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ge||(ge={}));function Nn(e){e.preventDefault()}function fs(e){e.stopPropagation()}var F;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(F||(F={}));const Ir={start:[F.Space,F.Enter],cancel:[F.Esc],end:[F.Space,F.Enter,F.Tab]},hs=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case F.Right:return{...n,x:n.x+25};case F.Left:return{...n,x:n.x-25};case F.Down:return{...n,y:n.y+25};case F.Up:return{...n,y:n.y-25}}};class Nr{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ze(Ve(n)),this.windowListeners=new Ze(te(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ge.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Dr(r),n(ye)}handleKeyDown(t){if(Et(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:s=Ir,coordinateGetter:i=hs,scrollBehavior:a="smooth"}=o,{code:l}=t;if(s.end.includes(l)){this.handleEnd(t);return}if(s.cancel.includes(l)){this.handleCancel(t);return}const{collisionRect:c}=r.current,d=c?{x:c.left,y:c.top}:ye;this.referenceCoordinates||(this.referenceCoordinates=d);const h=i(t,{active:n,context:r.current,currentCoordinates:d});if(h){const m=bt(h,d),f={x:0,y:0},{scrollableAncestors:b}=r.current;for(const y of b){const E=t.code,{isTop:S,isRight:R,isLeft:C,isBottom:v,maxScroll:I,minScroll:g}=Er(y),p=as(y),w={x:Math.min(E===F.Right?p.right-p.width/2:p.right,Math.max(E===F.Right?p.left:p.left+p.width/2,h.x)),y:Math.min(E===F.Down?p.bottom-p.height/2:p.bottom,Math.max(E===F.Down?p.top:p.top+p.height/2,h.y))},x=E===F.Right&&!R||E===F.Left&&!C,M=E===F.Down&&!v||E===F.Up&&!S;if(x&&w.x!==h.x){const D=y.scrollLeft+m.x,A=E===F.Right&&D<=I.x||E===F.Left&&D>=g.x;if(A&&!m.y){y.scrollTo({left:D,behavior:a});return}A?f.x=y.scrollLeft-D:f.x=E===F.Right?y.scrollLeft-I.x:y.scrollLeft-g.x,f.x&&y.scrollBy({left:-f.x,behavior:a});break}else if(M&&w.y!==h.y){const D=y.scrollTop+m.y,A=E===F.Down&&D<=I.y||E===F.Up&&D>=g.y;if(A&&!m.x){y.scrollTo({top:D,behavior:a});return}A?f.y=y.scrollTop-D:f.y=E===F.Down?y.scrollTop-I.y:y.scrollTop-g.y,f.y&&y.scrollBy({top:-f.y,behavior:a});break}}this.handleMove(t,He(bt(h,this.referenceCoordinates),f))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Nr.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Ir,onActivation:o}=t,{active:s}=n;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const a=s.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function Mn(e){return!!(e&&"distance"in e)}function An(e){return!!(e&&"delay"in e)}class gn{constructor(t,n,r){var o;r===void 0&&(r=ds(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:i}=s;this.props=t,this.events=n,this.document=Ve(i),this.documentListeners=new Ze(this.document),this.listeners=new Ze(r),this.windowListeners=new Ze(te(i)),this.initialCoordinates=(o=yt(s))!=null?o:ye,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.DragStart,Nn),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),this.windowListeners.add(ge.ContextMenu,Nn),this.documentListeners.add(ge.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(An(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Mn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(ge.Click,fs,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ge.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:s}=this,{onMove:i,options:{activationConstraint:a}}=s;if(!o)return;const l=(n=yt(t))!=null?n:ye,c=bt(o,l);if(!r&&a){if(Mn(a)){if(a.tolerance!=null&&Bt(c,a.tolerance))return this.handleCancel();if(Bt(c,a.distance))return this.handleStart()}if(An(a)&&Bt(c,a.tolerance))return this.handleCancel();this.handlePending(a,c);return}t.cancelable&&t.preventDefault(),i(l)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===F.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const gs={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Mr extends gn{constructor(t){const{event:n}=t,r=Ve(n.target);super(t,gs,r)}}Mr.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const ms={move:{name:"mousemove"},end:{name:"mouseup"}};var ln;(function(e){e[e.RightClick=2]="RightClick"})(ln||(ln={}));let Ar=class extends gn{constructor(t){super(t,ms,Ve(t.event.target))}};Ar.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===ln.RightClick?!1:(r?.({event:n}),!0)}}];const Lt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};let Tr=class extends gn{constructor(t){super(t,Lt)}static setup(){return window.addEventListener(Lt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Lt.move.name,t)};function t(){}}};Tr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r?.({event:n}),!0)}}];var et;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(et||(et={}));var xt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(xt||(xt={}));function ps(e){let{acceleration:t,activator:n=et.Pointer,canScroll:r,draggingRect:o,enabled:s,interval:i=5,order:a=xt.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:d,delta:h,threshold:m}=e;const f=bs({delta:h,disabled:!s}),[b,y]=Mo(),E=u.useRef({x:0,y:0}),S=u.useRef({x:0,y:0}),R=u.useMemo(()=>{switch(n){case et.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case et.DraggableRect:return o}},[n,o,l]),C=u.useRef(null),v=u.useCallback(()=>{const g=C.current;if(!g)return;const p=E.current.x*S.current.x,w=E.current.y*S.current.y;g.scrollBy(p,w)},[]),I=u.useMemo(()=>a===xt.TreeOrder?[...c].reverse():c,[a,c]);u.useEffect(()=>{if(!s||!c.length||!R){y();return}for(const g of I){if(r?.(g)===!1)continue;const p=c.indexOf(g),w=d[p];if(!w)continue;const{direction:x,speed:M}=is(g,w,R,t,m);for(const D of["x","y"])f[D][x[D]]||(M[D]=0,x[D]=0);if(M.x>0||M.y>0){y(),C.current=g,b(v,i),E.current=M,S.current=x;return}}E.current={x:0,y:0},S.current={x:0,y:0},y()},[t,v,r,y,s,i,JSON.stringify(R),JSON.stringify(f),b,c,I,d,JSON.stringify(m)])}const vs={x:{[Y.Backward]:!1,[Y.Forward]:!1},y:{[Y.Backward]:!1,[Y.Forward]:!1}};function bs(e){let{delta:t,disabled:n}=e;const r=vt(t);return st(o=>{if(n||!r||!o)return vs;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[Y.Backward]:o.x[Y.Backward]||s.x===-1,[Y.Forward]:o.x[Y.Forward]||s.x===1},y:{[Y.Backward]:o.y[Y.Backward]||s.y===-1,[Y.Forward]:o.y[Y.Forward]||s.y===1}}},[n,t,r])}function ys(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return st(o=>{var s;return t==null?null:(s=r??o)!=null?s:null},[r,t])}function ws(e,t){return u.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,s=o.activators.map(i=>({eventName:i.eventName,handler:t(i.handler,r)}));return[...n,...s]},[]),[e,t])}var rt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(rt||(rt={}));var cn;(function(e){e.Optimized="optimized"})(cn||(cn={}));const Tn=new Map;function xs(e,t){let{dragging:n,dependencies:r,config:o}=t;const[s,i]=u.useState(null),{frequency:a,measure:l,strategy:c}=o,d=u.useRef(e),h=E(),m=nt(h),f=u.useCallback(function(S){S===void 0&&(S=[]),!m.current&&i(R=>R===null?S:R.concat(S.filter(C=>!R.includes(C))))},[m]),b=u.useRef(null),y=st(S=>{if(h&&!n)return Tn;if(!S||S===Tn||d.current!==e||s!=null){const R=new Map;for(let C of e){if(!C)continue;if(s&&s.length>0&&!s.includes(C.id)&&C.rect.current){R.set(C.id,C.rect.current);continue}const v=C.node.current,I=v?new hn(l(v),v):null;C.rect.current=I,I&&R.set(C.id,I)}return R}return S},[e,s,n,h,l]);return u.useEffect(()=>{d.current=e},[e]),u.useEffect(()=>{h||f()},[n,h]),u.useEffect(()=>{s&&s.length>0&&i(null)},[JSON.stringify(s)]),u.useEffect(()=>{h||typeof a!="number"||b.current!==null||(b.current=setTimeout(()=>{f(),b.current=null},a))},[a,h,f,...r]),{droppableRects:y,measureDroppableContainers:f,measuringScheduled:s!=null};function E(){switch(c){case rt.Always:return!1;case rt.BeforeDragging:return n;default:return!n}}}function mn(e,t){return st(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Ss(e,t){return mn(e,t)}function Cs(e){let{callback:t,disabled:n}=e;const r=Ct(t),o=u.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(r)},[r,n]);return u.useEffect(()=>()=>o?.disconnect(),[o]),o}function Rt(e){let{callback:t,disabled:n}=e;const r=Ct(t),o=u.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(r)},[n]);return u.useEffect(()=>()=>o?.disconnect(),[o]),o}function Es(e){return new hn(Ye(e),e)}function kn(e,t,n){t===void 0&&(t=Es);const[r,o]=u.useState(null);function s(){o(l=>{if(!e)return null;if(e.isConnected===!1){var c;return(c=l??n)!=null?c:null}const d=t(e);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const i=Cs({callback(l){if(e)for(const c of l){const{type:d,target:h}=c;if(d==="childList"&&h instanceof HTMLElement&&h.contains(e)){s();break}}}}),a=Rt({callback:s});return be(()=>{s(),e?(a?.observe(e),i?.observe(document.body,{childList:!0,subtree:!0})):(a?.disconnect(),i?.disconnect())},[e]),r}function Rs(e){const t=mn(e);return br(e,t)}const Bn=[];function Ds(e){const t=u.useRef(e),n=st(r=>e?r&&r!==Bn&&e&&t.current&&e.parentNode===t.current.parentNode?r:fn(e):Bn,[e]);return u.useEffect(()=>{t.current=e},[e]),n}function Is(e){const[t,n]=u.useState(null),r=u.useRef(e),o=u.useCallback(s=>{const i=kt(s.target);i&&n(a=>a?(a.set(i,an(i)),new Map(a)):null)},[]);return u.useEffect(()=>{const s=r.current;if(e!==s){i(s);const a=e.map(l=>{const c=kt(l);return c?(c.addEventListener("scroll",o,{passive:!0}),[c,an(c)]):null}).filter(l=>l!=null);n(a.length?new Map(a):null),r.current=e}return()=>{i(e),i(s)};function i(a){a.forEach(l=>{const c=kt(l);c?.removeEventListener("scroll",o)})}},[o,e]),u.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,i)=>He(s,i),ye):Rr(e):ye,[e,t])}function Ln(e,t){t===void 0&&(t=[]);const n=u.useRef(null);return u.useEffect(()=>{n.current=null},t),u.useEffect(()=>{const r=e!==ye;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?bt(e,n.current):ye}function Ns(e){u.useEffect(()=>{if(!St)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function Ms(e,t){return u.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:s}=r;return n[o]=i=>{s(i,t)},n},{}),[e,t])}function kr(e){return u.useMemo(()=>e?ns(e):null,[e])}const Pn=[];function As(e,t){t===void 0&&(t=Ye);const[n]=e,r=kr(n?te(n):null),[o,s]=u.useState(Pn);function i(){s(()=>e.length?e.map(l=>Cr(l)?r:new hn(t(l),l)):Pn)}const a=Rt({callback:i});return be(()=>{a?.disconnect(),i(),e.forEach(l=>a?.observe(l))},[e]),o}function Br(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ot(t)?t:e}function Ts(e){let{measure:t}=e;const[n,r]=u.useState(null),o=u.useCallback(c=>{for(const{target:d}of c)if(ot(d)){r(h=>{const m=t(d);return h?{...h,width:m.width,height:m.height}:m});break}},[t]),s=Rt({callback:o}),i=u.useCallback(c=>{const d=Br(c);s?.disconnect(),d&&s?.observe(d),r(d?t(d):null)},[t,s]),[a,l]=pt(i);return u.useMemo(()=>({nodeRef:a,rect:n,setRef:l}),[n,a,l])}const ks=[{sensor:Mr,options:{}},{sensor:Nr,options:{}}],Bs={current:{}},mt={draggable:{measure:In},droppable:{measure:In,strategy:rt.WhileDragging,frequency:cn.Optimized},dragOverlay:{measure:Ye}};class tt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Ls={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new tt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:wt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:mt,measureDroppableContainers:wt,windowRect:null,measuringScheduled:!1},Lr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:wt,draggableNodes:new Map,over:null,measureDroppableContainers:wt},at=u.createContext(Lr),Pr=u.createContext(Ls);function Ps(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new tt}}}function Os(e,t){switch(t.type){case K.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case K.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case K.DragEnd:case K.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case K.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new tt(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case K.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const i=new tt(e.droppable.containers);return i.set(n,{...s,disabled:o}),{...e,droppable:{...e.droppable,containers:i}}}case K.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const s=new tt(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function js(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=u.useContext(at),s=vt(r),i=vt(n?.id);return u.useEffect(()=>{if(!t&&!r&&s&&i!=null){if(!Et(s)||document.activeElement===s.target)return;const a=o.get(i);if(!a)return;const{activatorNode:l,node:c}=a;if(!l.current&&!c.current)return;requestAnimationFrame(()=>{for(const d of[l.current,c.current]){if(!d)continue;const h=ko(d);if(h){h.focus();break}}})}},[r,t,o,i,s]),null}function Or(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,s)=>s({transform:o,...r}),n):n}function Fs(e){return u.useMemo(()=>({draggable:{...mt.draggable,...e?.draggable},droppable:{...mt.droppable,...e?.droppable},dragOverlay:{...mt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function _s(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const s=u.useRef(!1),{x:i,y:a}=typeof o=="boolean"?{x:o,y:o}:o;be(()=>{if(!i&&!a||!t){s.current=!1;return}if(s.current||!r)return;const c=t?.node.current;if(!c||c.isConnected===!1)return;const d=n(c),h=br(d,r);if(i||(h.x=0),a||(h.y=0),s.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const m=wr(c);m&&m.scrollBy({top:h.y,left:h.x})}},[t,i,a,r,n])}const Dt=u.createContext({...ye,scaleX:1,scaleY:1});var Pe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Pe||(Pe={}));const Us=u.memo(function(t){var n,r,o,s;let{id:i,accessibility:a,autoScroll:l=!0,children:c,sensors:d=ks,collisionDetection:h=Go,measuring:m,modifiers:f,...b}=t;const y=u.useReducer(Os,void 0,Ps),[E,S]=y,[R,C]=Fo(),[v,I]=u.useState(Pe.Uninitialized),g=v===Pe.Initialized,{draggable:{active:p,nodes:w,translate:x},droppable:{containers:M}}=E,D=p!=null?w.get(p):null,A=u.useRef({initial:null,translated:null}),T=u.useMemo(()=>{var Z;return p!=null?{id:p,data:(Z=D?.data)!=null?Z:Bs,rect:A}:null},[p,D]),k=u.useRef(null),[J,ne]=u.useState(null),[$,me]=u.useState(null),oe=nt(b,Object.values(b)),le=it("DndDescribedBy",i),ce=u.useMemo(()=>M.getEnabled(),[M]),q=Fs(m),{droppableRects:ee,measureDroppableContainers:ue,measuringScheduled:pe}=xs(ce,{dragging:g,dependencies:[x.x,x.y],config:q.droppable}),X=ys(w,p),Q=u.useMemo(()=>$?yt($):null,[$]),z=Zr(),H=Ss(X,q.draggable.measure);_s({activeNode:p!=null?w.get(p):null,config:z.layoutShiftCompensation,initialRect:H,measure:q.draggable.measure});const j=kn(X,q.draggable.measure,H),de=kn(X?X.parentElement:null),re=u.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:ee,draggableNodes:w,draggingNode:null,draggingNodeRect:null,droppableContainers:M,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ie=M.getNodeFor((n=re.current.over)==null?void 0:n.id),fe=Ts({measure:q.dragOverlay.measure}),Ne=(r=fe.nodeRef.current)!=null?r:X,Me=g?(o=fe.rect)!=null?o:j:null,lt=!!(fe.nodeRef.current&&fe.rect),ct=Rs(lt?null:j),B=kr(Ne?te(Ne):null),L=Ds(g?Ie??X:null),O=As(L),P=Or(f,{transform:{x:x.x-ct.x,y:x.y-ct.y,scaleX:1,scaleY:1},activatorEvent:$,active:T,activeNodeRect:j,containerNodeRect:de,draggingNodeRect:Me,over:re.current.over,overlayNodeRect:fe.rect,scrollableAncestors:L,scrollableAncestorRects:O,windowRect:B}),_=Q?He(Q,x):null,G=Is(L),V=Ln(G),we=Ln(G,[j]),Ee=He(P,V),Re=Me?Zo(Me,P):null,Ae=T&&Re?h({active:T,collisionRect:Re,droppableRects:ee,droppableContainers:ce,pointerCoordinates:_}):null,ut=Yo(Ae,"id"),[ve,Je]=u.useState(null),Jr=lt?P:He(P,we),Xr=Wo(Jr,(s=ve?.rect)!=null?s:null,j),It=u.useRef(null),bn=u.useCallback((Z,se)=>{let{sensor:ie,options:Te}=se;if(k.current==null)return;const he=w.get(k.current);if(!he)return;const ae=Z.nativeEvent,xe=new ie({active:k.current,activeNode:he,event:ae,options:Te,context:re,onAbort(W){if(!w.get(W))return;const{onDragAbort:Se}=oe.current,De={id:W};Se?.(De),R({type:"onDragAbort",event:De})},onPending(W,ke,Se,De){if(!w.get(W))return;const{onDragPending:Ge}=oe.current,Be={id:W,constraint:ke,initialCoordinates:Se,offset:De};Ge?.(Be),R({type:"onDragPending",event:Be})},onStart(W){const ke=k.current;if(ke==null)return;const Se=w.get(ke);if(!Se)return;const{onDragStart:De}=oe.current,Xe={activatorEvent:ae,active:{id:ke,data:Se.data,rect:A}};Fe.unstable_batchedUpdates(()=>{De?.(Xe),I(Pe.Initializing),S({type:K.DragStart,initialCoordinates:W,active:ke}),R({type:"onDragStart",event:Xe}),ne(It.current),me(ae)})},onMove(W){S({type:K.DragMove,coordinates:W})},onEnd:qe(K.DragEnd),onCancel:qe(K.DragCancel)});It.current=xe;function qe(W){return async function(){const{active:Se,collisions:De,over:Xe,scrollAdjustedTranslate:Ge}=re.current;let Be=null;if(Se&&Ge){const{cancelDrop:We}=oe.current;Be={activatorEvent:ae,active:Se,collisions:De,delta:Ge,over:Xe},W===K.DragEnd&&typeof We=="function"&&await Promise.resolve(We(Be))&&(W=K.DragCancel)}k.current=null,Fe.unstable_batchedUpdates(()=>{S({type:W}),I(Pe.Uninitialized),Je(null),ne(null),me(null),It.current=null;const We=W===K.DragEnd?"onDragEnd":"onDragCancel";if(Be){const Nt=oe.current[We];Nt?.(Be),R({type:We,event:Be})}})}}},[w]),Gr=u.useCallback((Z,se)=>(ie,Te)=>{const he=ie.nativeEvent,ae=w.get(Te);if(k.current!==null||!ae||he.dndKit||he.defaultPrevented)return;const xe={active:ae};Z(ie,se.options,xe)===!0&&(he.dndKit={capturedBy:se.sensor},k.current=Te,bn(ie,se))},[w,bn]),yn=ws(d,Gr);Ns(d),be(()=>{j&&v===Pe.Initializing&&I(Pe.Initialized)},[j,v]),u.useEffect(()=>{const{onDragMove:Z}=oe.current,{active:se,activatorEvent:ie,collisions:Te,over:he}=re.current;if(!se||!ie)return;const ae={active:se,activatorEvent:ie,collisions:Te,delta:{x:Ee.x,y:Ee.y},over:he};Fe.unstable_batchedUpdates(()=>{Z?.(ae),R({type:"onDragMove",event:ae})})},[Ee.x,Ee.y]),u.useEffect(()=>{const{active:Z,activatorEvent:se,collisions:ie,droppableContainers:Te,scrollAdjustedTranslate:he}=re.current;if(!Z||k.current==null||!se||!he)return;const{onDragOver:ae}=oe.current,xe=Te.get(ut),qe=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,W={active:Z,activatorEvent:se,collisions:ie,delta:{x:he.x,y:he.y},over:qe};Fe.unstable_batchedUpdates(()=>{Je(qe),ae?.(W),R({type:"onDragOver",event:W})})},[ut]),be(()=>{re.current={activatorEvent:$,active:T,activeNode:X,collisionRect:Re,collisions:Ae,droppableRects:ee,draggableNodes:w,draggingNode:Ne,draggingNodeRect:Me,droppableContainers:M,over:ve,scrollableAncestors:L,scrollAdjustedTranslate:Ee},A.current={initial:Me,translated:Re}},[T,X,Ae,Re,w,Ne,Me,ee,M,ve,L,Ee]),ps({...z,delta:x,draggingRect:Re,pointerCoordinates:_,scrollableAncestors:L,scrollableAncestorRects:O});const Wr=u.useMemo(()=>({active:T,activeNode:X,activeNodeRect:j,activatorEvent:$,collisions:Ae,containerNodeRect:de,dragOverlay:fe,draggableNodes:w,droppableContainers:M,droppableRects:ee,over:ve,measureDroppableContainers:ue,scrollableAncestors:L,scrollableAncestorRects:O,measuringConfiguration:q,measuringScheduled:pe,windowRect:B}),[T,X,j,$,Ae,de,fe,w,M,ee,ve,ue,L,O,q,pe,B]),Qr=u.useMemo(()=>({activatorEvent:$,activators:yn,active:T,activeNodeRect:j,ariaDescribedById:{draggable:le},dispatch:S,draggableNodes:w,over:ve,measureDroppableContainers:ue}),[$,yn,T,j,S,le,w,ve,ue]);return U.createElement(vr.Provider,{value:C},U.createElement(at.Provider,{value:Qr},U.createElement(Pr.Provider,{value:Wr},U.createElement(Dt.Provider,{value:Xr},c)),U.createElement(js,{disabled:a?.restoreFocus===!1})),U.createElement(zo,{...a,hiddenTextDescribedById:le}));function Zr(){const Z=J?.autoScrollEnabled===!1,se=typeof l=="object"?l.enabled===!1:l===!1,ie=g&&!Z&&!se;return typeof l=="object"?{...l,enabled:ie}:{enabled:ie}}}),zs=u.createContext(null),On="button",qs="Draggable";function $s(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const s=it(qs),{activators:i,activatorEvent:a,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:h,over:m}=u.useContext(at),{role:f=On,roleDescription:b="draggable",tabIndex:y=0}=o??{},E=l?.id===t,S=u.useContext(E?Dt:zs),[R,C]=pt(),[v,I]=pt(),g=Ms(i,t),p=nt(n);be(()=>(h.set(t,{id:t,key:s,node:R,activatorNode:v,data:p}),()=>{const x=h.get(t);x&&x.key===s&&h.delete(t)}),[h,t]);const w=u.useMemo(()=>({role:f,tabIndex:y,"aria-disabled":r,"aria-pressed":E&&f===On?!0:void 0,"aria-roledescription":b,"aria-describedby":d.draggable}),[r,f,y,E,b,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:c,attributes:w,isDragging:E,listeners:r?void 0:g,node:R,over:m,setNodeRef:C,setActivatorNodeRef:I,transform:S}}function jr(){return u.useContext(Pr)}const Hs="Droppable",Ks={timeout:25};function Vs(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const s=it(Hs),{active:i,dispatch:a,over:l,measureDroppableContainers:c}=u.useContext(at),d=u.useRef({disabled:n}),h=u.useRef(!1),m=u.useRef(null),f=u.useRef(null),{disabled:b,updateMeasurementsFor:y,timeout:E}={...Ks,...o},S=nt(y??r),R=u.useCallback(()=>{if(!h.current){h.current=!0;return}f.current!=null&&clearTimeout(f.current),f.current=setTimeout(()=>{c(Array.isArray(S.current)?S.current:[S.current]),f.current=null},E)},[E]),C=Rt({callback:R,disabled:b||!i}),v=u.useCallback((w,x)=>{C&&(x&&(C.unobserve(x),h.current=!1),w&&C.observe(w))},[C]),[I,g]=pt(v),p=nt(t);return u.useEffect(()=>{!C||!I.current||(C.disconnect(),h.current=!1,C.observe(I.current))},[I,C]),u.useEffect(()=>(a({type:K.RegisterDroppable,element:{id:r,key:s,disabled:n,node:I,rect:m,data:p}}),()=>a({type:K.UnregisterDroppable,key:s,id:r})),[r]),u.useEffect(()=>{n!==d.current.disabled&&(a({type:K.SetDroppableDisabled,id:r,key:s,disabled:n}),d.current.disabled=n)},[r,s,n,a]),{active:i,rect:m,isOver:l?.id===r,node:I,over:l,setNodeRef:g}}function Ys(e){let{animation:t,children:n}=e;const[r,o]=u.useState(null),[s,i]=u.useState(null),a=vt(n);return!n&&!r&&a&&o(a),be(()=>{if(!s)return;const l=r?.key,c=r?.props.id;if(l==null||c==null){o(null);return}Promise.resolve(t(c,s)).then(()=>{o(null)})},[t,r,s]),U.createElement(U.Fragment,null,n,r?u.cloneElement(r,{ref:i}):null)}const Js={x:0,y:0,scaleX:1,scaleY:1};function Xs(e){let{children:t}=e;return U.createElement(at.Provider,{value:Lr},U.createElement(Dt.Provider,{value:Js},t))}const Gs={position:"fixed",touchAction:"none"},Ws=e=>Et(e)?"transform 250ms ease":void 0,Qs=u.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:o,children:s,className:i,rect:a,style:l,transform:c,transition:d=Ws}=e;if(!a)return null;const h=o?c:{...c,scaleX:1,scaleY:1},m={...Gs,width:a.width,height:a.height,top:a.top,left:a.left,transform:je.Transform.toString(h),transformOrigin:o&&r?Ho(r,a):void 0,transition:typeof d=="function"?d(r):d,...l};return U.createElement(n,{className:i,style:m,ref:t},s)}),Fr=e=>t=>{let{active:n,dragOverlay:r}=t;const o={},{styles:s,className:i}=e;if(s!=null&&s.active)for(const[a,l]of Object.entries(s.active))l!==void 0&&(o[a]=n.node.style.getPropertyValue(a),n.node.style.setProperty(a,l));if(s!=null&&s.dragOverlay)for(const[a,l]of Object.entries(s.dragOverlay))l!==void 0&&r.node.style.setProperty(a,l);return i!=null&&i.active&&n.node.classList.add(i.active),i!=null&&i.dragOverlay&&r.node.classList.add(i.dragOverlay),function(){for(const[l,c]of Object.entries(o))n.node.style.setProperty(l,c);i!=null&&i.active&&n.node.classList.remove(i.active)}},Zs=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:je.Transform.toString(t)},{transform:je.Transform.toString(n)}]},ei={duration:250,easing:"ease",keyframes:Zs,sideEffects:Fr({styles:{active:{opacity:"0"}}})};function ti(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:o}=e;return Ct((s,i)=>{if(t===null)return;const a=n.get(s);if(!a)return;const l=a.node.current;if(!l)return;const c=Br(i);if(!c)return;const{transform:d}=te(i).getComputedStyle(i),h=yr(d);if(!h)return;const m=typeof t=="function"?t:ni(t);return Dr(l,o.draggable.measure),m({active:{id:s,data:a.data,node:l,rect:o.draggable.measure(l)},draggableNodes:n,dragOverlay:{node:i,rect:o.dragOverlay.measure(c)},droppableContainers:r,measuringConfiguration:o,transform:h})})}function ni(e){const{duration:t,easing:n,sideEffects:r,keyframes:o}={...ei,...e};return s=>{let{active:i,dragOverlay:a,transform:l,...c}=s;if(!t)return;const d={x:a.rect.left-i.rect.left,y:a.rect.top-i.rect.top},h={scaleX:l.scaleX!==1?i.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?i.rect.height*l.scaleY/a.rect.height:1},m={x:l.x-d.x,y:l.y-d.y,...h},f=o({...c,active:i,dragOverlay:a,transform:{initial:l,final:m}}),[b]=f,y=f[f.length-1];if(JSON.stringify(b)===JSON.stringify(y))return;const E=r?.({active:i,dragOverlay:a,...c}),S=a.node.animate(f,{duration:t,easing:n,fill:"forwards"});return new Promise(R=>{S.onfinish=()=>{E?.(),R()}})}}let jn=0;function ri(e){return u.useMemo(()=>{if(e!=null)return jn++,jn},[e])}const oi=U.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:r,style:o,transition:s,modifiers:i,wrapperElement:a="div",className:l,zIndex:c=999}=e;const{activatorEvent:d,active:h,activeNodeRect:m,containerNodeRect:f,draggableNodes:b,droppableContainers:y,dragOverlay:E,over:S,measuringConfiguration:R,scrollableAncestors:C,scrollableAncestorRects:v,windowRect:I}=jr(),g=u.useContext(Dt),p=ri(h?.id),w=Or(i,{activatorEvent:d,active:h,activeNodeRect:m,containerNodeRect:f,draggingNodeRect:E.rect,over:S,overlayNodeRect:E.rect,scrollableAncestors:C,scrollableAncestorRects:v,transform:g,windowRect:I}),x=mn(m),M=ti({config:r,draggableNodes:b,droppableContainers:y,measuringConfiguration:R}),D=x?E.setRef:void 0;return U.createElement(Xs,null,U.createElement(Ys,{animation:M},h&&p?U.createElement(Qs,{key:p,id:h.id,ref:D,as:a,activatorEvent:d,adjustScale:t,className:l,transition:s,rect:x,style:{zIndex:c,...o},transform:w},n):null))});function pn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function si(e,t){return e.reduce((n,r,o)=>{const s=t.get(r);return s&&(n[o]=s),n},Array(e.length))}function ft(e){return e!==null&&e>=0}function ii(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ai(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const _r=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const s=pn(t,r,n),i=t[o],a=s[o];return!a||!i?null:{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}},ht={scaleX:1,scaleY:1},li=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:s,overIndex:i}=e;const a=(t=s[n])!=null?t:r;if(!a)return null;if(o===n){const c=s[i];return c?{x:0,y:n<i?c.top+c.height-(a.top+a.height):c.top-a.top,...ht}:null}const l=ci(s,o,n);return o>n&&o<=i?{x:0,y:-a.height-l,...ht}:o<n&&o>=i?{x:0,y:a.height+l,...ht}:{x:0,y:0,...ht}};function ci(e,t,n){const r=e[t],o=e[t-1],s=e[t+1];return r?n<t?o?r.top-(o.top+o.height):s?s.top-(r.top+r.height):0:s?s.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Ur="Sortable",zr=U.createContext({activeIndex:-1,containerId:Ur,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:_r,disabled:{draggable:!1,droppable:!1}});function ui(e){let{children:t,id:n,items:r,strategy:o=_r,disabled:s=!1}=e;const{active:i,dragOverlay:a,droppableRects:l,over:c,measureDroppableContainers:d}=jr(),h=it(Ur,n),m=a.rect!==null,f=u.useMemo(()=>r.map(g=>typeof g=="object"&&"id"in g?g.id:g),[r]),b=i!=null,y=i?f.indexOf(i.id):-1,E=c?f.indexOf(c.id):-1,S=u.useRef(f),R=!ii(f,S.current),C=E!==-1&&y===-1||R,v=ai(s);be(()=>{R&&b&&d(f)},[R,f,b,d]),u.useEffect(()=>{S.current=f},[f]);const I=u.useMemo(()=>({activeIndex:y,containerId:h,disabled:v,disableTransforms:C,items:f,overIndex:E,useDragOverlay:m,sortedRects:si(f,l),strategy:o}),[y,h,v.draggable,v.droppable,C,f,E,l,m,o]);return U.createElement(zr.Provider,{value:I},t)}const di=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return pn(n,r,o).indexOf(t)},fi=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:s,newIndex:i,previousItems:a,previousContainerId:l,transition:c}=e;return!c||!r||a!==s&&o===i?!1:n?!0:i!==o&&t===l},hi={duration:200,easing:"ease"},qr="transform",gi=je.Transition.toString({property:qr,duration:0,easing:"linear"}),mi={roleDescription:"sortable"};function pi(e){let{disabled:t,index:n,node:r,rect:o}=e;const[s,i]=u.useState(null),a=u.useRef(n);return be(()=>{if(!t&&n!==a.current&&r.current){const l=o.current;if(l){const c=Ye(r.current,{ignoreTransform:!0}),d={x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height};(d.x||d.y)&&i(d)}}n!==a.current&&(a.current=n)},[t,n,r,o]),u.useEffect(()=>{s&&i(null)},[s]),s}function vi(e){let{animateLayoutChanges:t=fi,attributes:n,disabled:r,data:o,getNewIndex:s=di,id:i,strategy:a,resizeObserverConfig:l,transition:c=hi}=e;const{items:d,containerId:h,activeIndex:m,disabled:f,disableTransforms:b,sortedRects:y,overIndex:E,useDragOverlay:S,strategy:R}=u.useContext(zr),C=bi(r,f),v=d.indexOf(i),I=u.useMemo(()=>({sortable:{containerId:h,index:v,items:d},...o}),[h,o,v,d]),g=u.useMemo(()=>d.slice(d.indexOf(i)),[d,i]),{rect:p,node:w,isOver:x,setNodeRef:M}=Vs({id:i,data:I,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:g,...l}}),{active:D,activatorEvent:A,activeNodeRect:T,attributes:k,setNodeRef:J,listeners:ne,isDragging:$,over:me,setActivatorNodeRef:oe,transform:le}=$s({id:i,data:I,attributes:{...mi,...n},disabled:C.draggable}),ce=No(M,J),q=!!D,ee=q&&!b&&ft(m)&&ft(E),ue=!S&&$,pe=ue&&ee?le:null,Q=ee?pe??(a??R)({rects:y,activeNodeRect:T,activeIndex:m,overIndex:E,index:v}):null,z=ft(m)&&ft(E)?s({id:i,items:d,activeIndex:m,overIndex:E}):v,H=D?.id,j=u.useRef({activeId:H,items:d,newIndex:z,containerId:h}),de=d!==j.current.items,re=t({active:D,containerId:h,isDragging:$,isSorting:q,id:i,index:v,items:d,newIndex:j.current.newIndex,previousItems:j.current.items,previousContainerId:j.current.containerId,transition:c,wasDragging:j.current.activeId!=null}),Ie=pi({disabled:!re,index:v,node:w,rect:p});return u.useEffect(()=>{q&&j.current.newIndex!==z&&(j.current.newIndex=z),h!==j.current.containerId&&(j.current.containerId=h),d!==j.current.items&&(j.current.items=d)},[q,z,h,d]),u.useEffect(()=>{if(H===j.current.activeId)return;if(H!=null&&j.current.activeId==null){j.current.activeId=H;return}const Ne=setTimeout(()=>{j.current.activeId=H},50);return()=>clearTimeout(Ne)},[H]),{active:D,activeIndex:m,attributes:k,data:I,rect:p,index:v,newIndex:z,items:d,isOver:x,isSorting:q,isDragging:$,listeners:ne,node:w,overIndex:E,over:me,setNodeRef:ce,setActivatorNodeRef:oe,setDroppableNodeRef:M,setDraggableNodeRef:J,transform:Ie??Q,transition:fe()};function fe(){if(Ie||de&&j.current.newIndex===v)return gi;if(!(ue&&!Et(A)||!c)&&(q||re))return je.Transition.toString({...c,property:qr})}}function bi(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}F.Down,F.Right,F.Up,F.Left;function yi(e,t,n){const r={...e};return t.top+e.y<=n.top?r.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(r.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?r.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(r.x=n.left+n.width-t.right),r}const wi=e=>{let{draggingNodeRect:t,transform:n,scrollableAncestorRects:r}=e;const o=r[0];return!t||!o?n:yi(n,t,o)},xi=e=>{let{transform:t}=e;return{...t,x:0}};class Si extends Ar{static activators=[{eventName:"onMouseDown",handler:({nativeEvent:t})=>$r(t.target)}]}class Ci extends Tr{static activators=[{eventName:"onTouchStart",handler:({nativeEvent:t})=>$r(t.target)}]}function $r(e){let t=e;for(;t;){if(t.dataset&&t.dataset.noDnd)return!1;t=t.parentElement}return!0}function Fn(e){const{speaker:t,isOverlay:n,handleEditSpeakerName:r}=e,{attributes:o,listeners:s,setNodeRef:i,transform:a,transition:l,isDragging:c}=vi({id:t.id}),d={transform:je.Transform.toString(a),transition:l,opacity:c?"0":"1"},[h,m]=u.useState(!1);return u.useEffect(()=>{n&&m(!0)},[n]),N.jsxs(N.Fragment,{children:[N.jsx("style",{children:`
        .is-dropping .speaker-dnd-item {
          background: rgb(64, 64, 64);
          width: 100%;
          margin: 0;
        }
      `}),N.jsx("div",{className:Oe("h-14 flex items-center"),ref:i,style:d,...o,...s,"data-vaul-no-drag":!0,children:N.jsxs("div",{className:Oe("speaker-dnd-item p-1 pl-3 bg-neutral-700 rounded-md w-full transition-all flex items-center",{"bg-neutral-600":n,"-mx-2 w-[calc(100%+1rem)]":h}),children:[N.jsx(sn.dndHandle,{className:"mr-3 h-3.5 opacity-30 fill-white"})," ",t.name,N.jsx("div",{"data-no-dnd":!0,className:"ml-auto",children:N.jsx(_e,{variant:"ghost",className:"rounded",onClick:()=>{const f=prompt("Edit speaker name",t.name||"");f!==null&&r?.(t.id,f)},children:"Edit"})})]})})]})}const Ei=({speakersMap:e,speakersMapRaw:t,open:n,setOpen:r,setSpeakersMap:o,episodeId:s,colorScheme:i})=>{const[a,l]=u.useState(n||!1);Mt(()=>{r?.(a)},[a]),Mt(()=>{l(n||!1)},[n]);const[c,d]=u.useState([]),[h,m]=u.useState(null),f=u.useMemo(()=>Object.values(t||{}),[t]);u.useEffect(()=>{d([])},[f]),u.useEffect(()=>{if(c.length||!f.length)return;let v=(()=>{try{const I=localStorage.getItem(`custom-speakers-${s}`);if(I){let g=JSON.parse(I);return g=g.filter(p=>f.some(w=>w.id===p.id)),g}return null}catch{return null}})();d(v||f)},[f,s,c.length]),Mt(()=>{if(!c.length)return;const I=c.filter(g=>f.some(p=>p.id===g.id)).map((g,p)=>({...f[p],name:g.name}));o?.(I.reduce((g,p)=>(g[parseInt(p.id)]=p,g),{})),I.some((g,p)=>g.name!==f[p]?.name)?localStorage.setItem(`custom-speakers-${s}`,JSON.stringify(I)):localStorage.removeItem(`custom-speakers-${s}`),c.length!==I.length&&d(I)},[c,f]);const b=qo(Rn(Si,{}),Rn(Ci,{activationConstraint:{delay:80,tolerance:30}})),y=u.useCallback(v=>{m(v.active?.id)},[]),E=u.useCallback(v=>{m(null);const{active:I,over:g}=v;g&&I.id!==g.id&&d(p=>{const w=p.findIndex(D=>D.id===I.id),x=p.findIndex(D=>D.id===g?.id);return pn(p,w,x)})},[]),S=u.useCallback((v,I)=>{d(g=>g.map(p=>p.id===v?{...p,name:I}:p))},[]),R=u.useCallback(()=>{d(f)},[f]),C=u.useMemo(()=>JSON.stringify(f)===JSON.stringify(c),[f,c]);return N.jsx(eo,{open:a,onOpenChange:l,noBodyStyles:!0,modal:!0,children:N.jsxs(to,{className:"pb-safe-or-3 max-h-full outline-none sm:mx-2 md:mx-auto md:max-w-3xl flex flex-col",children:[N.jsxs(no,{className:"sm:text-center",children:[N.jsx(ro,{children:"Edit Speaker"}),N.jsx(oo,{children:"Manually edit speaker for better accuracy"})]}),N.jsx("div",{className:"px-4 flex-1 min-h-0 overflow-auto",children:N.jsxs("div",{className:"flex py-2",children:[N.jsx("div",{className:"mr-4",children:Object.values(e).map((v,I)=>N.jsx("div",{className:"h-14 flex items-center",children:N.jsx("div",{className:"size-4 rounded",style:{background:i?.[v.id]||"#808080"}})},I))}),N.jsxs(Us,{sensors:b,collisionDetection:Jo,onDragStart:y,onDragEnd:E,modifiers:[wi,xi],children:[N.jsx(ui,{items:c,strategy:li,children:N.jsx("div",{className:"sortable-list flex-1",children:c.map(v=>N.jsx(Fn,{speaker:v,handleEditSpeakerName:S},v.id))})}),typeof document<"u"&&Fe.createPortal(N.jsx(oi,{dropAnimation:{sideEffects:Fr({styles:{active:{opacity:"0"}},className:{dragOverlay:"is-dropping"}})},children:h?N.jsx(Fn,{speaker:c.find(v=>v.id===h),isOverlay:!0}):null}),document.body)]})]})}),N.jsx(so,{children:N.jsx(_e,{className:"size-8 p-0 items-center justify-center rounded-full absolute top-4 right-4 bg-neutral-800 hover:underline hidden md:flex",variant:"secondary",children:N.jsx(io,{className:"opacity-30 size-6"})})}),N.jsx(ao,{children:N.jsx("div",{className:"flex",children:N.jsx(_e,{className:"ml-auto rounded-full",onClick:R,disabled:C,children:"Reset"})})})]})})},Ri=U.memo(Ei),Di=(e,t)=>{let n=e.segments.reduce((s,i,a,l)=>{const c=i.sentences[0].start,d=i.sentences[i.sentences.length-1].end;if(t.some(([f,b])=>c>=f&&d<=b))return s.push({speaker:null,sentences:[{start:c,end:d,text:"Dynamic content"}]}),s;const m=t.find(([f,b])=>c<=f&&d>f||c<b&&d>=b);if(m){const[f,b]=m;if(c>f-10&&d<b+10)return s.push({speaker:null,sentences:[{start:c,end:d,text:"Dynamic content"}]}),s;if(c>b-10||d<f+10)return s.push(i),s;const E=i.sentences.filter(C=>C.start<f).length?{speaker:i.speaker,sentences:i.sentences.filter(C=>C.start<f)}:void 0,S=i.sentences.filter(C=>C.end>b),R=S.length?{speaker:i.speaker,sentences:S}:void 0;return E&&R&&E.sentences[E.sentences.length-1].end>=R.sentences[0].start?(s.push(i),s):(E&&s.push(E),s.push({speaker:null,sentences:[{start:E?E.sentences[E.sentences.length-1].end+.001:c,end:R?R.sentences[0].start-.001:d,text:"Dynamic content"}]}),R&&s.push(R),s)}return s.push(i),s},[]);n=n.reduce((s,i,a,l)=>{const c=s[s.length-1];return c&&c.speaker===i.speaker&&c.speaker===null?(c.sentences[0].end=i.sentences[0].end,s):(s.push(i),s)},[]);const r=new Set(n.map(s=>s.speaker).filter(s=>s!==null));let o=e.speakers;return o&&(o=Object.fromEntries(Object.entries(o).filter(([s])=>r.has(Number(s))))),{segments:n,speakers:o}};var $e={},Pt,_n;function Ii(){return _n||(_n=1,Pt=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Pt}var Ot={},Le={},Un;function Ue(){if(Un)return Le;Un=1;let e;const t=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Le.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},Le.getSymbolTotalCodewords=function(r){return t[r]},Le.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},Le.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');e=r},Le.isKanjiModeEnabled=function(){return typeof e<"u"},Le.toSJIS=function(r){return e(r)},Le}var jt={},zn;function vn(){return zn||(zn=1,(function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+n)}}e.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},e.from=function(r,o){if(e.isValid(r))return r;try{return t(r)}catch{return o}}})(jt)),jt}var Ft,qn;function Ni(){if(qn)return Ft;qn=1;function e(){this.buffer=[],this.length=0}return e.prototype={get:function(t){const n=Math.floor(t/8);return(this.buffer[n]>>>7-t%8&1)===1},put:function(t,n){for(let r=0;r<n;r++)this.putBit((t>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),t&&(this.buffer[n]|=128>>>this.length%8),this.length++}},Ft=e,Ft}var _t,$n;function Mi(){if($n)return _t;$n=1;function e(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}return e.prototype.set=function(t,n,r,o){const s=t*this.size+n;this.data[s]=r,o&&(this.reservedBit[s]=!0)},e.prototype.get=function(t,n){return this.data[t*this.size+n]},e.prototype.xor=function(t,n,r){this.data[t*this.size+n]^=r},e.prototype.isReserved=function(t,n){return this.reservedBit[t*this.size+n]},_t=e,_t}var Ut={},Hn;function Ai(){return Hn||(Hn=1,(function(e){const t=Ue().getSymbolSize;e.getRowColCoords=function(r){if(r===1)return[];const o=Math.floor(r/7)+2,s=t(r),i=s===145?26:Math.ceil((s-13)/(2*o-2))*2,a=[s-7];for(let l=1;l<o-1;l++)a[l]=a[l-1]-i;return a.push(6),a.reverse()},e.getPositions=function(r){const o=[],s=e.getRowColCoords(r),i=s.length;for(let a=0;a<i;a++)for(let l=0;l<i;l++)a===0&&l===0||a===0&&l===i-1||a===i-1&&l===0||o.push([s[a],s[l]]);return o}})(Ut)),Ut}var zt={},Kn;function Ti(){if(Kn)return zt;Kn=1;const e=Ue().getSymbolSize,t=7;return zt.getPositions=function(r){const o=e(r);return[[0,0],[o-t,0],[0,o-t]]},zt}var qt={},Vn;function ki(){return Vn||(Vn=1,(function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},e.from=function(o){return e.isValid(o)?parseInt(o,10):void 0},e.getPenaltyN1=function(o){const s=o.size;let i=0,a=0,l=0,c=null,d=null;for(let h=0;h<s;h++){a=l=0,c=d=null;for(let m=0;m<s;m++){let f=o.get(h,m);f===c?a++:(a>=5&&(i+=t.N1+(a-5)),c=f,a=1),f=o.get(m,h),f===d?l++:(l>=5&&(i+=t.N1+(l-5)),d=f,l=1)}a>=5&&(i+=t.N1+(a-5)),l>=5&&(i+=t.N1+(l-5))}return i},e.getPenaltyN2=function(o){const s=o.size;let i=0;for(let a=0;a<s-1;a++)for(let l=0;l<s-1;l++){const c=o.get(a,l)+o.get(a,l+1)+o.get(a+1,l)+o.get(a+1,l+1);(c===4||c===0)&&i++}return i*t.N2},e.getPenaltyN3=function(o){const s=o.size;let i=0,a=0,l=0;for(let c=0;c<s;c++){a=l=0;for(let d=0;d<s;d++)a=a<<1&2047|o.get(c,d),d>=10&&(a===1488||a===93)&&i++,l=l<<1&2047|o.get(d,c),d>=10&&(l===1488||l===93)&&i++}return i*t.N3},e.getPenaltyN4=function(o){let s=0;const i=o.data.length;for(let l=0;l<i;l++)s+=o.data[l];return Math.abs(Math.ceil(s*100/i/5)-10)*t.N4};function n(r,o,s){switch(r){case e.Patterns.PATTERN000:return(o+s)%2===0;case e.Patterns.PATTERN001:return o%2===0;case e.Patterns.PATTERN010:return s%3===0;case e.Patterns.PATTERN011:return(o+s)%3===0;case e.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(s/3))%2===0;case e.Patterns.PATTERN101:return o*s%2+o*s%3===0;case e.Patterns.PATTERN110:return(o*s%2+o*s%3)%2===0;case e.Patterns.PATTERN111:return(o*s%3+(o+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}e.applyMask=function(o,s){const i=s.size;for(let a=0;a<i;a++)for(let l=0;l<i;l++)s.isReserved(l,a)||s.xor(l,a,n(o,l,a))},e.getBestMask=function(o,s){const i=Object.keys(e.Patterns).length;let a=0,l=1/0;for(let c=0;c<i;c++){s(c),e.applyMask(c,o);const d=e.getPenaltyN1(o)+e.getPenaltyN2(o)+e.getPenaltyN3(o)+e.getPenaltyN4(o);e.applyMask(c,o),d<l&&(l=d,a=c)}return a}})(qt)),qt}var gt={},Yn;function Hr(){if(Yn)return gt;Yn=1;const e=vn(),t=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return gt.getBlocksCount=function(o,s){switch(s){case e.L:return t[(o-1)*4+0];case e.M:return t[(o-1)*4+1];case e.Q:return t[(o-1)*4+2];case e.H:return t[(o-1)*4+3];default:return}},gt.getTotalCodewordsCount=function(o,s){switch(s){case e.L:return n[(o-1)*4+0];case e.M:return n[(o-1)*4+1];case e.Q:return n[(o-1)*4+2];case e.H:return n[(o-1)*4+3];default:return}},gt}var $t={},Qe={},Jn;function Bi(){if(Jn)return Qe;Jn=1;const e=new Uint8Array(512),t=new Uint8Array(256);return(function(){let r=1;for(let o=0;o<255;o++)e[o]=r,t[r]=o,r<<=1,r&256&&(r^=285);for(let o=255;o<512;o++)e[o]=e[o-255]})(),Qe.log=function(r){if(r<1)throw new Error("log("+r+")");return t[r]},Qe.exp=function(r){return e[r]},Qe.mul=function(r,o){return r===0||o===0?0:e[t[r]+t[o]]},Qe}var Xn;function Li(){return Xn||(Xn=1,(function(e){const t=Bi();e.mul=function(r,o){const s=new Uint8Array(r.length+o.length-1);for(let i=0;i<r.length;i++)for(let a=0;a<o.length;a++)s[i+a]^=t.mul(r[i],o[a]);return s},e.mod=function(r,o){let s=new Uint8Array(r);for(;s.length-o.length>=0;){const i=s[0];for(let l=0;l<o.length;l++)s[l]^=t.mul(o[l],i);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},e.generateECPolynomial=function(r){let o=new Uint8Array([1]);for(let s=0;s<r;s++)o=e.mul(o,new Uint8Array([1,t.exp(s)]));return o}})($t)),$t}var Ht,Gn;function Pi(){if(Gn)return Ht;Gn=1;const e=Li();function t(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return t.prototype.initialize=function(r){this.degree=r,this.genPoly=e.generateECPolynomial(this.degree)},t.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const o=new Uint8Array(r.length+this.degree);o.set(r);const s=e.mod(o,this.genPoly),i=this.degree-s.length;if(i>0){const a=new Uint8Array(this.degree);return a.set(s,i),a}return s},Ht=t,Ht}var Kt={},Vt={},Yt={},Wn;function Kr(){return Wn||(Wn=1,Yt.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}),Yt}var Ce={},Qn;function Vr(){if(Qn)return Ce;Qn=1;const e="[0-9]+",t="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;Ce.KANJI=new RegExp(n,"g"),Ce.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ce.BYTE=new RegExp(r,"g"),Ce.NUMERIC=new RegExp(e,"g"),Ce.ALPHANUMERIC=new RegExp(t,"g");const o=new RegExp("^"+n+"$"),s=new RegExp("^"+e+"$"),i=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ce.testKanji=function(l){return o.test(l)},Ce.testNumeric=function(l){return s.test(l)},Ce.testAlphanumeric=function(l){return i.test(l)},Ce}var Zn;function ze(){return Zn||(Zn=1,(function(e){const t=Kr(),n=Vr();e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(s,i){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!t.isValid(i))throw new Error("Invalid version: "+i);return i>=1&&i<10?s.ccBits[0]:i<27?s.ccBits[1]:s.ccBits[2]},e.getBestModeForData=function(s){return n.testNumeric(s)?e.NUMERIC:n.testAlphanumeric(s)?e.ALPHANUMERIC:n.testKanji(s)?e.KANJI:e.BYTE},e.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},e.isValid=function(s){return s&&s.bit&&s.ccBits};function r(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+o)}}e.from=function(s,i){if(e.isValid(s))return s;try{return r(s)}catch{return i}}})(Vt)),Vt}var er;function Oi(){return er||(er=1,(function(e){const t=Ue(),n=Hr(),r=vn(),o=ze(),s=Kr(),i=7973,a=t.getBCHDigit(i);function l(m,f,b){for(let y=1;y<=40;y++)if(f<=e.getCapacity(y,b,m))return y}function c(m,f){return o.getCharCountIndicator(m,f)+4}function d(m,f){let b=0;return m.forEach(function(y){const E=c(y.mode,f);b+=E+y.getBitsLength()}),b}function h(m,f){for(let b=1;b<=40;b++)if(d(m,b)<=e.getCapacity(b,f,o.MIXED))return b}e.from=function(f,b){return s.isValid(f)?parseInt(f,10):b},e.getCapacity=function(f,b,y){if(!s.isValid(f))throw new Error("Invalid QR Code version");typeof y>"u"&&(y=o.BYTE);const E=t.getSymbolTotalCodewords(f),S=n.getTotalCodewordsCount(f,b),R=(E-S)*8;if(y===o.MIXED)return R;const C=R-c(y,f);switch(y){case o.NUMERIC:return Math.floor(C/10*3);case o.ALPHANUMERIC:return Math.floor(C/11*2);case o.KANJI:return Math.floor(C/13);case o.BYTE:default:return Math.floor(C/8)}},e.getBestVersionForData=function(f,b){let y;const E=r.from(b,r.M);if(Array.isArray(f)){if(f.length>1)return h(f,E);if(f.length===0)return 1;y=f[0]}else y=f;return l(y.mode,y.getLength(),E)},e.getEncodedBits=function(f){if(!s.isValid(f)||f<7)throw new Error("Invalid QR Code version");let b=f<<12;for(;t.getBCHDigit(b)-a>=0;)b^=i<<t.getBCHDigit(b)-a;return f<<12|b}})(Kt)),Kt}var Jt={},tr;function ji(){if(tr)return Jt;tr=1;const e=Ue(),t=1335,n=21522,r=e.getBCHDigit(t);return Jt.getEncodedBits=function(s,i){const a=s.bit<<3|i;let l=a<<10;for(;e.getBCHDigit(l)-r>=0;)l^=t<<e.getBCHDigit(l)-r;return(a<<10|l)^n},Jt}var Xt={},Gt,nr;function Fi(){if(nr)return Gt;nr=1;const e=ze();function t(n){this.mode=e.NUMERIC,this.data=n.toString()}return t.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let o,s,i;for(o=0;o+3<=this.data.length;o+=3)s=this.data.substr(o,3),i=parseInt(s,10),r.put(i,10);const a=this.data.length-o;a>0&&(s=this.data.substr(o),i=parseInt(s,10),r.put(i,a*3+1))},Gt=t,Gt}var Wt,rr;function _i(){if(rr)return Wt;rr=1;const e=ze(),t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=e.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(o){return 11*Math.floor(o/2)+6*(o%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(o){let s;for(s=0;s+2<=this.data.length;s+=2){let i=t.indexOf(this.data[s])*45;i+=t.indexOf(this.data[s+1]),o.put(i,11)}this.data.length%2&&o.put(t.indexOf(this.data[s]),6)},Wt=n,Wt}var Qt,or;function Ui(){if(or)return Qt;or=1;const e=ze();function t(n){this.mode=e.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return t.getBitsLength=function(r){return r*8},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(n){for(let r=0,o=this.data.length;r<o;r++)n.put(this.data[r],8)},Qt=t,Qt}var Zt,sr;function zi(){if(sr)return Zt;sr=1;const e=ze(),t=Ue();function n(r){this.mode=e.KANJI,this.data=r}return n.getBitsLength=function(o){return o*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let o;for(o=0;o<this.data.length;o++){let s=t.toSJIS(this.data[o]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[o]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},Zt=n,Zt}var en={exports:{}},ir;function qi(){return ir||(ir=1,(function(e){var t={single_source_shortest_paths:function(n,r,o){var s={},i={};i[r]=0;var a=t.PriorityQueue.make();a.push(r,0);for(var l,c,d,h,m,f,b,y,E;!a.empty();){l=a.pop(),c=l.value,h=l.cost,m=n[c]||{};for(d in m)m.hasOwnProperty(d)&&(f=m[d],b=h+f,y=i[d],E=typeof i[d]>"u",(E||y>b)&&(i[d]=b,a.push(d,b),s[d]=c))}if(typeof o<"u"&&typeof i[o]>"u"){var S=["Could not find a path from ",r," to ",o,"."].join("");throw new Error(S)}return s},extract_shortest_path_from_predecessor_list:function(n,r){for(var o=[],s=r;s;)o.push(s),n[s],s=n[s];return o.reverse(),o},find_path:function(n,r,o){var s=t.single_source_shortest_paths(n,r,o);return t.extract_shortest_path_from_predecessor_list(s,o)},PriorityQueue:{make:function(n){var r=t.PriorityQueue,o={},s;n=n||{};for(s in r)r.hasOwnProperty(s)&&(o[s]=r[s]);return o.queue=[],o.sorter=n.sorter||r.default_sorter,o},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var o={value:n,cost:r};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t})(en)),en.exports}var ar;function $i(){return ar||(ar=1,(function(e){const t=ze(),n=Fi(),r=_i(),o=Ui(),s=zi(),i=Vr(),a=Ue(),l=qi();function c(S){return unescape(encodeURIComponent(S)).length}function d(S,R,C){const v=[];let I;for(;(I=S.exec(C))!==null;)v.push({data:I[0],index:I.index,mode:R,length:I[0].length});return v}function h(S){const R=d(i.NUMERIC,t.NUMERIC,S),C=d(i.ALPHANUMERIC,t.ALPHANUMERIC,S);let v,I;return a.isKanjiModeEnabled()?(v=d(i.BYTE,t.BYTE,S),I=d(i.KANJI,t.KANJI,S)):(v=d(i.BYTE_KANJI,t.BYTE,S),I=[]),R.concat(C,v,I).sort(function(p,w){return p.index-w.index}).map(function(p){return{data:p.data,mode:p.mode,length:p.length}})}function m(S,R){switch(R){case t.NUMERIC:return n.getBitsLength(S);case t.ALPHANUMERIC:return r.getBitsLength(S);case t.KANJI:return s.getBitsLength(S);case t.BYTE:return o.getBitsLength(S)}}function f(S){return S.reduce(function(R,C){const v=R.length-1>=0?R[R.length-1]:null;return v&&v.mode===C.mode?(R[R.length-1].data+=C.data,R):(R.push(C),R)},[])}function b(S){const R=[];for(let C=0;C<S.length;C++){const v=S[C];switch(v.mode){case t.NUMERIC:R.push([v,{data:v.data,mode:t.ALPHANUMERIC,length:v.length},{data:v.data,mode:t.BYTE,length:v.length}]);break;case t.ALPHANUMERIC:R.push([v,{data:v.data,mode:t.BYTE,length:v.length}]);break;case t.KANJI:R.push([v,{data:v.data,mode:t.BYTE,length:c(v.data)}]);break;case t.BYTE:R.push([{data:v.data,mode:t.BYTE,length:c(v.data)}])}}return R}function y(S,R){const C={},v={start:{}};let I=["start"];for(let g=0;g<S.length;g++){const p=S[g],w=[];for(let x=0;x<p.length;x++){const M=p[x],D=""+g+x;w.push(D),C[D]={node:M,lastCount:0},v[D]={};for(let A=0;A<I.length;A++){const T=I[A];C[T]&&C[T].node.mode===M.mode?(v[T][D]=m(C[T].lastCount+M.length,M.mode)-m(C[T].lastCount,M.mode),C[T].lastCount+=M.length):(C[T]&&(C[T].lastCount=M.length),v[T][D]=m(M.length,M.mode)+4+t.getCharCountIndicator(M.mode,R))}}I=w}for(let g=0;g<I.length;g++)v[I[g]].end=0;return{map:v,table:C}}function E(S,R){let C;const v=t.getBestModeForData(S);if(C=t.from(R,v),C!==t.BYTE&&C.bit<v.bit)throw new Error('"'+S+'" cannot be encoded with mode '+t.toString(C)+`.
 Suggested mode is: `+t.toString(v));switch(C===t.KANJI&&!a.isKanjiModeEnabled()&&(C=t.BYTE),C){case t.NUMERIC:return new n(S);case t.ALPHANUMERIC:return new r(S);case t.KANJI:return new s(S);case t.BYTE:return new o(S)}}e.fromArray=function(R){return R.reduce(function(C,v){return typeof v=="string"?C.push(E(v,null)):v.data&&C.push(E(v.data,v.mode)),C},[])},e.fromString=function(R,C){const v=h(R,a.isKanjiModeEnabled()),I=b(v),g=y(I,C),p=l.find_path(g.map,"start","end"),w=[];for(let x=1;x<p.length-1;x++)w.push(g.table[p[x]].node);return e.fromArray(f(w))},e.rawSplit=function(R){return e.fromArray(h(R,a.isKanjiModeEnabled()))}})(Xt)),Xt}var lr;function Hi(){if(lr)return Ot;lr=1;const e=Ue(),t=vn(),n=Ni(),r=Mi(),o=Ai(),s=Ti(),i=ki(),a=Hr(),l=Pi(),c=Oi(),d=ji(),h=ze(),m=$i();function f(g,p){const w=g.size,x=s.getPositions(p);for(let M=0;M<x.length;M++){const D=x[M][0],A=x[M][1];for(let T=-1;T<=7;T++)if(!(D+T<=-1||w<=D+T))for(let k=-1;k<=7;k++)A+k<=-1||w<=A+k||(T>=0&&T<=6&&(k===0||k===6)||k>=0&&k<=6&&(T===0||T===6)||T>=2&&T<=4&&k>=2&&k<=4?g.set(D+T,A+k,!0,!0):g.set(D+T,A+k,!1,!0))}}function b(g){const p=g.size;for(let w=8;w<p-8;w++){const x=w%2===0;g.set(w,6,x,!0),g.set(6,w,x,!0)}}function y(g,p){const w=o.getPositions(p);for(let x=0;x<w.length;x++){const M=w[x][0],D=w[x][1];for(let A=-2;A<=2;A++)for(let T=-2;T<=2;T++)A===-2||A===2||T===-2||T===2||A===0&&T===0?g.set(M+A,D+T,!0,!0):g.set(M+A,D+T,!1,!0)}}function E(g,p){const w=g.size,x=c.getEncodedBits(p);let M,D,A;for(let T=0;T<18;T++)M=Math.floor(T/3),D=T%3+w-8-3,A=(x>>T&1)===1,g.set(M,D,A,!0),g.set(D,M,A,!0)}function S(g,p,w){const x=g.size,M=d.getEncodedBits(p,w);let D,A;for(D=0;D<15;D++)A=(M>>D&1)===1,D<6?g.set(D,8,A,!0):D<8?g.set(D+1,8,A,!0):g.set(x-15+D,8,A,!0),D<8?g.set(8,x-D-1,A,!0):D<9?g.set(8,15-D-1+1,A,!0):g.set(8,15-D-1,A,!0);g.set(x-8,8,1,!0)}function R(g,p){const w=g.size;let x=-1,M=w-1,D=7,A=0;for(let T=w-1;T>0;T-=2)for(T===6&&T--;;){for(let k=0;k<2;k++)if(!g.isReserved(M,T-k)){let J=!1;A<p.length&&(J=(p[A]>>>D&1)===1),g.set(M,T-k,J),D--,D===-1&&(A++,D=7)}if(M+=x,M<0||w<=M){M-=x,x=-x;break}}}function C(g,p,w){const x=new n;w.forEach(function(k){x.put(k.mode.bit,4),x.put(k.getLength(),h.getCharCountIndicator(k.mode,g)),k.write(x)});const M=e.getSymbolTotalCodewords(g),D=a.getTotalCodewordsCount(g,p),A=(M-D)*8;for(x.getLengthInBits()+4<=A&&x.put(0,4);x.getLengthInBits()%8!==0;)x.putBit(0);const T=(A-x.getLengthInBits())/8;for(let k=0;k<T;k++)x.put(k%2?17:236,8);return v(x,g,p)}function v(g,p,w){const x=e.getSymbolTotalCodewords(p),M=a.getTotalCodewordsCount(p,w),D=x-M,A=a.getBlocksCount(p,w),T=x%A,k=A-T,J=Math.floor(x/A),ne=Math.floor(D/A),$=ne+1,me=J-ne,oe=new l(me);let le=0;const ce=new Array(A),q=new Array(A);let ee=0;const ue=new Uint8Array(g.buffer);for(let H=0;H<A;H++){const j=H<k?ne:$;ce[H]=ue.slice(le,le+j),q[H]=oe.encode(ce[H]),le+=j,ee=Math.max(ee,j)}const pe=new Uint8Array(x);let X=0,Q,z;for(Q=0;Q<ee;Q++)for(z=0;z<A;z++)Q<ce[z].length&&(pe[X++]=ce[z][Q]);for(Q=0;Q<me;Q++)for(z=0;z<A;z++)pe[X++]=q[z][Q];return pe}function I(g,p,w,x){let M;if(Array.isArray(g))M=m.fromArray(g);else if(typeof g=="string"){let J=p;if(!J){const ne=m.rawSplit(g);J=c.getBestVersionForData(ne,w)}M=m.fromString(g,J||40)}else throw new Error("Invalid data");const D=c.getBestVersionForData(M,w);if(!D)throw new Error("The amount of data is too big to be stored in a QR Code");if(!p)p=D;else if(p<D)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+D+`.
`);const A=C(p,w,M),T=e.getSymbolSize(p),k=new r(T);return f(k,p),b(k),y(k,p),S(k,w,0),p>=7&&E(k,p),R(k,A),isNaN(x)&&(x=i.getBestMask(k,S.bind(null,k,w))),i.applyMask(x,k),S(k,w,x),{modules:k,version:p,errorCorrectionLevel:w,maskPattern:x,segments:M}}return Ot.create=function(p,w){if(typeof p>"u"||p==="")throw new Error("No input text");let x=t.M,M,D;return typeof w<"u"&&(x=t.from(w.errorCorrectionLevel,t.M),M=c.from(w.version),D=i.from(w.maskPattern),w.toSJISFunc&&e.setToSJISFunction(w.toSJISFunc)),I(p,M,x,D)},Ot}var tn={},nn={},cr;function Yr(){return cr||(cr=1,(function(e){function t(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const o=parseInt(r.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+r.slice(0,6).join("")}}e.getOptions=function(r){r||(r={}),r.color||(r.color={});const o=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,i=r.scale||4;return{width:s,scale:s?4:i,margin:o,color:{dark:t(r.color.dark||"#000000ff"),light:t(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},e.getScale=function(r,o){return o.width&&o.width>=r+o.margin*2?o.width/(r+o.margin*2):o.scale},e.getImageWidth=function(r,o){const s=e.getScale(r,o);return Math.floor((r+o.margin*2)*s)},e.qrToImageData=function(r,o,s){const i=o.modules.size,a=o.modules.data,l=e.getScale(i,s),c=Math.floor((i+s.margin*2)*l),d=s.margin*l,h=[s.color.light,s.color.dark];for(let m=0;m<c;m++)for(let f=0;f<c;f++){let b=(m*c+f)*4,y=s.color.light;if(m>=d&&f>=d&&m<c-d&&f<c-d){const E=Math.floor((m-d)/l),S=Math.floor((f-d)/l);y=h[a[E*i+S]?1:0]}r[b++]=y.r,r[b++]=y.g,r[b++]=y.b,r[b]=y.a}}})(nn)),nn}var ur;function Ki(){return ur||(ur=1,(function(e){const t=Yr();function n(o,s,i){o.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=i,s.width=i,s.style.height=i+"px",s.style.width=i+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(s,i,a){let l=a,c=i;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),i||(c=r()),l=t.getOptions(l);const d=t.getImageWidth(s.modules.size,l),h=c.getContext("2d"),m=h.createImageData(d,d);return t.qrToImageData(m.data,s,l),n(h,c,d),h.putImageData(m,0,0),c},e.renderToDataURL=function(s,i,a){let l=a;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),l||(l={});const c=e.render(s,i,l),d=l.type||"image/png",h=l.rendererOpts||{};return c.toDataURL(d,h.quality)}})(tn)),tn}var rn={},dr;function Vi(){if(dr)return rn;dr=1;const e=Yr();function t(o,s){const i=o.a/255,a=s+'="'+o.hex+'"';return i<1?a+" "+s+'-opacity="'+i.toFixed(2).slice(1)+'"':a}function n(o,s,i){let a=o+s;return typeof i<"u"&&(a+=" "+i),a}function r(o,s,i){let a="",l=0,c=!1,d=0;for(let h=0;h<o.length;h++){const m=Math.floor(h%s),f=Math.floor(h/s);!m&&!c&&(c=!0),o[h]?(d++,h>0&&m>0&&o[h-1]||(a+=c?n("M",m+i,.5+f+i):n("m",l,0),l=0,c=!1),m+1<s&&o[h+1]||(a+=n("h",d),d=0)):l++}return a}return rn.render=function(s,i,a){const l=e.getOptions(i),c=s.modules.size,d=s.modules.data,h=c+l.margin*2,m=l.color.light.a?"<path "+t(l.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",f="<path "+t(l.color.dark,"stroke")+' d="'+r(d,c,l.margin)+'"/>',b='viewBox="0 0 '+h+" "+h+'"',E='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+b+' shape-rendering="crispEdges">'+m+f+`</svg>
`;return typeof a=="function"&&a(null,E),E},rn}var fr;function Yi(){if(fr)return $e;fr=1;const e=Ii(),t=Hi(),n=Ki(),r=Vi();function o(s,i,a,l,c){const d=[].slice.call(arguments,1),h=d.length,m=typeof d[h-1]=="function";if(!m&&!e())throw new Error("Callback required as last argument");if(m){if(h<2)throw new Error("Too few arguments provided");h===2?(c=a,a=i,i=l=void 0):h===3&&(i.getContext&&typeof c>"u"?(c=l,l=void 0):(c=l,l=a,a=i,i=void 0))}else{if(h<1)throw new Error("Too few arguments provided");return h===1?(a=i,i=l=void 0):h===2&&!i.getContext&&(l=a,a=i,i=void 0),new Promise(function(f,b){try{const y=t.create(a,l);f(s(y,i,l))}catch(y){b(y)}})}try{const f=t.create(a,l);c(null,s(f,i,l))}catch(f){c(f)}}return $e.create=t.create,$e.toCanvas=o.bind(null,n.render),$e.toDataURL=o.bind(null,n.renderToDataURL),$e.toString=o.bind(null,function(s,i,a){return r.render(s,a)}),$e}var Ji=Yi();const Xi=lo(Ji),Gi=({episode:e,speakersMap:t,paragraphs:n,selectedSegments:r,showTranslations:o,ref:s})=>{const i=u.useRef(null),a=hr(e.channel.image),l=u.useMemo(()=>r.sort((v,I)=>v.segmentIndex-I.segmentIndex),[r]),c=u.useMemo(()=>{if(!l.length)return;const I=[l[0].segmentIndex-2,l[0].segmentIndex-1].filter(g=>g>=0).map(g=>n[g]).filter(g=>typeof g.speaker=="number");if(I.length)return I.map((g,p)=>N.jsxs("div",{className:"mt-5 opacity-40",children:[N.jsx("div",{className:"font-medium",children:t[g.speaker]?.name}),N.jsx("div",{className:"mt-1",children:At(g.sentences.map(w=>w.text))})]},p))},[l,n,t]),d=u.useMemo(()=>{if(!l.length)return;const I=[l[l.length-1].segmentIndex+1,l[l.length-1].segmentIndex+2].filter(g=>g<n.length).map(g=>({segmentIndex:g,segment:n[g]})).filter(g=>typeof g.segment.speaker=="number");if(I.length)return I.map(({segmentIndex:g,segment:p},w)=>{const x=t[p.speaker]?.name,M=g-1,D=n[M]?.speaker,A=t[D]?.name;return N.jsxs("div",{className:"mt-5 opacity-40",children:[A!==x&&x&&N.jsxs("div",{className:"font-medium",children:[x," :"]}),N.jsx("div",{className:"mt-1",children:At(p.sentences.map(T=>T.text))})]},w)})},[l,n,t]);u.useMemo(()=>e.ai?.audioDuration||e.itunesDuration,[e]),u.useMemo(()=>{const v=r[0]?.segmentIndex;return v?n[v].sentences[0].start:void 0},[r]);const h=u.useRef(null),[m,f]=u.useState(!1);u.useEffect(()=>{h.current?.addEventListener("load",()=>{f(!0)})},[]);const b=Do(async()=>await Xi.toDataURL(`https://scripod.com/episode/${e.id}?utm_source=share-transcript-card`,{margin:0,errorCorrectionLevel:"low"}),[]),[y,E]=u.useState(),[S,R]=u.useState(!1);u.useImperativeHandle(s,()=>({shareImageUrl:y,isGenerating:S}),[y,S]);const C=u.useCallback(async()=>{if(i.current){R(!0);try{const{snapdom:v}=await uo(async()=>{const{snapdom:w}=await import("./snapdom-Djw2CRx0.js").then(x=>x.s);return{snapdom:w}},__vite__mapDeps([0,1,2])),g=await(await v(i.current,{embedFonts:!0,dpr:window.devicePixelRatio,scale:2})).toBlob({type:"png"}),p=URL.createObjectURL(g);E(p)}catch(v){console.error("Failed to generate image:",v)}finally{R(!1)}}},[]);return u.useEffect(()=>()=>{y&&URL.revokeObjectURL(y)},[y]),u.useEffect(()=>{m&&b.value&&C()},[b.value,m,C,o]),N.jsxs("div",{className:"relative rounded-2xl overflow-clip",children:[N.jsx("div",{className:"absolute z-50 inset-0 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.3)] rounded-2xl pointer-events-none"}),N.jsx("div",{className:"antialiased relative",children:N.jsxs("div",{ref:i,className:Oe("px-3 py-3 bg-[hsl(var(--episode-bg-card))] text-[hsl(var(--episode-text))] overflow-clip"),style:{"--episode-vibrant":a?.vibrantSafe,"--episode-bg-card":a?.backgroundCardShare,"--episode-bg":a?.backgroundMuted,"--episode-text":a?.text,"--theme-blend-mode":a?.cardTheme==="dark"?"plus-lighter":"plus-darker"},children:[N.jsxs("div",{className:"flex gap-4 items-end",children:[N.jsx(fo,{src:e.channel.image||"",className:"w-16 rounded",ref:h}),N.jsxs("div",{className:"flex-1 min-w-0",children:[N.jsx("h2",{className:"text-xs opacity-50 truncate [mix-blend-mode:var(--theme-blend-mode)]",children:e.channel.title}),N.jsx("h1",{className:"font-medium text-md line-clamp-2 leading-tight mt-1",children:e.title})]})]}),N.jsx("div",{className:Oe("relative p-2 pb-24 mt-3",c&&"pt-16"),children:N.jsxs("div",{className:"relative",children:[N.jsx("div",{className:"absolute bottom-full w-full pb-4 mask-[linear-gradient(to_top,white,transparent_5rem)]",children:c}),N.jsx("div",{className:"absolute top-full w-full mask-[linear-gradient(to_bottom,white,transparent_6rem)]",children:d}),l.map(({segmentIndex:v,translate:I},g)=>{const p=n[v],w=t[p.speaker]?.name,x=r[g-1]?.segmentIndex,M=n[x]?.speaker,D=M!==void 0&&t[M]?.name;return N.jsxs("div",{className:"mt-5",children:[D!==w&&w&&N.jsxs("div",{className:"font-medium opacity-80 [mix-blend-mode:var(--theme-blend-mode)] subpixel-antialiased",children:[w," :"]}),N.jsx("div",{className:"mt-1 opacity-80 [mix-blend-mode:var(--theme-blend-mode)]",children:At(p.sentences.map(A=>A.text))}),I&&o&&N.jsx("div",{className:Oe("text-sm mt-1.5 -mx-1.5 px-2 py-1  rounded-md ",a?.cardTheme==="dark"?"bg-black/40 text-white":"bg-white/30 text-black/80"),children:N.jsx("div",{className:"opacity-80 [mix-blend-mode:var(--theme-blend-mode)]`",children:I})})]},g)})]})}),N.jsxs("div",{className:"flex items-end",children:[N.jsxs("div",{className:"-ml-3 -mb-1 flex items-end",children:[a?.cardTheme==="dark"?N.jsx(sn.scripod,{className:"size-14"}):N.jsx(sn.scripodDark,{className:"size-14"}),N.jsx("div",{className:"text-xs mb-0.5 -ml-1 opacity-50 [mix-blend-mode:var(--theme-blend-mode)]",children:"Generated by Scripod.com"})]}),N.jsx("div",{className:"size-16 ml-auto bg-white rounded p-1 bottom-3 right-3",children:N.jsx("div",{className:"size-full bg-black",children:N.jsx("img",{src:b.value,alt:"QR Code"})})})]})]})})]})},Wi=({episode:e,speakersMap:t,paragraphs:n,selectedSegments:r})=>{const[o,s]=u.useState(!1),i=u.useMemo(()=>r.some(b=>b.translate),[r]),a=u.useMemo(()=>N.jsx("div",{className:"flex items-center gap-2",children:i&&N.jsxs(N.Fragment,{children:[N.jsx("span",{className:"text-sm opacity-50",children:"Show Translations"}),N.jsx(Ro,{checked:o,onCheckedChange:s})]})}),[i,o]),[l,c]=u.useState(),[d,h]=u.useState(!1),m=u.useMemo(()=>"ontouchstart"in window||"ontouchstart"in document.documentElement,[]),f=u.useMemo(()=>N.jsxs("div",{className:"flex justify-between items-center w-full",children:[a,m?N.jsx(_e,{className:"rounded-full",disabled:d||!l,loading:d,onClick:async()=>{if(navigator.share&&navigator.canShare)try{const b=await fetch(l).then(E=>E.blob()),y=new File([b],"share-card.png",{type:"image/png"});if(navigator.canShare({files:[y]})){await navigator.share({files:[y],title:"Share Card"});return}}catch{}},children:"Save Image"}):N.jsx(_e,{className:"rounded-full",disabled:d||!l,loading:d,onClick:()=>{if(!l)return;const b=document.createElement("a");b.href=l,b.download="share-image.png",b.click()},children:"Save Image"})]}),[a,m,l,d]);return co({title:"Share",children:N.jsx(Gi,{episode:e,speakersMap:t,paragraphs:n,selectedSegments:r,showTranslations:o,ref:b=>{c(b?.shareImageUrl),h(b?.isGenerating||!1)}}),footer:f},[f])};function la(){return N.jsx(Qi,{})}function on(e,t,n,r){if(n&&n.start<=t&&n.end>t)return n;let o=0,s=e.length-1,i=0;for(;o<=s;){if(i=Math.floor((o+s)/2),e[i].start<=t&&e[i].end>t)return e[i];e[i].start>t?s=i-1:o=i+1}if(r){if(s<0)return e[0];if(o>=e.length)return e[e.length-1];{const a=Math.abs(e[o-1].end-t),l=Math.abs(e[s+1].start-t);return a<l?e[o-1]:e[s+1]}}}const Qi=()=>{const e=ho(),{eid:t}=go({from:"/episode/$eid"}),{episode:n,highlightsWithDai:r}=xn(),o=mo(),{data:s}=Eo({queryKey:["episode",t,"transcript"],queryFn:async()=>await xo({data:{eid:t}}).then(B=>B.json()).catch(B=>{throw po.error(JSON.parse(B.message).message),o.removeQueries({queryKey:["episode",t,"transcript"]}),B}),staleTime:"static"}),{audio:i,playEpisode:a,episode:l,daiDetected:c,daiStatus:d,daiAlign:h,status:m,audioDuration:f,audioDurationRatio:b=1}=vo({episode:n})||{},y=u.useMemo(()=>h?.dynamic?Di(s,h.dynamic):s,[s,h?.dynamic]),{segments:E,speakers:S}=y||{},R=hr(n?.channel.image),C=u.useMemo(()=>{if(!R)return;const B=["#df696d","#82dd84","#7ed1ff","#C994F8","#dab73b","#ee7d55"],L=new Map(B.map(V=>[dt(V).h,V])),O=dt(`hsl(${R?.vibrantSafe})`).h,P=E?.map(V=>V.speaker).filter((V,we,Ee)=>Ee.indexOf(V)===we),_=Array.from(L.keys()).reduce((V,we)=>Math.abs(we-O)<Math.abs(V-O)?we:V);return L.set(_,`hsl(${R.vibrantSafe})`),P?.reduce((V,we,Ee)=>{if(we===null)return V;const Re=Array.from(L.keys());if(Re.length===0)return V[String(we)]="#aaaaaa",V;const Ae=Re.reduce((ve,Je)=>Math.abs(Je-O)<Math.abs(ve-O)?Je:ve),ut=L.get(Ae);return L.delete(Ae),V[String(we)]=ut,V},{null:"#aaaaaa"})},[R,E]),v=u.useMemo(()=>E?.map(O=>O.speaker)?.reduce((O,P,_)=>(P===null||(O[P]={id:String(P),name:S?.[P]||null}),O),{}),[S,E]),[I,g]=u.useState(v);u.useEffect(()=>{g(v)},[v]);const p=u.useMemo(()=>E.flatMap((B,L)=>{const P=So(B.sentences).map(_=>({speaker:B.speaker,sentences:_.map(G=>({...G,start:h?.aToB(G.start)??G.start,end:h?.aToB(G.end)??G.end,origStart:G.start,origEnd:G.end})).filter(G=>f?G.start<=f:!0)})).filter(_=>{if(!_.sentences.length)return!1;if(_.speaker===null){const G=_.sentences[0].start;return _.sentences[_.sentences.length-1].end-Math.max(0,G)>8}return!!_.sentences.length});return P.length?(L===0&&B.speaker===null&&(P[0].sentences[0].start=0),L===E.length-1&&B.speaker===null&&f&&(P[0].sentences[0].end=f),P):[]}),[E,h,f]),w=u.useRef(!0),x=u.useMemo(()=>p?.flatMap((B,L)=>B.sentences.map(({start:O,end:P},_)=>({start:O,end:P,segmentIndex:L,sentenceIndex:_}))),[p]),{scroller:M}=bo(),{scrollTo:D}=xn()||{},A=u.useRef(!1),T=u.useCallback(async(B,L)=>{J(B),A.current=!0;const O=B.start/b;n&&await a(n,O,{awaitResume:!0}),A.current=!1},[n,a,b]),[k,J]=u.useState(),ne=u.useRef(k);ne.current=k;const{hash:$}=yo(),[me,oe]=u.useState(!1);u.useEffect(()=>{oe(!0)},[]),u.useEffect(()=>{if(!w.current||!x)return;let B;if($&&/^(\d{1,2}:)?\d{2}:\d{2}$/.test($)){B=Sn($)*(b||1),e.navigate({to:"/episode/$eid/transcript",params:{eid:t},search:P=>P,hash:"",replace:!0});const O=on(x,B,void 0,!0);if(!O)return;requestAnimationFrame(()=>{D?.(`segment-${O.segmentIndex}`,{smooth:!!me,offset:window.innerHeight*-.2})});return}if(me)return;if(n.id===l?.id&&(B=i.currentTime),B)B*=b;else return;const L=on(x,B,void 0,!0);L&&M&&requestAnimationFrame(()=>{D?.(`segment-${L.segmentIndex}`,{smooth:!1,offset:window.innerHeight*-.2})})},[me,$,x,i,l,n,D,M,e,b]),u.useEffect(()=>{if(!M)return;const B=()=>{q.current=!0},L=()=>{q.current=!1};return M.addEventListener("_scrollbegin",B),M.addEventListener("_scrollend",L),()=>{M.removeEventListener("_scrollbegin",B),M.removeEventListener("_scrollend",L)}},[M]),u.useLayoutEffect(()=>{if(n?.id!==l?.id||!x)return;const B=()=>{A.current||J(L=>{const O=on(x,i.currentTime*b,L,!0)||ne.current&&{...ne.current,sentenceIndex:1/0};return!L||Object.entries(L).some(([_,G])=>O?.[_]!==G)?O:L})};return B(),i.addEventListener("timeupdate",B),()=>{i.removeEventListener("timeupdate",B)}},[i,x,n,l,b]);const le=u.useCallback(B=>{const L=B.getBoundingClientRect(),O=window.innerHeight||document.documentElement.clientHeight;return!(L.bottom<0||L.top>O)},[]),{setCurrentId:ce}=wo(),q=u.useRef(!1);u.useEffect(()=>{if(!l||n?.id!==l?.id||!p||!M||c&&d==="pending"||(ce(`segment-${k?.segmentIndex}`),q.current))return;const B=k?.segmentIndex?document.getElementById(`segment-${k.segmentIndex}`):void 0;B&&le(B)&&k?.segmentIndex&&D?.(`segment-${k?.segmentIndex}`,{smooth:!0,offset:window.innerHeight*-.2})},[n,q,l,k?.segmentIndex,le,ce,D,m,M,p,c,d]);const[ee,ue]=u.useState(!1),pe=u.useCallback(()=>{ue(!0)},[]),X=u.useMemo(()=>{if(C)return Object.entries(C).reduce((B,[L,O])=>({...B,[`--color-${L}`]:O,[`--color-${L}-secondary`]:(()=>{const P=dt(O);return P.l=P.l*.75,P.c=P.c*.75,Cn(P)})(),[`--color-${L}-bg`]:(()=>{const P=dt(O);return P.l=P.l*.35,P.c=P.c*.35,Cn(P)})()}),{})},[C]),Q=u.useMemo(()=>{if(!p)return;if(!r)return p;const B=r.map(P=>({...P,start:Sn(P.time)}));let L;const O=(P,_)=>{if(B.length&&!(typeof L=="number"&&_-L<=2)&&B[0].start<P)return L=_,B.splice(0,1)[0]};return p.map((P,_)=>({...P,highlight:P.speaker!==null?O(P.sentences[P.sentences.length-1].end,_):void 0}))},[p,r]),[z,H]=u.useState(!1),j=u.useCallback(()=>{H(!0)},[]),[de,re]=u.useState([]),{renderDialog:Ie,openDialog:fe}=Wi({episode:n,speakersMap:I,paragraphs:p,selectedSegments:de});u.useEffect(()=>{re([])},[p]);const Ne=u.useCallback(()=>{fe()},[]),Me=u.useCallback(B=>{const{segmentIndex:L,translate:O}=B;re(P=>P.some(_=>_.segmentIndex===L)?P.filter(_=>_.segmentIndex!==L):[...P,{segmentIndex:L,translate:O}])},[fe]),lt=u.useMemo(()=>new Set(de.map(B=>B.segmentIndex)),[de]),ct=u.useMemo(()=>z&&Fe.createPortal(N.jsxs("div",{className:"flex mb-2 justify-center gap-2 bottom-[calc(100%+0.5rem)] border border-foreground/20 rounded-2xl p-2 bg-background/50 backdrop-blur-xl",children:[N.jsx(_e,{className:"rounded-full",onClick:()=>{H(!1),re([])},children:"Cancel"}),N.jsxs(_e,{className:"rounded-full",onClick:Ne,disabled:!de.length,children:["Share Selected",N.jsx("div",{className:"text-xs rounded-full bg-background text-foreground flex items-center justify-center size-5 -mr-2 ml-1",children:de.length})]})]}),document.getElementById("audio-player-top-slot")),[z,de]);return N.jsxs("div",{className:"antialiased",style:X,children:[I&&N.jsx(Ri,{episodeId:t,open:ee,setOpen:ue,speakersMapRaw:v,speakersMap:I,colorScheme:C,setSpeakersMap:B=>{g(B)}}),Ie(),ct,Q?.map((B,L)=>B.speaker!==null?N.jsx(Co,{id:`segment-${L}`,episodeId:n.id,segmentIndex:L,sentenceIndex:L===k?.segmentIndex?k.sentenceIndex:void 0,highlight:B.highlight,audio:i,seek:T,segment:B,speaker:B.speaker!==null?I?.[B.speaker]:void 0,openSpeakerEditDialog:pe,isContinuousSpeaker:p?.[L-1]?.speaker===B.speaker,daiAlign:h,daiDetected:c&&d!=="error",showActions:!0,durationRatio:b,selectingMode:z,enableSelectingMode:j,selected:lt.has(L),toggleSelect:Me},`${L}${h?"-dai":""}`):N.jsx(Io,{id:`segment-${L}`,segmentIndex:L,sentenceIndex:L===k?.segmentIndex?k.sentenceIndex:void 0,audio:i,seek:T,segment:B,daiAlign:h,daiDetected:c&&d!=="error",selectingMode:z},`${L}${h?"-dai":""}`))]})};export{la as component,on as findTimestampIndex};
