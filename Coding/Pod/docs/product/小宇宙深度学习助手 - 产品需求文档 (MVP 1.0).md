# 小宇宙深度学习助手 - 产品需求文档 (MVP 1.0) - 优化版

## 📋 文档版本信息
- **版本日期**：2026-01-19
- **产品负责人**：James
- **开发模式**：Dogfooding（产品经理首先自己使用）
- **优化说明**：基于实际需求讨论，聚焦核心价值，明确MVP边界

---

## 1. 产品愿景（精简版）

**核心价值**：将播客的"流式听觉"转化为"结构化知识"，打造沉浸式深度学习工作台。

**产品哲学**：简单 - 专注于一个功能并做到极致，而不是做加法。

**MVP目标**：验证"转录→展示→播放"的核心链路可行性，达到85%准确率。

---

## 2. 目标用户与场景

### 2.1 第一阶段：单用户验证
- **核心用户**：James（产品经理本人）
- **验证标准**：满足自己的需求和使用标准后，再考虑开放给其他人

### 2.2 典型使用场景
1. **深度学习**：收听专业知识类播客（技术、商业、思维模型）
2. **内容沉淀**：将碎片化音频转化为可检索的文字笔记
3. **精准引用**：通过时间戳快速定位和回溯关键观点

---

## 3. MVP 1.0 功能边界

### 🔴 第一周目标（核心链路验证）
| 功能模块 | 具体内容 | 验收标准 |
|---------|---------|---------|
| **URL解析** | 粘贴小宇宙链接，爬取音频地址、封面、时长 | 成功率 ≥ 90% |
| **ASR转录** | 调用豆包ASR，获取词级时间戳数据 | 准确率 ≥ 80% |
| **播放器** | 基础音频播放功能 | 流畅无卡顿 |
| **逐字稿展示** | 显示转录文字，展示每个词的时间戳信息 | 实时展示 |

### 🟡 第二周目标（体验增强，按需迭代）
- 双向联动播放（点击文字跳转播放，播放时文字自动滚动）
- 笔记与AI纠偏（选中文字生成引用+GLM纠偏）
- AI对话助手（基于播客内容的问答）

### 🔵 第三周及以后（待定）
- 根据实际使用反馈决定优先级

### 🚀 未来升级计划（最终目标）
#### 🎯 句子级精准跳转
**功能描述**：实现句子级别的精准时间戳跳转，提供更精细化的音频-文本同步体验。

**用户价值**：
- 点击任意句子，音频直接跳转到该句子开始位置
- 悬停高亮显示当前句子
- 支持快速浏览和精准引用

**技术挑战**：
- 如何从ASR返回的段落级数据中提取句子级时间戳
- 如何在保持准确性的同时实现平滑的用户体验
- 如何与现有的段落级播放逻辑兼容

**参考实现**：调研同类产品（如Scripod、Descript等）的句子级同步机制。

**实施状态**：待技术路线讨论与验证

---

## 4. 技术架构设计

### 4.1 技术选型

| 层级 | 技术栈 | 理由 |
|------|--------|------|
| **前端** | React + TypeScript | 组件化开发，生态丰富，适合复杂交互 |
| **后端** | Python (Flask/FastAPI) + Playwright | 爬虫生态成熟，开发效率高 |
| **存储** | LocalStorage | 单用户MVP，无需数据库，降低复杂度 |
| **ASR引擎** | 豆包ASR（主）+ 阿里云Qwen（备） | 双引擎热备，提高可用性 |
| **AI模型** | 智谱GLM-4 | 按需纠偏，成本可控 |

### 4.2 部署方案

**阿里云配置（MVP阶段单用户）**：

| 组件 | 配置 | 月成本 | 说明 |
|------|------|--------|------|
| ECS服务器 | 1核2GB | ¥30-50 | 跑Python后端服务 |
| OSS对象存储 | 40GB | ¥10-20 | 存储转录结果（可选） |
| 域名 | .com | ¥60/年 | 可选，本地开发先用IP |
| **总计** | - | **¥50-80/月** | MVP阶段够用 |

**省钱建议**：前端可用Vercel免费托管，只把后端API部署在阿里云。

### 4.3 数据流转

```
用户粘贴小宇宙URL
    ↓
后端爬虫解析（Playwright）
    ↓
获取audio_url + 元数据
    ↓
调用豆包ASR（词级时间戳）
    ↓
存储到LocalStorage
    ↓
前端展示逐字稿 + 播放器
```

---

## 5. 核心功能详细定义

### 5.1 URL解析与爬虫

**输入**：小宇宙节目链接（如：`https://xiaoyuzhoufm.com/episode/xxx`）

**输出数据结构**：
```json
{
  "audio_url": "https://cdn.xxxx.com/audio.mp3",
  "duration": 3600,
  "cover_image": "https://cdn.xxxx.com/cover.jpg",
  "show_notes": "节目介绍文字...",
  "episode_title": "第123期：深度学习实践"
}
```

**异常处理**：
- 禁止使用"网络错误"等模糊字眼
- 必须透传具体错误码：
  - `Error 403`：反爬虫机制拦截
  - `Error 404`：节目URL已失效
  - `Error 504`：CDN音频流拉取超时
- 前端以"调试日志"形式展示，方便快速定位问题

**爬虫策略**：
- 直接爬取，承担风险（MVP阶段优先验证可行性）
- 技术方案：Playwright模拟浏览器

### 5.2 ASR转录核心契约

**Token-Level数据结构**（必须包含）：
```json
{
  "words": [
    {
      "text": "深度",
      "start": 1234,
      "end": 1456,
      "speaker": "Speaker 0"
    },
    {
      "text": "学习",
      "start": 1457,
      "end": 1689,
      "speaker": "Speaker 0"
    }
  ],
  "total_duration": 3600,
  "asr_engine": "doubao"
}
```

**双引擎容错策略**：
1. 首选豆包ASR
2. 若30秒内未响应或异常，自动切换阿里云Qwen
3. 后台记录切换日志（用于监控和优化）

### 5.3 播放器基础功能

**第一周MVP功能**：
- ▶️ 播放/暂停
- ⏩ 进度条拖动
- 🔊 音量控制
- ⏱️ 当前播放时间/总时长显示

**第一周后迭代**：
- 逐字稿点击跳转播放
- 播放时文字自动滚动高亮

### 5.4 逐字稿展示

**展示格式**：
```
[Speaker 0] 00:05:23
深度学习是人工智能的一个分支，它模仿人脑的工作方式...

[Speaker 1] 00:05:45
是的，而且它在图像识别领域取得了突破性进展...
```

**交互设计**：
- 第一周：静态展示
- 第二周：点击时间戳跳转播放器位置

---

## 6. AI纠偏策略（第二周功能）

### 6.1 触发机制
**按需纠偏**：用户选中某段文字点击"Note"时触发

**原因**：
- ✅ 节省成本（不调用GLM时不产生费用）
- ✅ 用户体验可控（需要时才优化）
- ✅ 可观察效果（对比原始和纠偏后的差异）

### 6.2 纠偏逻辑

**上下文范围**：选中段落 + 前后50个词

**纠偏准则**：
1. **语义对齐**：修正同音异义词（如"第一性源理" → "第一性原理"）
2. **逻辑断句**：补全缺失的标点符号（逗号、问号、感叹号）
3. **口语去噪**：剔除无意义的"气口"（连续的"然后"、"那个"、"呃..."）
4. **原意保留**：严禁改变说话人的核心观点和独特语感

### 6.3 成本控制
- 豆包ASR：按量计费（约¥0.01/分钟）
- GLM-4纠偏：按需调用（仅用户点击Note时）
- 预计单集播客成本：¥0.3-1.0（根据时长）

---

## 7. 数据存储方案

### 7.1 存储位置
**LocalStorage**（浏览器本地存储）

**优势**：
- ✅ 无需后端数据库，降低开发成本
- ✅ 单用户MVP完全够用
- ✅ 响应速度快

**劣势**：
- ⚠️ 清除浏览器数据会丢失
- ⚠️ 换设备无法同步

**数据结构**：
```json
{
  "episodes": [
    {
      "id": "episode_123",
      "url": "https://xiaoyuzhoufm.com/episode/xxx",
      "title": "第123期：深度学习实践",
      "transcript": {...},
      "notes": [...],
      "created_at": "2026-01-19T10:00:00Z"
    }
  ]
}
```

### 7.2 数据备份
**导出功能**（可选）：
- 支持导出为Markdown格式
- 包含时间戳和笔记引用
- 用户可手动备份到本地文件

---

## 8. 质量目标与验收标准

### 8.1 准确率目标
**MVP第一阶段**：综合准确率 ≥ 85%

**计算方式**：
- ASR原始准确率：≥ 80%
- AI纠偏提升：+ 5%
- **最终效果**：大部分内容准确，偶尔需要手动修正

### 8.2 性能指标
| 指标 | 目标值 | 说明 |
|------|--------|------|
| URL解析速度 | < 5秒 | 从粘贴链接到获取音频地址 |
| ASR转录速度 | 0.5x实时 | 60分钟音频约30分钟完成 |
| 播放器响应延迟 | < 100ms | 点击播放按钮到音频启动 |
| 逐字稿加载时间 | < 2秒 | 完整加载所有转录文字 |

### 8.3 兼容性测试
- ✅ Chrome（主力浏览器）
- ✅ Safari（macOS/iOS）
- ⚠️ Edge、Firefox（后续测试）

---

## 9. 开发计划（3周迭代）

### Week 1：核心链路打通（第1-7天）
**目标**：验证"转录→展示→播放"可行性

| 角色 | 任务 | 交付物 |
|------|------|--------|
| **后端** | 小宇宙爬虫 + 豆包ASR集成 | API接口 |
| **前端** | 播放器 + 逐字稿展示组件 | React组件 |
| **产品** | 定义测试播客列表（3-5个） | 测试用例 |

**验收标准**：
- ✅ 能够粘贴小宇宙链接并成功转录
- ✅ 逐字稿正常展示
- ✅ 播放器能正常播放音频

### Week 2：体验增强（第8-14天）
**目标**：双向联动 + AI纠偏

| 角色 | 任务 | 交付物 |
|------|------|--------|
| **后端** | GLM纠偏接口 + RAG对话 | API接口 |
| **前端** | 双向联动交互 + 笔记组件 | React组件 |
| **产品** | 使用3-5集播客进行深度测试 | 反馈报告 |

**验收标准**：
- ✅ 点击文字能跳转播放位置
- ✅ 播放时文字自动滚动高亮
- ✅ 选中文字能生成笔记引用

### Week 3：打磨与优化（第15-21天）
**目标**：视觉优化 + 极限测试

| 角色 | 任务 | 交付物 |
|------|------|--------|
| **设计** | Tailwind样式规范 | 设计系统 |
| **前端** | UI动画 + 交互细节优化 | 最终版本 |
| **全栈** | 压力测试（180分钟+长播客） | 性能报告 |

**验收标准**：
- ✅ 虚拟列表渲染超长播客不卡顿
- ✅ AI纠偏准确率达到85%+
- ✅ 用户体验流畅自然

---

## 10. 风险与应对

### 10.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 小宇宙反爬虫升级 | 中 | 高 | 快速响应爬虫策略，考虑用户上传方案 |
| ASR准确率不达标 | 低 | 中 | 双引擎热备，后续切换自建模型 |
| 阿里云成本超支 | 低 | 低 | 设置用量监控和告警 |

### 10.2 产品风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 实际使用频率低于预期 | 中 | 低 | Dogfooding阶段验证需求真实性 |
| AI纠偏效果不理想 | 中 | 中 | 保留原始转录，提供纠偏开关 |

---

## 11. 成功指标（MVP阶段）

### 11.1 技术指标
- ✅ 端到端转录成功率 ≥ 90%
- ✅ 综合准确率 ≥ 85%
- ✅ 播放器无卡顿

### 11.2 产品指标（单用户验证）
- ✅ 至少完成5集不同类型播客的转录
- ✅ 实际使用中发现3-5个可优化点
- ✅ 愿意继续使用并向朋友推荐

---

## 附录A：测试播客列表（产品准备）

MVP测试需要准备3-5个不同类型的播客：

| 类型 | 推荐节目 | 时长 | 难度 |
|------|---------|------|------|
| 单人播讲 | 待补充 | 30-60分钟 | ⭐ |
| 访谈类 | 待补充 | 60-90分钟 | ⭐⭐ |
| 闲聊类 | 待补充 | 90-120分钟 | ⭐⭐⭐ |
| 技术类 | 待补充 | 60分钟+ | ⭐⭐⭐⭐ |

---

## 附录B：术语表

- **ASR**：Automatic Speech Recognition，自动语音识别
- **Token-Level**：词级别的转录精度（包含每个词的时间戳）
- **GLM**：智谱AI的语言模型
- **RAG**：Retrieval-Augmented Generation，检索增强生成
- **Dogfooding**：开发者使用自己的产品进行测试
- **SSE**：Server-Sent Events，服务器推送事件
- **Virtual List**：虚拟列表，只渲染可见区域的DOM节点

---

## 文档变更记录

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| 2026-01-19 | v1.0 | 初始版本 | James |
| 2026-01-19 | v1.1 | 基于需求讨论优化，明确MVP边界和技术选型 | James + Claude |
