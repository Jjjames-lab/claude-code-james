# LLM æ€§èƒ½ä¼˜åŒ–è®¡åˆ’ - è§£å†³é€Ÿç‡é™åˆ¶å’Œç­‰å¾…æ—¶é—´é—®é¢˜

> **æ—¥æœŸ**: 2026-01-26
> **å½“å‰çŠ¶æ€**: LLM åˆ†å—å¤„ç†å·²å®ç°ï¼Œä½†å­˜åœ¨é€Ÿç‡é™åˆ¶å’Œç­‰å¾…æ—¶é—´é—®é¢˜

---

## ğŸ“‹ é—®é¢˜åˆ†æ

### é—®é¢˜ 1: é€Ÿç‡é™åˆ¶çš„æ ¹æœ¬åŸå› 

**å½“å‰å®ç°**ï¼š
- æ¨¡å‹ï¼š`glm-4-flash`
- é™åˆ¶ï¼š300-400 å­—ç¬¦/è¯·æ±‚
- ç°è±¡ï¼šå¿«é€Ÿè¿ç»­è¯·æ±‚è¢«æ‹’ç»

**éœ€è¦è°ƒç ”**ï¼š
1. GLM-4-flash æ˜¯å…è´¹æ¨¡å‹ï¼Œå¯èƒ½æœ‰ä¸¥æ ¼é€Ÿç‡é™åˆ¶
2. æ˜¯å¦åˆ‡æ¢åˆ°ä»˜è´¹æ¨¡å‹ï¼ˆå¦‚ glm-4ã€glm-4-plusï¼‰èƒ½æå‡é™åˆ¶ï¼Ÿ
3. ä¸åŒæ¨¡å‹çš„ QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿ

### é—®é¢˜ 2: ç”¨æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿

**å½“å‰æ–¹æ¡ˆæ—¶é—´æˆæœ¬**ï¼š
```
5000 å­—ç¬¦æ’­å®¢ â†’ 20 å— Ã— 2 ç§’å»¶è¿Ÿ = 40 ç§’
10000 å­—ç¬¦æ’­å®¢ â†’ 40 å— Ã— 2 ç§’å»¶è¿Ÿ = 80 ç§’
```

**ç”¨æˆ·ä½“éªŒå½±å“**ï¼š
- ASR è½¬å½•ï¼š10-30 ç§’
- LLM å¤„ç†ï¼š40-80 ç§’ï¼ˆç”šè‡³æ›´é•¿ï¼‰
- æ€»è®¡ï¼š50-110 ç§’ï¼ˆæ¥è¿‘ 2 åˆ†é’Ÿï¼‰

---

## âœ… è°ƒç ”ç»“æœï¼ˆå·²å®Œæˆï¼‰

### å‘ç° 1: GLM-4-Flash æ”¯æŒ 5 ä¸ªå¹¶å‘è¯·æ±‚ï¼

**å…³é”®ä¿¡æ¯**ï¼š
- å…è´¹ç”¨æˆ·å¹¶å‘é™åˆ¶ï¼š**5 ä¸ªåŒæ—¶è¯·æ±‚**
- ä¸éœ€è¦å‡çº§åˆ°ä»˜è´¹æ¨¡å‹ï¼
- æ¥æºï¼š[æ™ºè°±AIæ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/models/text/glm-4)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/717498590)

**å½±å“**ï¼š
```
ä¸²è¡Œå¤„ç†ï¼ˆå½“å‰ï¼‰ï¼š
å—1 â†’ ç­‰å¾…2ç§’ â†’ å—2 â†’ ç­‰å¾…2ç§’ â†’ å—3 ...
æ€»æ—¶é—´ï¼š20 å— Ã— 2 ç§’ = 40 ç§’

å¹¶å‘å¤„ç†ï¼ˆä¼˜åŒ–åï¼‰ï¼š
å—1-5 åŒæ—¶ â†’ ç­‰å¾…2ç§’ â†’ å—6-10 åŒæ—¶ â†’ ...
æ€»æ—¶é—´ï¼š4 æ‰¹ Ã— 2 ç§’ = 8 ç§’ï¼ˆå‡å°‘ 80%ï¼ï¼‰
```

### å‘ç° 2: GLM API å®Œå…¨æ”¯æŒæµå¼å“åº”ï¼

**å…³é”®ä¿¡æ¯**ï¼š
- å‚æ•°ï¼š`"stream": true`
- æ ¼å¼ï¼šSSE (Server-Sent Events)
- å¢é‡ä¼ è¾“ï¼šè¾¹ç”Ÿæˆè¾¹è¿”å›
- æ¥æºï¼š[æ™ºè°±AIæµå¼æ¶ˆæ¯æ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/capabilities/streaming)

**å®ç°ç¤ºä¾‹**ï¼š
```python
response = client.chat.completions.create(
    model="glm-4-flash",
    messages=[...],
    stream=True  # å¯ç”¨æµå¼è¾“å‡º
)

for chunk in response:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)
```

### å‘ç° 3: è¯·æ±‚å¤§å°é™åˆ¶

- å•è¯·æ±‚é™åˆ¶ï¼šçº¦ 300-400 å­—ç¬¦ï¼ˆå®é™…æµ‹è¯•ç»“æœï¼‰
- è§£å†³æ–¹æ¡ˆï¼šå½“å‰å·²å®ç° 250 å­—ç¬¦åˆ†å—

---

## ğŸ¯ æœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆï¼ˆåŸºäºè°ƒç ”ç»“æœï¼‰

### æ–¹æ¡ˆï¼šå¹¶å‘å¤„ç† + æµå¼å“åº” + è¿›åº¦æ˜¾ç¤º

**ä¼˜åŠ¿**ï¼š
1. âœ… **æ— éœ€å‡çº§æ¨¡å‹** - ä¿æŒ glm-4-flash å…è´¹ä½¿ç”¨
2. âœ… **æ—¶é—´å‡å°‘ 80%** - ä» 40-80 ç§’é™åˆ° 8-16 ç§’
3. âœ… **ä½“éªŒæä½³** - è¾¹æ¥æ”¶è¾¹æ˜¾ç¤ºï¼Œå®æ—¶è¿›åº¦

**å®ç°ç­–ç•¥**ï¼š

#### 1. æ™ºèƒ½å¹¶å‘å¤„ç†ï¼ˆåŠ¨æ€é€‚åº”ï¼‰

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š
- âœ… é…ç½®åŒ–å¹¶å‘æ•°ï¼ˆé»˜è®¤ 5ï¼Œå¯è°ƒæ•´ï¼‰
- âœ… è‡ªåŠ¨é™çº§æœºåˆ¶ï¼ˆè§¦å‘é™åˆ¶æ—¶é™ä½å¹¶å‘ï¼‰
- âœ… æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ1ç§’ â†’ 2ç§’ â†’ 4ç§’ï¼‰
- âœ… å®æ—¶ç›‘æ§å’Œæ—¥å¿—

**å®ç°ä»£ç **ï¼š
```python
class AdaptiveConcurrencyProcessor:
    """è‡ªé€‚åº”å¹¶å‘å¤„ç†å™¨"""

    def __init__(self, max_concurrent: int = 5, min_concurrent: int = 1):
        self.max_concurrent = max_concurrent  # æœ€å¤§å¹¶å‘æ•°ï¼ˆå¯é…ç½®ï¼‰
        self.min_concurrent = min_concurrent  # æœ€å°å¹¶å‘æ•°
        self.current_concurrent = max_concurrent  # å½“å‰å¹¶å‘æ•°
        self.consecutive_errors = 0  # è¿ç»­é”™è¯¯è®¡æ•°

    async def process_chunks_adaptive(self, chunks):
        """è‡ªé€‚åº”å¹¶å‘å¤„ç†"""
        results = []

        for i in range(0, len(chunks), self.current_concurrent):
            batch = chunks[i:i+self.current_concurrent]

            try:
                # å°è¯•å¹¶å‘å¤„ç†
                batch_results = await self._process_batch_with_timeout(batch)
                results.extend(batch_results)

                # æˆåŠŸåé‡ç½®é”™è¯¯è®¡æ•°
                self.consecutive_errors = 0

                # æ‰¹æ¬¡é—´ç­‰å¾…
                if i + self.current_concurrent < len(chunks):
                    await asyncio.sleep(2)

            except (RateLimitError, ConnectionError) as e:
                # è§¦å‘é€Ÿç‡é™åˆ¶ï¼Œé™ä½å¹¶å‘æ•°
                self.consecutive_errors += 1
                self._adjust_concurrency_down()
                logger.warning(f"è§¦å‘é™åˆ¶ï¼Œé™ä½å¹¶å‘è‡³ {self.current_concurrent}")

                # ç­‰å¾…åé‡è¯•
                await asyncio.sleep(self._get_backoff_time())
                # é‡æ–°å¤„ç†å½“å‰æ‰¹æ¬¡
                batch_results = await self._process_batch_sequential(batch)
                results.extend(batch_results)

        return results

    def _adjust_concurrency_down(self):
        """é™ä½å¹¶å‘æ•°"""
        self.current_concurrent = max(
            self.min_concurrent,
            self.current_concurrent // 2  # å‡åŠ
        )

    def _get_backoff_time(self) -> float:
        """è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰"""
        return min(2 ** self.consecutive_errors, 10)  # æœ€å¤š 10 ç§’
```

**å…³é”®ä¼˜åŠ¿**ï¼š
1. **å¯é…ç½®**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ `GLM_MAX_CONCURRENT` æ§åˆ¶
2. **è‡ªé€‚åº”**ï¼šé‡åˆ°é™åˆ¶è‡ªåŠ¨é™çº§ï¼ˆ5 â†’ 3 â†’ 1ï¼‰
3. **å¯æ¢å¤**ï¼šç¨³å®šåå¯ä»¥é€æ­¥æå‡å¹¶å‘æ•°
4. **å¥å£®æ€§**ï¼šæ— è®º GLM å¦‚ä½•è°ƒæ•´é™åˆ¶ï¼Œéƒ½èƒ½æ­£å¸¸å·¥ä½œ

**ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```bash
# .env
GLM_MAX_CONCURRENT=5  # å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
GLM_MIN_CONCURRENT=1
GLM_RETRY_DELAYS=1,2,4  # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
```

#### 2. æµå¼å“åº”
```python
async def process_chunk_streaming(chunk):
    """æµå¼å¤„ç†å•ä¸ªå—"""
    async with client.stream("POST", url, json={...}) as response:
        async for line in response.aiter_lines():
            if line.startswith("data: "):
                chunk_data = json.loads(line[6:])
                if chunk_data["choices"][0]["delta"]["content"]:
                    # å®æ—¶è¿”å›å¢é‡å†…å®¹
                    yield chunk_data["choices"][0]["delta"]["content"]
```

#### 3. å‰ç«¯è¿›åº¦æ˜¾ç¤º
- WebSocket è¿æ¥æ¥æ”¶å®æ—¶è¿›åº¦
- æ˜¾ç¤ºï¼š"æ­£åœ¨å¤„ç†ç¬¬ 5/20 å—..."
- è¿›åº¦æ¡å¯è§†åŒ–
- æ–‡æœ¬é€æ­¥æ˜¾ç¤ºï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰

---

### é”™è¯¯å¤„ç†å’Œç›‘æ§

**å¼‚å¸¸ç±»å‹è¯†åˆ«**ï¼š
```python
class RateLimitError(Exception):
    """é€Ÿç‡é™åˆ¶é”™è¯¯"""
    pass

class ConnectionError(Exception):
    """è¿æ¥é”™è¯¯"""
    pass

class TimeoutError(Exception):
    """è¶…æ—¶é”™è¯¯"""
    pass
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- å½“å‰å¹¶å‘æ•°
- æˆåŠŸ/å¤±è´¥è¯·æ±‚æ•°
- å¹³å‡å“åº”æ—¶é—´
- è§¦å‘é™çº§æ¬¡æ•°

**æ—¥å¿—ç¤ºä¾‹**ï¼š
```
[INFO] å¼€å§‹å¤„ç† 20 ä¸ªæ–‡æœ¬å—ï¼Œå½“å‰å¹¶å‘æ•°: 5
[INFO] æ‰¹æ¬¡ 1/4 å®Œæˆ (5ä¸ªå—å¹¶å‘)ï¼Œè€—æ—¶ 2.3 ç§’
[WARNING] è§¦å‘é€Ÿç‡é™åˆ¶ï¼Œé™ä½å¹¶å‘è‡³ 3
[INFO] æ‰¹æ¬¡ 2/5 å®Œæˆ (3ä¸ªå—å¹¶å‘)ï¼Œè€—æ—¶ 3.1 ç§’
[INFO] æ‰€æœ‰å—å¤„ç†å®Œæˆï¼Œæ€»è€—æ—¶: 12.4 ç§’ï¼Œé™çº§æ¬¡æ•°: 1
```

---

## ğŸ’¡ ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ A: å‡çº§æ¨¡å‹ + å¹¶å‘å¤„ç†ï¼ˆæ¨èï¼‰

**å‰æ**ï¼š
- GLM-4 æˆ– GLM-4-plus æ”¯æŒæ›´é«˜ QPS
- API å…è®¸å¹¶å‘è¯·æ±‚

**å®ç°**ï¼š
1. åˆ‡æ¢åˆ° `glm-4` æˆ– `glm-4-plus`
2. å®ç°å¹¶å‘å¤„ç†ï¼ˆå¦‚åŒæ—¶å‘é€ 5 ä¸ªå—ï¼‰
3. å‡å°‘å—é—´å»¶è¿Ÿåˆ° 0.5 ç§’

**é¢„æœŸæ•ˆæœ**ï¼š
```
5000 å­—ç¬¦æ’­å®¢ï¼š40 ç§’ â†’ 8 ç§’ï¼ˆå‡å°‘ 80%ï¼‰
10000 å­—ç¬¦æ’­å®¢ï¼š80 ç§’ â†’ 16 ç§’ï¼ˆå‡å°‘ 80%ï¼‰
```

**æˆæœ¬**ï¼š
- GLM-4 ä»·æ ¼ï¼šÂ¥1/ç™¾ä¸‡ tokensï¼ˆ10å€æˆæœ¬ï¼Œä½†ä»å¾ˆä¾¿å®œï¼‰
- 10000 å­—ç¬¦çº¦ 5000 tokens â‰ˆ Â¥0.005

---

### æ–¹æ¡ˆ B: ä¿æŒå…è´¹æ¨¡å‹ + æµå¼å¤„ç†

**å‰æ**ï¼š
- GLM-4-flash æ”¯æŒæµå¼å“åº”

**å®ç°**ï¼š
1. ä¿®æ”¹ä¸ºæµå¼ API è°ƒç”¨
2. å‰ç«¯è¾¹æ¥æ”¶è¾¹æ˜¾ç¤ºï¼ˆç±»ä¼¼ ChatGPTï¼‰
3. ä¿æŒä¸²è¡Œå¤„ç†å’Œ 2 ç§’å»¶è¿Ÿ

**é¢„æœŸæ•ˆæœ**ï¼š
- æ€»æ—¶é—´ä¸å˜ï¼Œä½†ç”¨æˆ·ä½“éªŒæ›´å¥½
- çœ‹åˆ°æ–‡å­—é€æ­¥å‡ºç°ï¼Œå‡å°‘ç„¦è™‘æ„Ÿ

**æˆæœ¬**ï¼š
- Â¥0.1/ç™¾ä¸‡ tokensï¼ˆä¿æŒæœ€ä½ï¼‰

---

### æ–¹æ¡ˆ C: æ··åˆæ–¹æ¡ˆ - å¹¶å‘ + æµå¼ + æ™ºèƒ½åˆ†å—

**å®ç°**ï¼š
1. æµ‹è¯• API å®é™… QPS é™åˆ¶
2. åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼ˆé¿å…è§¦å‘é™åˆ¶ï¼‰
3. æµå¼è¿”å› + è¿›åº¦æ¡
4. å‰ç«¯æ˜¾ç¤ºå¤„ç†è¿›åº¦ï¼š"æ­£åœ¨å¤„ç†ç¬¬ 5/20 å—..."

**é¢„æœŸæ•ˆæœ**ï¼š
- æœ€ä¼˜æ€§èƒ½
- æœ€ä½³ç”¨æˆ·ä½“éªŒ
- æœ€ä½æˆæœ¬ï¼ˆä¿æŒ glm-4-flashï¼‰

---

## ğŸ”¬ è°ƒç ”è®¡åˆ’

### ç¬¬ä¸€æ­¥ï¼šGLM API æ–‡æ¡£è°ƒç ”

**éœ€è¦æŸ¥æ‰¾çš„ä¿¡æ¯**ï¼š
1. è®¿é—®æ™ºè°± AI å®˜æ–¹æ–‡æ¡£
2. æŸ¥æ‰¾ä¸åŒæ¨¡å‹çš„é€Ÿç‡é™åˆ¶è¯´æ˜
3. æŸ¥æ‰¾å¹¶å‘è¯·æ±‚æ”¯æŒæƒ…å†µ
4. æŸ¥æ‰¾æµå¼ API ä½¿ç”¨æ–¹æ³•

**æœç´¢å…³é”®è¯**ï¼š
- "æ™ºè°± GLM API é€Ÿç‡é™åˆ¶"
- "GLM-4-flash QPS é™åˆ¶"
- "GLM API å¹¶å‘è¯·æ±‚"
- "GLM streaming API"

### ç¬¬äºŒæ­¥ï¼šå®é™…æµ‹è¯•

**æµ‹è¯• 1: å¹¶å‘è¯·æ±‚æµ‹è¯•**
```python
# åŒæ—¶å‘é€ 5 ä¸ªè¯·æ±‚ï¼Œæµ‹è¯•æ˜¯å¦è¢«é™åˆ¶
import asyncio
async def test_concurrent():
    tasks = [process_chunk(chunk) for chunk in chunks[:5]]
    await asyncio.gather(*tasks)
```

**æµ‹è¯• 2: æµå¼ API æµ‹è¯•**
```python
# æµ‹è¯•æµå¼å“åº”æ˜¯å¦å¯ç”¨
async with client.stream("POST", url, json=payload) as response:
    async for chunk in response.aiter_text():
        print(chunk)  # é€æ­¥æ¥æ”¶
```

**æµ‹è¯• 3: ä¸åŒæ¨¡å‹å¯¹æ¯”**
- æµ‹è¯• glm-4-flash vs glm-4 çš„å®é™… QPS
- è®°å½•å¤±è´¥çš„è¯·æ±‚å’ŒåŸå› 

---

## ğŸ“Š æˆæœ¬æ•ˆç›Šåˆ†æ

### å½“å‰æ–¹æ¡ˆï¼ˆglm-4-flash + ä¸²è¡Œï¼‰

| æ’­å®¢é•¿åº¦ | å­—ç¬¦æ•° | å¤„ç†æ—¶é—´ | æˆæœ¬ |
|---------|--------|---------|------|
| 5åˆ†é’Ÿ   | ~3000  | 24ç§’    | Â¥0.0003 |
| 10åˆ†é’Ÿ  | ~6000  | 48ç§’    | Â¥0.0006 |
| 30åˆ†é’Ÿ  | ~18000 | 144ç§’   | Â¥0.0018 |
| 60åˆ†é’Ÿ  | ~36000 | 288ç§’   | Â¥0.0036 |

### æ–¹æ¡ˆ Aï¼ˆglm-4 + å¹¶å‘ï¼‰

| æ’­å®¢é•¿åº¦ | å­—ç¬¦æ•° | å¤„ç†æ—¶é—´ | æˆæœ¬ |
|---------|--------|---------|------|
| 5åˆ†é’Ÿ   | ~3000  | 6ç§’     | Â¥0.003 |
| 10åˆ†é’Ÿ  | ~6000  | 12ç§’    | Â¥0.006 |
| 30åˆ†é’Ÿ  | ~18000 | 36ç§’    | Â¥0.018 |
| 60åˆ†é’Ÿ  | ~36000 | 72ç§’    | Â¥0.036 |

**ç»“è®º**ï¼šå³ä½¿æˆæœ¬å¢åŠ  10 å€ï¼Œä»ç„¶éå¸¸ä¾¿å®œï¼ˆ60åˆ†é’Ÿæ’­å®¢çº¦ Â¥0.036ï¼‰

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### çŸ­æœŸï¼ˆç«‹å³å®æ–½ï¼‰

**æ–¹æ¡ˆ Bï¼šæµå¼å¤„ç† + è¿›åº¦æ˜¾ç¤º**

**ç†ç”±**ï¼š
1. ä¸å¢åŠ æˆæœ¬
2. æ”¹å–„ç”¨æˆ·ä½“éªŒ
3. å®ç°ç›¸å¯¹ç®€å•

**å®ç°å†…å®¹**ï¼š
- [ ] ä¿®æ”¹ GLM å®¢æˆ·ç«¯æ”¯æŒæµå¼å“åº”
- [ ] å‰ç«¯æ·»åŠ  WebSocket æˆ– SSE è¿æ¥
- [ ] æ˜¾ç¤ºå¤„ç†è¿›åº¦ï¼ˆ5/20 å—ï¼‰
- [ ] è¾¹æ¥æ”¶è¾¹æ˜¾ç¤ºæ–‡æœ¬

### é•¿æœŸï¼ˆè°ƒç ”åå®æ–½ï¼‰

**æ–¹æ¡ˆ A æˆ– Cï¼šå¹¶å‘å¤„ç†**

**å‰ææ¡ä»¶**ï¼š
1. è°ƒç ”å‘ç° glm-4 æ”¯æŒæ›´é«˜ QPS
2. æˆ– glm-4-flash æœ¬èº«æ”¯æŒé€‚åº¦å¹¶å‘

**å®ç°å†…å®¹**ï¼š
- [ ] å®ç°å¹¶å‘è¯·æ±‚é˜Ÿåˆ—
- [ ] åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼ˆ3-5 ä¸ªï¼‰
- [ ] é”™è¯¯é‡è¯•å’Œé™çº§æœºåˆ¶
- [ ] æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—

---

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: å¹¶å‘å¤„ç†å®ç°ï¼ˆ2-3 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
1. ä¿®æ”¹ `glm_client.py` çš„ `_process_chunks` æ–¹æ³•
2. å®ç°å¹¶å‘è¯·æ±‚ï¼ˆ5 ä¸ªä¸€æ‰¹ï¼‰
3. æµ‹è¯•å¹¶å‘æ˜¯å¦è§¦å‘é€Ÿç‡é™åˆ¶
4. æ·»åŠ é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶

**å…³é”®æ–‡ä»¶**ï¼š
- `åç«¯Backend/backend/app/services/llm/glm_client.py`

**é¢„æœŸæ•ˆæœ**ï¼š
```
5000 å­—ç¬¦ï¼š40 ç§’ â†’ 8 ç§’ï¼ˆå‡å°‘ 80%ï¼‰
10000 å­—ç¬¦ï¼š80 ç§’ â†’ 16 ç§’ï¼ˆå‡å°‘ 80%ï¼‰
```

---

### é˜¶æ®µ 2: æµå¼å“åº”å®ç°ï¼ˆ2-3 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
1. ä¿®æ”¹ GLM å®¢æˆ·ç«¯æ”¯æŒæµå¼ API
2. æ·»åŠ  WebSocket æˆ– SSE æ¨é€åˆ°å‰ç«¯
3. å‰ç«¯å®æ—¶æ˜¾ç¤ºè¿›åº¦å’Œæ–‡æœ¬
4. ä¼˜åŒ–åŠ è½½åŠ¨ç”»å’Œæç¤ºæ–‡æ¡ˆ

**å…³é”®æ–‡ä»¶**ï¼š
- `åç«¯Backend/backend/app/services/llm/glm_client.py`
- `åç«¯Backend/backend/app/api/routes/llm.py`
- `å‰ç«¯ Frontend/pod-studio/src/pages/HomePage.tsx`

**é¢„æœŸæ•ˆæœ**ï¼š
- ç”¨æˆ·çœ‹åˆ°å®æ—¶è¿›åº¦ï¼š"æ­£åœ¨å¤„ç†ç¬¬ 5/20 å—..."
- æ–‡æœ¬é€æ­¥æ˜¾ç¤ºï¼Œç±»ä¼¼ ChatGPT
- å‡å°‘ç­‰å¾…ç„¦è™‘æ„Ÿ

---

### é˜¶æ®µ 3: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
1. ç«¯åˆ°ç«¯æµ‹è¯•ä¸åŒé•¿åº¦æ’­å®¢
2. **æµ‹è¯•å¹¶å‘é™çº§æœºåˆ¶**ï¼š
   - æ¨¡æ‹Ÿé€Ÿç‡é™åˆ¶ï¼ˆæ•…æ„è®¾ç½®é«˜å¹¶å‘ï¼‰
   - éªŒè¯è‡ªåŠ¨é™çº§æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - éªŒè¯é™çº§åèƒ½å¦ç»§ç»­å¤„ç†
3. **æµ‹è¯•è¾¹ç•Œæƒ…å†µ**ï¼š
   - æœ€å¤§å¹¶å‘æ•°è°ƒæ•´æµ‹è¯•ï¼ˆ5 â†’ 10 â†’ 20ï¼‰
   - GLM API é™åˆ¶å˜åŒ–æµ‹è¯•
   - ç½‘ç»œå¼‚å¸¸æ¢å¤æµ‹è¯•
4. æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—è®°å½•
5. æ–‡æ¡£æ›´æ–°

**æµ‹è¯•ç”¨ä¾‹**ï¼š
```python
# æµ‹è¯• 1: æ­£å¸¸å¹¶å‘ï¼ˆ5 ä¸ªï¼‰
async def test_normal_concurrency():
    """éªŒè¯ 5 ä¸ªå¹¶å‘æ˜¯å¦æ­£å¸¸å·¥ä½œ"""
    processor = AdaptiveConcurrencyProcessor(max_concurrent=5)
    chunks = create_test_chunks(2500)  # 10 ä¸ªå—
    results = await processor.process_chunks_adaptive(chunks)
    assert len(results) == 10
    assert processor.current_concurrent == 5  # æœªé™çº§

# æµ‹è¯• 2: æ¨¡æ‹Ÿé€Ÿç‡é™åˆ¶
async def test_rate_limit_handling():
    """éªŒè¯é‡åˆ°é™åˆ¶æ—¶çš„é™çº§"""
    processor = AdaptiveConcurrencyProcessor(max_concurrent=10)
    # æ¨¡æ‹Ÿè§¦å‘é™åˆ¶...
    assert processor.current_concurrent < 10  # å·²é™çº§

# æµ‹è¯• 3: é…ç½®å˜æ›´
async def test_config_change():
    """éªŒè¯ä¿®æ”¹ GLM_MAX_CONCURRENT æ˜¯å¦ç”Ÿæ•ˆ"""
    os.environ['GLM_MAX_CONCURRENT'] = '3'
    processor = AdaptiveConcurrencyProcessor()
    assert processor.max_concurrent == 3
```

**äº¤ä»˜ç‰©**ï¼š
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- ä¼˜åŒ–åçš„ä»£ç å’Œæ–‡æ¡£
- å¹¶å‘é™çº§æ—¥å¿—åˆ†æ

---

## ğŸ“Š è°ƒç ”ä¿¡æ¯æ¥æº

- [æ™ºè°±AI GLM-4 æ¨¡å‹æ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/models/text/glm-4)
- [æ™ºè°±AIæµå¼æ¶ˆæ¯æ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/capabilities/streaming)
- [çŸ¥ä¹ï¼š9 å®¶å…è´¹ AI å¤§æ¨¡å‹ API ç›˜ç‚¹](https://zhuanlan.zhihu.com/p/717498590)
- [æ™ºè°±AIæ‰¹é‡å¤„ç†æ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/tools/batch)

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**å½“å‰çŠ¶æ€**ï¼š
- âœ… è°ƒç ”å·²å®Œæˆ
- âœ… ä¼˜åŒ–æ–¹æ¡ˆå·²æ˜ç¡®
- âœ… æ— éœ€å‡çº§ä»˜è´¹æ¨¡å‹
- â³ ç­‰å¾…ç”¨æˆ·æµè§ˆå™¨æµ‹è¯•ç»“æœ

**åç»­æ­¥éª¤**ï¼š
1. ç”¨æˆ·åœ¨æµè§ˆå™¨æµ‹è¯•å½“å‰å®ç°ï¼ˆä¸²è¡Œå¤„ç†ï¼‰
2. æ ¹æ®æµ‹è¯•ç»“æœå’Œç”¨æˆ·åé¦ˆå†³å®šï¼š
   - æ˜¯å¦ç«‹å³å®æ–½å¹¶å‘ä¼˜åŒ–ï¼ˆæ—¶é—´ä¼˜å…ˆï¼‰
   - æˆ–è€…å…ˆæ·»åŠ æµå¼æ˜¾ç¤ºï¼ˆä½“éªŒä¼˜å…ˆï¼‰
   - æˆ–è€…ä¸¤è€…éƒ½å®æ–½

**å…³é”®å‘ç°**ï¼š
> GLM-4-Flash å…è´¹ç”¨æˆ·æ”¯æŒ **5 ä¸ªå¹¶å‘è¯·æ±‚**ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†å¤„ç†æ—¶é—´å‡å°‘ **80%** è€Œæ— éœ€å¢åŠ æˆæœ¬ï¼

---

# å°å®‡å®™æ·±åº¦å­¦ä¹ åŠ©æ‰‹ - Scripod å¯¹æ ‡äº§å“æ–‡æ¡£

> **ç ”ç©¶æ—¥æœŸ**: 2026-01-26
> **ç ”ç©¶æ·±åº¦**: æ¯›å­”çº§åˆ«çš„é¢—ç²’åº¦
> **å¯¹æ ‡äº§å“**: Scripod (https://scripod.com/)
> **ç›®æ ‡**: å®Œç¾å¤åˆ»å°å®‡å®™æ’­å®¢å·¥å…·

---

## ğŸ“‹ äº§å“æ¦‚è¿°

### Scripod äº§å“å®šä½
- **Slogan**: "the reading-first workspace for your favorite podcasts"
- **å‰¯æ ‡é¢˜**: "Your AI-powered podcast copilot"
- **æ ¸å¿ƒç†å¿µ**: ä»¥é˜…è¯»ä½“éªŒä¸ºæ ¸å¿ƒçš„æ’­å®¢å·¥å…·

### å°å®‡å®™æ·±åº¦å­¦ä¹ åŠ©æ‰‹å¯¹æ ‡å®šä½
- **ç›®æ ‡**: å®Œç¾å¤åˆ» Scripod çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- **ç‰¹è‰²**: æ·±åº¦æ•´åˆå°å®‡å®™æ’­å®¢ç”Ÿæ€
- **ä¼˜åŠ¿**:
  - æ”¯æŒå°å®‡å®™èŠ‚ç›®å•ï¼ˆshownoteï¼‰å®Œæ•´å‘ˆç°
  - ç²¾å‡†çš„å¥å­çº§è·³è½¬ï¼ˆåŸºäºè±†åŒ… ASRï¼‰
  - å¤šå¼•æ“è½¬å½•ä¿éšœï¼ˆè±†åŒ…ä¸» + åƒé—®å¤‡ï¼‰

---

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### æ•´ä½“è®¾è®¡é£æ ¼
åŸºäº Scripod çš„ç•Œé¢åˆ†æï¼Œé‡‡ç”¨**æç®€ä¸»ä¹‰**è®¾è®¡è¯­è¨€ï¼š

#### 1. è‰²å½©ç³»ç»Ÿ
```css
ä¸»è‰²è°ƒ:
- ä¸»è“è‰²: #3B82F6 (äº¤äº’æŒ‰é’®ã€é“¾æ¥)
- è¾…åŠ©è“è‰²: #60A5FA (æ‚¬åœçŠ¶æ€)
- æ·±è“è‰²: #1E40AF (æ ‡é¢˜ã€å¼ºè°ƒ)

ä¸­æ€§è‰²:
- çº¯é»‘: #000000 (ä¸»æ ‡é¢˜)
- æ·±ç°: #1F2937 (å‰¯æ ‡é¢˜ã€æ–‡æœ¬)
- ä¸­ç°: #6B7280 (æ¬¡è¦æ–‡æœ¬ã€å ä½ç¬¦)
- æµ…ç°: #9CA3AF (è¾¹æ¡†ã€åˆ†å‰²çº¿)
- ææµ…ç°: #F9FAFB (èƒŒæ™¯è‰²ã€å¡ç‰‡èƒŒæ™¯)
- çº¯ç™½: #FFFFFF (ä¸»èƒŒæ™¯)

çŠ¶æ€è‰²:
- æˆåŠŸç»¿: #10B981
- è­¦å‘Šæ©™: #F59E0B
- é”™è¯¯çº¢: #EF4444
```

#### 2. å­—ä½“ç³»ç»Ÿ
```css
å­—ä½“æ—:
- ä¸»å­—ä½“: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif
- ç­‰å®½å­—ä½“: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace (ä»£ç ã€æ—¶é—´æˆ³)

å­—ä½“å¤§å°:
- æ ‡é¢˜ (H1): 28px / 32px (è¡Œé«˜), 700 (å­—é‡)
- æ ‡é¢˜ (H2): 24px / 28px, 600
- æ ‡é¢˜ (H3): 20px / 24px, 600
- å¤§æ ‡é¢˜ (Section): 18px / 22px, 600
- æ­£æ–‡: 16px / 24px, 400
- å°å­—: 14px / 20px, 400
- æå°å­—: 12px / 16px, 400

å­—ä½“é¢œè‰²:
- ä¸»æ ‡é¢˜: #000000
- å‰¯æ ‡é¢˜: #1F2937
- æ­£æ–‡: #374151
- æ¬¡è¦æ–‡æœ¬: #6B7280
- é“¾æ¥: #3B82F6
```

#### 3. é—´è·ç³»ç»Ÿ
```css
åŸºç¡€é—´è·å•ä½: 4px

é—´è·è§„èŒƒ:
- xs: 4px
- sm: 8px
- md: 12px
- lg: 16px
- xl: 20px
- 2xl: 24px
- 3xl: 32px
- 4xl: 40px
- 5xl: 48px

ç»„ä»¶å†…è¾¹è·:
- å¡ç‰‡: 24px
- æŒ‰é’®: 12px 20px (å‚ç›´ æ°´å¹³)
- è¾“å…¥æ¡†: 12px 16px

ç»„ä»¶å¤–è¾¹è·:
- åŒºå—é—´éš”: 32px
- å…ƒç´ é—´éš”: 16px
- ç»†åˆ†ç»„: 8px
```

#### 4. åœ†è§’ç³»ç»Ÿ
```css
- å°: 4px (æŒ‰é’®ã€å°æ ‡ç­¾)
- ä¸­: 8px (å¡ç‰‡ã€è¾“å…¥æ¡†)
- å¤§: 12px (å¤§å¡ç‰‡)
- åœ†å½¢: 50% (å¤´åƒã€å›¾æ ‡æŒ‰é’®)
```

#### 5. é˜´å½±ç³»ç»Ÿ
```css
- æµ…é˜´å½±: 0 1px 2px rgba(0, 0, 0, 0.05)
- ä¸­é˜´å½±: 0 4px 6px rgba(0, 0, 0, 0.07)
- æ·±é˜´å½±: 0 10px 15px rgba(0, 0, 0, 0.1)
- æ‚¬æµ®é˜´å½±: 0 20px 25px rgba(0, 0, 0, 0.1)
```

---

## ğŸ“± æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### æ¨¡å— 1: Overviewï¼ˆæ¦‚è§ˆï¼‰

**åŠŸèƒ½æè¿°**:
å±•ç¤ºæ’­å®¢èŠ‚ç›®çš„æ ¸å¿ƒä¿¡æ¯ï¼Œç±»ä¼¼äº Scripod çš„é¦–é¡µå¡ç‰‡è®¾è®¡ã€‚

**UI ç»“æ„**:
```tsx
interface OverviewData {
  podcastName: string;        // æ’­å®¢åç§°
  episodeTitle: string;       // èŠ‚ç›®æ ‡é¢˜
  episodeDescription: string; // èŠ‚ç›®æè¿°
  coverImage: string;        // å°é¢å›¾ (æ­£æ–¹å½¢)
  duration: number;           // æ—¶é•¿ (ç§’)
  publishDate: string;       // å‘å¸ƒæ—¥æœŸ
  hostName: string;         // ä¸»æŒäºº
  tags: string[];           // æ ‡ç­¾
}

<div className="overview-section">
  <div className="cover-container">
    <img src={coverImage} alt={episodeTitle} />
  </div>
  <div className="info-container">
    <h1>{episodeTitle}</h1>
    <p className="podcast-name">{podcastName}</p>
    <p className="description">{episodeDescription}</p>
    <div className="meta-info">
      <span className="duration">{formatDuration(duration)}</span>
      <span className="separator">â€¢</span>
      <span className="date">{publishDate}</span>
    </div>
    <div className="tags">
      {tags.map(tag => (
        <span key={tag} className="tag">{tag}</span>
      ))}
    </div>
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
- å°é¢å›¾å°ºå¯¸: 120px Ã— 120px (æ­£æ–¹å½¢)
- å°é¢å›¾åœ†è§’: 8px
- æ ‡é¢˜ä¸å°é¢å›¾é—´è·: 16px
- æ ‡é¢˜ä¸æè¿°é—´è·: 12px
- æè¿°ä¸å…ƒä¿¡æ¯é—´è·: 16px
- å…ƒä¿¡æ¯é¢œè‰²: #6B7280 (æ¬¡è¦æ–‡æœ¬)

**äº¤äº’è¡Œä¸º**:
- æ‚¬åœå°é¢å›¾: è½»å¾®æ”¾å¤§ (scale: 1.05) + é˜´å½±åŠ æ·±
- ç‚¹å‡»å°é¢å›¾: å±•å¼€å¤§å›¾é¢„è§ˆ (æ¨¡æ€æ¡†)

---

### æ¨¡å— 2: Shownoteï¼ˆèŠ‚ç›®å•ï¼‰

**åŠŸèƒ½æè¿°**:
å®Œç¾å¤åˆ»å°å®‡å®™èŠ‚ç›®å•ï¼Œæ”¯æŒå¯Œæ–‡æœ¬å†…å®¹ã€å›¾ç‰‡ã€æ®µè½ã€åˆ†è¡Œç­‰ã€‚

**æ ¸å¿ƒè¦æ±‚**:
- âœ… **å®Œæ•´ä¿ç•™æ ¼å¼**: å›¾ç‰‡ã€æ®µè½ã€åˆ†è¡Œã€åŠ ç²—ã€æ–œä½“ç­‰
- âœ… **å›¾æ–‡æ··æ’**: å›¾ç‰‡ä¸æ–‡å­—çš„æ­£ç¡®å¸ƒå±€
- âœ… **é“¾æ¥ä¿ç•™**: ç‚¹å‡»å¯è·³è½¬åŸé“¾æ¥
- âœ… **å°å®‡å®™ç‰¹è‰²**: èŠ‚ç›®å•çš„ç‰¹æ®Šæ ·å¼

**æ•°æ®ç»“æ„**:
```tsx
interface ShownoteBlock {
  type: 'text' | 'image' | 'link' | 'bold' | 'italic' | 'header';
  content: string;
  imageUrl?: string;
  linkUrl?: string;
  style?: {
    fontSize?: string;
    fontWeight?: number;
    color?: string;
  };
}

interface ShownoteData {
  blocks: ShownoteBlock[];
  originalHtml?: string; // ä¿ç•™åŸå§‹ HTML ä»¥ä¾¿ç²¾ç¡®æ¸²æŸ“
}

<div className="shownote-section">
  <h2>èŠ‚ç›®å•</h2>
  <div className="shownote-content">
    {blocks.map((block, index) => {
      switch (block.type) {
        case 'image':
          return (
            <figure key={index} className="image-block">
              <img src={block.imageUrl} alt="" />
              {block.content && <figcaption>{block.content}</figcaption>}
            </figure>
          );

        case 'link':
          return (
            <p key={index} className="link-block">
              <a href={block.linkUrl} target="_blank" rel="noopener noreferrer">
                {block.content}
              </a>
            </p>
          );

        case 'bold':
          return <p key={index} className="bold-text"><strong>{block.content}</strong></p>;

        default:
          return <p key={index}>{block.content}</p>;
      }
    })}
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
```css
.shownote-content {
  font-size: 16px;
  line-height: 1.8;
  color: #374151;
}

.shownote-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 16px 0;
}

.shownote-content p {
  margin: 12px 0;
}

.shownote-content a {
  color: #3B82F6;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-bottom-color 0.2s;
}

.shownote-content a:hover {
  border-bottom-color: #3B82F6;
}

.shownote-content strong {
  font-weight: 600;
  color: #1F2937;
}
```

**æŠ€æœ¯å®ç°è¦ç‚¹**:
1. **HTML è§£æ**: ä½¿ç”¨ DOMParser è§£æåŸå§‹ HTML
2. **å›¾ç‰‡æ‡’åŠ è½½**: ä¼˜åŒ–æ€§èƒ½
3. **å“åº”å¼å›¾ç‰‡**: é€‚é…ç§»åŠ¨ç«¯
4. **é“¾æ¥å®‰å…¨**: `rel="noopener noreferrer"` é˜²æ­¢å®‰å…¨æ¼æ´

---

### æ¨¡å— 3: Highlightsï¼ˆé«˜äº®ï¼‰

**åŠŸèƒ½æè¿°**:
è‡ªåŠ¨æå–æ’­å®¢çš„å…³é”®å†…å®¹å’Œè¦ç‚¹ï¼Œç±»ä¼¼ Scripod çš„ "Highlights & Takeaways"ã€‚

**æ•°æ®æ¥æº**:
- LLM æ™ºèƒ½åˆ†æè½¬å½•æ–‡æœ¬
- æå–å…³é”®å¥å­å’Œæ®µè½
- ç”Ÿæˆè¦ç‚¹æ€»ç»“

**UI ç»“æ„**:
```tsx
interface HighlightItem {
  id: string;
  text: string;
  startTime: number;      // åœ¨éŸ³é¢‘ä¸­çš„èµ·å§‹æ—¶é—´
  endTime: number;        // åœ¨éŸ³é¢‘ä¸­çš„ç»“æŸæ—¶é—´
  importance: number;      // é‡è¦æ€§è¯„åˆ† (1-5)
  category?: string;      // åˆ†ç±» (å¯é€‰)
}

<div className="highlights-section">
  <h2>Highlights</h2>
  <div className="highlights-list">
    {highlights.map((item) => (
      <div key={item.id} className="highlight-item">
        <div className="highlight-content">
          <p>{item.text}</p>
        </div>
        <div className="highlight-meta">
          <button
            className="timestamp-button"
            onClick={() => seekTo(item.startTime)}
          >
            {formatTime(item.startTime)}
          </button>
          <div className="importance-indicator">
            {Array.from({ length: item.importance }).map((_, i) => (
              <span key={i} className="star">â˜…</span>
            ))}
          </div>
        </div>
      </div>
    ))}
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
```css
.highlights-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.highlight-item {
  background: #F9FAFB;
  border-left: 4px solid #3B82F6;
  border-radius: 4px;
  padding: 16px;
  transition: transform 0.2s, box-shadow 0.2s;
}

.highlight-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
}

.highlight-content p {
  font-size: 16px;
  line-height: 1.6;
  color: #1F2937;
  margin: 0 0 12px 0;
}

.highlight-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.timestamp-button {
  font-size: 14px;
  color: #3B82F6;
  background: transparent;
  border: 1px solid #3B82F6;
  border-radius: 4px;
  padding: 4px 12px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.timestamp-button:hover {
  background: #3B82F6;
  color: white;
}

.importance-indicator .star {
  color: #F59E0B;
  font-size: 14px;
}
```

**äº¤äº’è¡Œä¸º**:
- ç‚¹å‡»æ—¶é—´æˆ³: è·³è½¬åˆ°éŸ³é¢‘å¯¹åº”ä½ç½®
- æ‚¬åœé«˜äº®é¡¹: å¡ç‰‡å³ç§» + é˜´å½±åŠ æ·±
- åŒå‡»é«˜äº®é¡¹: æ”¶è—åˆ°ä¹¦ç­¾

---

### æ¨¡å— 4: Transcriptï¼ˆé€å­—ç¨¿ï¼‰

**åŠŸèƒ½æè¿°**:
æ ¸å¿ƒåŠŸèƒ½ï¼Œå±•ç¤ºå¸¦æ—¶é—´æˆ³çš„å®Œæ•´è½¬å½•æ–‡æœ¬ã€‚

**å…³é”®éœ€æ±‚**:
- âœ… **å®Œæ•´æ ‡ç‚¹ç¬¦å·**: LLM éœ€è¦æ·»åŠ æ ‡ç‚¹
- âœ… **å¤šå¥ä¸€æ®µ**: å¤šä¸ªå¥å­åˆå¹¶ä¸ºä¸€ä¸ªæ®µè½
- âœ… **å¥å­çº§è·³è½¬**: ç‚¹å‡»å¥å­è·³è½¬åˆ°éŸ³é¢‘å¯¹åº”ä½ç½®
- âœ… **é¼ æ ‡æ‚¬åœé«˜äº®**: æ‚¬åœæ—¶é«˜äº®æ˜¾ç¤º
- âœ… **è¯´è¯äººè¯†åˆ«**: æ˜¾ç¤ºä¸åŒè¯´è¯äºº

**æ•°æ®ç»“æ„**:
```tsx
interface TranscriptSegment {
  id: string;
  text: string;                    // æ®µè½æ–‡æœ¬ï¼ˆå¤šå¥åˆå¹¶ï¼‰
  startTime: number;               // èµ·å§‹æ—¶é—´ (æ¯«ç§’)
  endTime: number;                 // ç»“æŸæ—¶é—´ (æ¯«ç§’)
  speaker: string;                 // è¯´è¯äºº
  words?: TranscriptWord[];        // è¯çº§æ•°æ® (å¯é€‰)
}

interface TranscriptWord {
  text: string;
  start: number;  // æ¯«ç§’
  end: number;    // æ¯«ç§’
  speaker: string;
}

<div className="transcript-section">
  <div className="transcript-controls">
    <button className="play-all-button">
      <PlayIcon />
      æ’­æ”¾å…¨éƒ¨
    </button>
    <div className="speaker-toggle">
      <label>
        <input type="checkbox" checked={showSpeakers} onChange={() => setShowSpeakers(!showSpeakers)} />
        æ˜¾ç¤ºè¯´è¯äºº
      </label>
    </div>
  </div>

  <div className="transcript-content">
    {segments.map((segment) => (
      <div
        key={segment.id}
        className={`transcript-segment ${segment.speaker}`}
        onClick={() => seekTo(segment.startTime)}
        onMouseEnter={() => setHoveredSegment(segment.id)}
        onMouseLeave={() => setHoveredSegment(null)}
      >
        <div className="segment-meta">
          <span className="timestamp">{formatTime(segment.startTime)}</span>
          {showSpeakers && (
            <span className="speaker-label">{segment.speaker}</span>
          )}
        </div>
        <div className="segment-text">
          {segment.text}
        </div>
      </div>
    ))}
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
```css
.transcript-section {
  background: white;
  border-radius: 12px;
  padding: 24px;
}

.transcript-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #E5E7EB;
}

.play-all-button {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #3B82F6;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
}

.play-all-button:hover {
  background: #2563EB;
}

.transcript-segment {
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
  border-left: 3px solid transparent;
}

.transcript-segment:hover {
  background: #F3F4F6;
  transform: translateX(4px);
}

.transcript-segment.active {
  background: #EFF6FF;
  border-left-color: #3B82F6;
}

.transcript-segment.speaker-A {
  border-left-color: #3B82F6;
}

.transcript-segment.speaker-B {
  border-left-color: #10B981;
}

.segment-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.timestamp {
  font-size: 12px;
  font-family: "SF Mono", Monaco, monospace;
  color: #6B7280;
  background: #F3F4F6;
  padding: 2px 8px;
  border-radius: 4px;
}

.speaker-label {
  font-size: 12px;
  font-weight: 500;
  color: white;
  background: #3B82F6;
  padding: 2px 8px;
  border-radius: 4px;
}

.segment-text {
  font-size: 16px;
  line-height: 1.8;
  color: #1F2937;
}
```

**LLM ä¼˜åŒ– Prompt**:
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ’­å®¢æ–‡æœ¬ä¼˜åŒ–ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹è½¬å½•æ–‡æœ¬è¿›è¡Œä¼˜åŒ–ï¼š

ä¼˜åŒ–è¦æ±‚ï¼š
1. æ·»åŠ å®Œæ•´çš„æ ‡ç‚¹ç¬¦å·ï¼ˆé€—å·ã€å¥å·ã€é—®å·ã€æ„Ÿå¹å·ç­‰ï¼‰
2. å°†å¤šä¸ªç›¸å…³å¥å­åˆå¹¶ä¸ºä¸€ä¸ªè‡ªç„¶æ®µè½ï¼ˆä¸è¦ä¸€å¥ä¸€æ®µï¼‰
3. ä¿®æ­£æ˜æ˜¾çš„è¯­éŸ³è¯†åˆ«é”™è¯¯
4. ä¿æŒåŸå§‹è¯­ä¹‰ä¸å˜
5. ä¸è¦æ·»åŠ é¢å¤–å†…å®¹ï¼Œä»…ä¼˜åŒ–ç°æœ‰æ–‡æœ¬

åŸå§‹è½¬å½•æ–‡æœ¬ï¼š
{rawText}

è¯·è¾“å‡ºä¼˜åŒ–åçš„æ–‡æœ¬ï¼š
```

**äº¤äº’è¡Œä¸º**:
- ç‚¹å‡»æ®µè½: è·³è½¬åˆ°éŸ³é¢‘å¯¹åº”ä½ç½®å¹¶å¼€å§‹æ’­æ”¾
- æ‚¬åœæ®µè½: èƒŒæ™¯è‰²å˜ä¸º #F3F4F6
- æ’­æ”¾è¿›åº¦é«˜äº®: å½“å‰æ’­æ”¾çš„æ®µè½é«˜äº®æ˜¾ç¤º
- åŒå‡»æ®µè½: æ·»åŠ ä¹¦ç­¾

---

### æ¨¡å— 5: Chaptersï¼ˆç« èŠ‚ï¼‰

**åŠŸèƒ½æè¿°**:
è‡ªåŠ¨æˆ–æ‰‹åŠ¨åˆ›å»ºç« èŠ‚ï¼Œæ”¯æŒå¿«é€Ÿè·³è½¬ã€‚

**UI ç»“æ„**:
```tsx
interface Chapter {
  id: string;
  title: string;
  startTime: number;
  endTime?: number;
  description?: string;
  pinCount?: number; // ä¹¦ç­¾æ•°é‡
}

<div className="chapters-section">
  <h2>Chapters</h2>
  <div className="chapters-list">
    {chapters.map((chapter, index) => (
      <div key={chapter.id} className="chapter-item">
        <div className="chapter-number">{index + 1}</div>
        <div className="chapter-content" onClick={() => seekTo(chapter.startTime)}>
          <h3 className="chapter-title">{chapter.title}</h3>
          {chapter.description && (
            <p className="chapter-description">{chapter.description}</p>
          )}
          <div className="chapter-meta">
            <span className="timestamp">{formatTime(chapter.startTime)}</span>
            {chapter.pinCount && (
              <span className="pin-indicator">
                <PinIcon /> {chapter.pinCount}
              </span>
            )}
          </div>
        </div>
      </div>
    ))}
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
```css
.chapters-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.chapter-item {
  display: flex;
  gap: 16px;
  padding: 16px;
  background: white;
  border: 1px solid #E5E7EB;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.chapter-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.chapter-number {
  width: 32px;
  height: 32px;
  background: #3B82F6;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 14px;
  flex-shrink: 0;
}

.chapter-content {
  flex: 1;
}

.chapter-title {
  font-size: 16px;
  font-weight: 600;
  color: #1F2937;
  margin: 0 0 4px 0;
}

.chapter-description {
  font-size: 14px;
  color: #6B7280;
  margin: 0 0 8px 0;
}

.chapter-meta {
  display: flex;
  gap: 16px;
  align-items: center;
}

.pin-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: #6B7280;
}
```

---

### æ¨¡å— 6: Pinsï¼ˆä¹¦ç­¾ï¼‰

**åŠŸèƒ½æè¿°**:
ç”¨æˆ·å¯ä»¥åœ¨ä»»æ„ä½ç½®æ·»åŠ ä¹¦ç­¾ï¼Œæ”¯æŒå¿«é€Ÿè·³è½¬å’Œç¬”è®°ã€‚

**UI ç»“æ„**:
```tsx
interface Pin {
  id: string;
  timestamp: number;
  note: string;
  segmentText?: string; // å½“å‰æ®µè½çš„æ–‡æœ¬
  tags?: string[];      // æ ‡ç­¾
  createdAt: Date;
}

<div className="pins-section">
  <div className="pins-header">
    <h2>Pins</h2>
    <button className="add-pin-button">
      <PlusIcon />
      æ·»åŠ ä¹¦ç­¾
    </button>
  </div>

  <div className="pins-list">
    {pins.map((pin) => (
      <div key={pin.id} className="pin-item">
        <div className="pin-meta">
          <button
            className="timestamp-button"
            onClick={() => seekTo(pin.timestamp)}
          >
            {formatTime(pin.timestamp)}
          </button>
          <span className="created-date">{formatDate(pin.createdAt)}</span>
        </div>
        <div className="pin-content">
          <p>{pin.note}</p>
          {pin.segmentText && (
            <blockquote className="segment-preview">{pin.segmentText}</blockquote>
          )}
          {pin.tags && (
            <div className="tags">
              {pin.tags.map(tag => (
                <span key={tag} className="tag">{tag}</span>
              ))}
            </div>
          )}
        </div>
      </div>
    ))}
  </div>
</div>
```

**æ ·å¼ç»†èŠ‚**:
```css
.pins-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.add-pin-button {
  display: flex;
  align-items: center;
  gap: 8px;
  background: transparent;
  color: #3B82F6;
  border: 1px solid #3B82F6;
  border-radius: 6px;
  padding: 8px 16px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
}

.add-pin-button:hover {
  background: #EFF6FF;
}

.pin-item {
  background: white;
  border: 1px solid #E5E7EB;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
}

.pin-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.segment-preview {
  font-size: 14px;
  color: #6B7280;
  border-left: 3px solid #E5E7EB;
  padding-left: 12px;
  margin: 8px 0;
  font-style: italic;
}

.tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 12px;
}

.tag {
  font-size: 12px;
  color: #3B82F6;
  background: #EFF6FF;
  padding: 4px 8px;
  border-radius: 4px;
}
```

---

### æ¨¡å— 7: ç¿»è¯‘åŠŸèƒ½

**åŠŸèƒ½æè¿°**:
å°†é€å­—ç¨¿ç¿»è¯‘ä¸ºå…¶ä»–è¯­è¨€ï¼Œæ”¯æŒå¤šè¯­è¨€ã€‚

**æ”¯æŒè¯­è¨€**:
- è‹±è¯­ (English)
- æ—¥è¯­ (æ—¥æœ¬èª)
- éŸ©è¯­ (í•œêµ­ì–´)
- æ³•è¯­ (FranÃ§ais)
- è¥¿ç­ç‰™è¯­ (EspaÃ±ol)
- å¾·è¯­ (Deutsch)

**UI ç»“æ„**:
```tsx
interface Translation {
  language: string;
  text: string;
  segments: TranscriptSegment[]; // ç¿»è¯‘åçš„æ®µè½
}

<div className="translation-section">
  <div className="translation-controls">
    <select
      value={selectedLanguage}
      onChange={(e) => setSelectedLanguage(e.target.value)}
      className="language-selector"
    >
      <option value="en">English</option>
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="ko">í•œêµ­ì–´</option>
      <option value="fr">FranÃ§ais</option>
      <option value="es">EspaÃ±ol</option>
      <option value="de">Deutsch</option>
    </select>
    <button
      className="translate-button"
      onClick={handleTranslate}
      disabled={isTranslating}
    >
      {isTranslating ? 'ç¿»è¯‘ä¸­...' : 'ç¿»è¯‘'}
    </button>
  </div>

  {translatedSegments && (
    <div className="translation-content">
      {translatedSegments.map((segment) => (
        <div key={segment.id} className="translated-segment">
          <span className="timestamp">{formatTime(segment.startTime)}</span>
          <span className="text">{segment.text}</span>
        </div>
      ))}
    </div>
  )}
</div>
```

**LLM ç¿»è¯‘ Prompt**:
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ’­å®¢ç¿»è¯‘ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹ä¸­æ–‡æ’­å®¢è½¬å½•æ–‡æœ¬ç¿»è¯‘ä¸º {targetLanguage}ã€‚

ç¿»è¯‘è¦æ±‚ï¼š
1. ä¿æŒåŸæ–‡çš„è¯­æ°”å’Œé£æ ¼
2. ä¿ç•™ä¸“ä¸šæœ¯è¯­çš„å‡†ç¡®æ€§
3. ç¡®ä¿å¥å­é€šé¡ºè‡ªç„¶
4. ä¿æŒæ—¶é—´æˆ³çš„å‡†ç¡®æ€§
5. ä¸è¦æ·»åŠ è§£é‡Šæ€§å†…å®¹

åŸæ–‡ï¼š
{rawText}

è¯·è¾“å‡ºç¿»è¯‘ç»“æœï¼š
```

---

## ğŸ¯ å®Œæ•´å·¥ä½œæµè®¾è®¡

### ç”¨æˆ·æ“ä½œæµç¨‹

```mermaid
graph TD
    A[è¾“å…¥å°å®‡å®™é“¾æ¥] --> B[è§£æèŠ‚ç›®ä¿¡æ¯]
    B --> C[ä¸‹è½½éŸ³é¢‘]
    C --> D[ASR è½¬å½•]
    D --> E[ç”Ÿæˆé€å­—ç¨¿]
    E --> F[LLM ä¼˜åŒ–]
    F --> G[ç”Ÿæˆ Highlights]
    F --> H[æå– Chapters]
    F --> I[åˆ›å»º Overview]
    I --> J[æ˜¾ç¤ºå®Œæ•´é¡µé¢]
```

### æ•°æ®å¤„ç†æµæ°´çº¿

```mermaid
graph LR
    A[ASR è½¬å½•ç»“æœ] --> B[è±†åŒ…å¼•æ“]
    B --> C[utterances æ•°ç»„]
    C --> D[LLM ä¼˜åŒ–]
    D --> E[æ·»åŠ æ ‡ç‚¹]
    D --> F[åˆå¹¶å¥å­]
    D --> G[é”™è¯¯ä¿®æ­£]
    E --> H[æœ€ç»ˆé€å­—ç¨¿]
    F --> H
    G --> H
    H --> I[ç”Ÿæˆ Highlights]
    H --> J[æå– Chapters]
```

---

## ğŸ’» æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### åç«¯ API è®¾è®¡

#### 1. èŠ‚ç›®è§£ææ¥å£
```python
@app.post("/api/v1/episode/parse")
async def parse_episode(url: str):
    """
    è§£æå°å®‡å®™èŠ‚ç›®é“¾æ¥

    è¿”å›:
    {
        "success": true,
        "data": {
            "episode_id": "xxx",
            "audio_url": "xxx",
            "duration": 3600,
            "cover_image": "xxx",
            "shownote": {
                "blocks": [...],
                "original_html": "..."
            },
            "episode_title": "xxx",
            "podcast_name": "xxx"
        }
    }
    """
```

#### 2. é€å­—ç¨¿ä¼˜åŒ–æ¥å£
```python
@app.post("/api/v1/llm/polish")
async def polish_transcript(
    raw_text: str,
    topic: Optional[str] = None,
    keywords: Optional[List[str]] = None,
    stream: bool = False  # æ”¯æŒæµå¼å“åº”
):
    """
    LLM ä¼˜åŒ–é€å­—ç¨¿

    å‚æ•°:
    - raw_text: åŸå§‹è½¬å½•æ–‡æœ¬
    - topic: èŠ‚ç›®ä¸»é¢˜ (å¯é€‰)
    - keywords: å…³é”®è¯ (å¯é€‰)
    - stream: æ˜¯å¦æµå¼è¿”å›

    è¿”å›:
    {
        "polished_text": "ä¼˜åŒ–åçš„æ–‡æœ¬",
        "model": "glm-4-flash",
        "usage": {
            "prompt_tokens": 100,
            "completion_tokens": 200
        }
    }
    """
```

#### 3. Highlights ç”Ÿæˆæ¥å£
```python
@app.post("/api/v1/llm/extract-highlights")
async def extract_highlights(
    transcript: str,
    max_highlights: int = 10
):
    """
    ä»é€å­—ç¨¿ä¸­æå–å…³é”®å†…å®¹

    è¿”å›:
    {
        "highlights": [
            {
                "text": "xxx",
                "start_time": 123000,
                "end_time": 124000,
                "importance": 5
            }
        ]
    }
    """
```

#### 4. Chapters ç”Ÿæˆæ¥å£
```python
@app.post("/api/v1/llm/generate-chapters")
async def generate_chapters(transcript: str):
    """
    è‡ªåŠ¨ç”Ÿæˆç« èŠ‚

    è¿”å›:
    {
        "chapters": [
            {
                "title": "xxx",
                "start_time": 0,
                "description": "xxx"
            }
        ]
    }
    """
```

#### 5. ç¿»è¯‘æ¥å£
```python
@app.post("/api/v1/llm/translate")
async def translate_text(
    text: str,
    target_language: str
):
    """
    ç¿»è¯‘æ–‡æœ¬

    è¿”å›:
    {
        "translated_text": "xxx",
        "language": "en"
    }
    """
```

### å‰ç«¯ç»„ä»¶è®¾è®¡

#### 1. ä¸»é¡µé¢ç»„ä»¶ (HomePage.tsx)
```tsx
interface EpisodeData {
  overview: OverviewData;
  shownote: ShownoteData;
  transcript: TranscriptSegment[];
  highlights: HighlightItem[];
  chapters: Chapter[];
  pins: Pin[];
}

export default function HomePage() {
  const [episodeData, setEpisodeData] = useState<EpisodeData | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // ä¸»æ¸²æŸ“é€»è¾‘
  return (
    <div className="homepage">
      <Header />
      <main className="main-content">
        {loading && <LoadingSpinner />}
        {error && <ErrorMessage message={error} />}
        {episodeData && (
          <>
            <OverviewSection data={episodeData.overview} />
            <Tabs>
              <TabPanel label="Shownote">
                <ShownoteSection data={episodeData.shownote} />
              </TabPanel>
              <TabPanel label="Transcript">
                <TranscriptSection segments={episodeData.transcript} />
              </TabPanel>
              <TabPanel label="Highlights">
                <HighlightsSection highlights={episodeData.highlights} />
              </TabPanel>
              <TabPanel label="Chapters">
                <ChaptersSection chapters={episodeData.chapters} />
              </TabPanel>
              <TabPanel label="Pins">
                <PinsSection pins={episodeData.pins} />
              </TabPanel>
            </Tabs>
          </>
        )}
      </main>
    </div>
  );
}
```

#### 2. éŸ³é¢‘æ’­æ”¾å™¨ç»„ä»¶ (AudioPlayer.tsx)
```tsx
export default function AudioPlayer() {
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const [isPlaying, setIsPlaying] = useState(false);

  const audioRef = useRef<HTMLAudioElement>(null);

  const handleSeek = (time: number) => {
    if (audioRef.current) {
      audioRef.current.currentTime = time / 1000;
      setCurrentTime(time);
    }
  };

  const handleTimeUpdate = () => {
    setCurrentTime(audioRef.current!.currentTime * 1000);
  };

  return (
    <div className="audio-player">
      <audio
        ref={audioRef}
        src={audioUrl}
        onTimeUpdate={handleTimeUpdate}
        onLoadedMetadata={() => setDuration(audioRef.current!.duration * 1000)}
        onEnded={() => setIsPlaying(false)}
      />

      <button
        onClick={() => {
          if (isPlaying) {
            audioRef.current?.pause();
          } else {
            audioRef.current?.play();
          }
          setIsPlaying(!isPlaying);
        }}
      >
        {isPlaying ? <PauseIcon /> : <PlayIcon />}
      </button>

      <div className="progress-bar">
        <div
          className="progress-fill"
          style={{ width: `${(currentTime / duration) * 100}%` }}
        />
      </div>

      <span className="time-display">
        {formatTime(currentTime)} / {formatTime(duration)}
      </span>
    </div>
  );
}
```

---

## ğŸ”§ æ ¸å¿ƒé—®é¢˜è§£å†³

### é—®é¢˜ 1: LLM ä¼˜åŒ–è´¨é‡

**å½“å‰é—®é¢˜**:
- ä½¿ç”¨ AI ä¼˜åŒ–åï¼Œä¾ç„¶æ²¡æœ‰æ ‡ç‚¹ç¬¦å·
- å¤šå¥è¯ä½œä¸ºä¸€æ®µ

**è§£å†³æ–¹æ¡ˆ**:

#### 1.1 ä¼˜åŒ– Prompt
```python
TRANSLATION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ’­å®¢æ–‡æœ¬ä¼˜åŒ–ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹è½¬å½•æ–‡æœ¬è¿›è¡Œä¸¥æ ¼ä¼˜åŒ–ï¼š

æ ¸å¿ƒè¦æ±‚ï¼š
1. **å¿…é¡»æ·»åŠ å®Œæ•´æ ‡ç‚¹ç¬¦å·**ï¼šä¸ºæ¯ä¸ªå¥å­æ·»åŠ é€—å·ã€å¥å·ã€é—®å·ã€æ„Ÿå¹å·ç­‰
2. **å¤šå¥åˆå¹¶æ®µè½**ï¼šå°† 3-5 ä¸ªç›¸å…³å¥å­åˆå¹¶ä¸ºä¸€ä¸ªè‡ªç„¶æ®µè½ï¼ˆç»å¯¹ä¸è¦ä¸€å¥ä¸€æ®µï¼‰
3. **ä¿æŒè¯­ä¹‰ä¸å˜**ï¼šä¸è¦ä¿®æ”¹åŸå§‹å«ä¹‰
4. **ä¿®æ­£æ˜æ˜¾é”™è¯¯**ï¼šä¿®æ­£æ˜æ˜¾çš„è¯­éŸ³è¯†åˆ«é”™è¯¯

ç¤ºä¾‹ï¼š
é”™è¯¯ï¼šä»Šå¤©å¤©æ°”å¾ˆå¥½æˆ‘ä»¬å»å…¬å›­ç©å§
æ­£ç¡®ï¼šä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œæˆ‘ä»¬å»å…¬å›­ç©å§ã€‚

é”™è¯¯ï¼šè¿™æ˜¯ç¬¬ä¸€å¥è¯ è¿™æ˜¯ç¬¬äºŒå¥è¯
æ­£ç¡®ï¼šè¿™æ˜¯ç¬¬ä¸€å¥è¯ã€‚è¿™æ˜¯ç¬¬äºŒå¥è¯ã€‚

åŸå§‹è½¬å½•æ–‡æœ¬ï¼š
{raw_text}

è¯·ä¸¥æ ¼æŒ‰ç…§è¦æ±‚è¾“å‡ºä¼˜åŒ–åçš„æ–‡æœ¬ï¼š
"""

#### 1.2 æ·»åŠ çº¦æŸæ£€æŸ¥
```python
def validate_polish_result(original: str, polished: str):
    """éªŒè¯ä¼˜åŒ–ç»“æœ"""
    errors = []

    # æ£€æŸ¥æ ‡ç‚¹ç¬¦å·
    if polished.count('ã€‚') < polished.count('ï¼Œ'):
        errors.append("æ ‡ç‚¹ç¬¦å·ä¸è¶³")

    # æ£€æŸ¥æ®µè½æ•°ï¼ˆä¼˜åŒ–ååº”è¯¥æ›´å°‘ï¼‰
    original_paragraphs = len(original.split('\n\n'))
    polished_paragraphs = len(polished.split('\n\n'))

    if polished_paragraphs > original_paragraphs:
        errors.append("æ®µè½æ•°æœªå‡å°‘")

    return errors
```

#### 1.3 é‡è¯•æœºåˆ¶
```python
async def polish_with_retry(text: str, max_retries: int = 3):
    """å¸¦é‡è¯•çš„ä¼˜åŒ–"""
    for attempt in range(max_retries):
        try:
            result = await llm_client.polish(text)
            errors = validate_polish_result(text, result)

            if not errors:
                return result

            logger.warning(f"ç¬¬ {attempt + 1} æ¬¡ä¼˜åŒ–å¤±è´¥: {errors}")

        except Exception as e:
            logger.error(f"ä¼˜åŒ–å¼‚å¸¸: {e}")

    # æ‰€æœ‰å°è¯•éƒ½å¤±è´¥ï¼Œè¿”å›åŸå§‹æ–‡æœ¬
    return text
```

### é—®é¢˜ 2: å¹¶å‘å¤„ç†ä¼˜åŒ–

**åŸºäºè°ƒç ”å‘ç°**:

GLM-4-Flash å…è´¹ç”¨æˆ·æ”¯æŒ **5 ä¸ªå¹¶å‘è¯·æ±‚**ï¼Œå¯ä»¥å®ç° 80% çš„æ—¶é—´å‡å°‘ã€‚

**å®ç°æ–¹æ¡ˆ**:

#### 2.1 è‡ªé€‚åº”å¹¶å‘å¤„ç†å™¨
```python
class AdaptiveConcurrencyProcessor:
    def __init__(self, max_concurrent: int = 5):
        self.max_concurrent = max_concurrent
        self.current_concurrent = max_concurrent

    async def process_chunks(self, chunks: List[str]):
        """è‡ªé€‚åº”å¹¶å‘å¤„ç†"""
        results = []

        for i in range(0, len(chunks), self.current_concurrent):
            batch = chunks[i:i+self.current_concurrent]

            try:
                # å¹¶å‘å¤„ç†æ‰¹æ¬¡
                tasks = [self.process_chunk(chunk) for chunk in batch]
                batch_results = await asyncio.gather(*tasks)
                results.extend(batch_results)

                # æ‰¹æ¬¡é—´ç­‰å¾…
                if i + self.current_concurrent < len(chunks):
                    await asyncio.sleep(2)

            except RateLimitError:
                # é™çº§å¹¶å‘æ•°
                self.current_concurrent = max(1, self.current_concurrent // 2)
                logger.warning(f"é™çº§å¹¶å‘è‡³: {self.current_concurrent}")

                # ä¸²è¡Œé‡è¯•
                for chunk in batch:
                    result = await self.process_chunk(chunk)
                    results.append(result)

        return results
```

#### 2.2 æµå¼å“åº”
```python
@app.post("/api/v1/llm/polish", response_class=StreamingResponse)
async def polish_transcript_stream(raw_text: str):
    """æµå¼ä¼˜åŒ–å“åº”"""
    async def generate():
        chunks = split_text(raw_text)

        async for chunk_result in processor.process_chunks_stream(chunks):
            yield f"data: {json.dumps(chunk_result)}\n\n"

    return StreamingResponse(
        generate(),
        media_type="text/event-stream",
        headers={
            "Cache-Control": "no-cache",
            "Connection": "keep-alive",
        }
    )
```

### é—®é¢˜ 3: Shownote è§£æ

**æŒ‘æˆ˜**: å°å®‡å®™çš„èŠ‚ç›®å•åŒ…å«å¤æ‚çš„ HTML å’Œå›¾ç‰‡

**è§£å†³æ–¹æ¡ˆ**:

```python
def parse_shownote(html_content: str) -> ShownoteData:
    """è§£æèŠ‚ç›®å• HTML"""
    from bs4 import BeautifulSoup

    soup = BeautifulSoup(html_content, 'html.parser')
    blocks = []

    for element in soup.find_all(['p', 'img', 'a', 'h1', 'h2', 'h3', 'strong', 'em']):
        if element.name == 'img':
            blocks.append({
                'type': 'image',
                'content': element.get('alt', ''),
                'imageUrl': element.get('src'),
                'style': {
                    'maxWidth': '100%',
                    'height': 'auto'
                }
            })
        elif element.name == 'a':
            blocks.append({
                'type': 'link',
                'content': element.get_text(),
                'linkUrl': element.get('href'),
            })
        elif element.name == 'strong':
            blocks.append({
                'type': 'bold',
                'content': element.get_text(),
            })
        else:
            text = element.get_text().strip()
            if text:
                blocks.append({
                    'type': 'text',
                    'content': text,
                })

    return ShownoteData(
        blocks=blocks,
        originalHtml=html_content
    )
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| è½¬å½•é€Ÿåº¦ | 30-50 ç§’ | ASR è½¬å½•æ—¶é—´ |
| LLM ä¼˜åŒ– | 8-16 ç§’ | å¹¶å‘å¤„ç†å |
| é¡µé¢åŠ è½½ | < 2 ç§’ | é¦–å±æ¸²æŸ“ |
| éŸ³é¢‘è·³è½¬ | < 200ms | ç‚¹å‡»åˆ°æ’­æ”¾å»¶è¿Ÿ |

### æˆæœ¬åˆ†æ

| åŠŸèƒ½ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| ASR è½¬å½• | Â¥0.01/åˆ†é’Ÿ | è±†åŒ…å¼•æ“ |
| LLM ä¼˜åŒ– | Â¥0.003/1000å­—ç¬¦ | glm-4-flash |
| ç¿»è¯‘ | Â¥0.003/1000å­—ç¬¦ | æŒ‰å­—ç¬¦è®¡è´¹ |
| **æ€»è®¡** | **â‰ˆ Â¥0.05/å°æ—¶æ’­å®¢** | å®Œå…¨å¯æ¥å— |

---

## âœ… å®æ–½ä¼˜å…ˆçº§

### é˜¶æ®µ 1: æ ¸å¿ƒåŠŸèƒ½ (1-2 å‘¨)
1. âœ… ASR è½¬å½• (å·²å®Œæˆ)
2. âœ… å¥å­çº§è·³è½¬ (å·²å®Œæˆ)
3. â³ LLM ä¼˜åŒ–ä¿®å¤
   - ä¿®å¤æ ‡ç‚¹ç¬¦å·é—®é¢˜
   - ä¿®å¤å¤šå¥åˆå¹¶é—®é¢˜
   - å®ç°å¹¶å‘å¤„ç†
4. â³ Overview æ¨¡å—
5. â³ Shownote å®Œæ•´å‘ˆç°

### é˜¶æ®µ 2: å¢å¼ºåŠŸèƒ½ (1 å‘¨)
1. â³ Highlights è‡ªåŠ¨æå–
2. â³ Chapters è‡ªåŠ¨ç”Ÿæˆ
3. â³ Pins ä¹¦ç­¾åŠŸèƒ½
4. â³ ç¿»è¯‘åŠŸèƒ½

### é˜¶æ®µ 3: ä½“éªŒä¼˜åŒ– (3-5 å¤©)
1. â³ æµå¼å“åº”
2. â³ è¿›åº¦æ˜¾ç¤º
3. â³ æ€§èƒ½ä¼˜åŒ–
4. â³ ç§»åŠ¨ç«¯é€‚é…

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒä»·å€¼

é€šè¿‡æ·±åº¦ç ”ç©¶ Scripodï¼Œæˆ‘ä»¬æ˜ç¡®äº†å°å®‡å®™æ·±åº¦å­¦ä¹ åŠ©æ‰‹çš„äº§å“æ–¹å‘ï¼š

1. **å®Œæ•´å¤åˆ»**: Shownote çš„å¯Œæ–‡æœ¬å‘ˆç°
2. **ä½“éªŒä¼˜åŒ–**: å¥å­çº§ç²¾å‡†è·³è½¬ + æ‚¬åœé«˜äº®
3. **æ™ºèƒ½å¢å¼º**: LLM è‡ªåŠ¨ç”Ÿæˆ Highlights å’Œ Chapters
4. **æ€§èƒ½æå‡**: å¹¶å‘å¤„ç†å‡å°‘ 80% ç­‰å¾…æ—¶é—´

### å·®å¼‚åŒ–ä¼˜åŠ¿

ç›¸æ¯” Scripodï¼Œæˆ‘ä»¬çš„ä¼˜åŠ¿ï¼š

1. **å°å®‡å®™æ·±åº¦æ•´åˆ**: å®Œç¾æ”¯æŒèŠ‚ç›®å•è§£æ
2. **å¥å­çº§è·³è½¬**: åŸºäºè±†åŒ… ASR çš„ç²¾å‡†æ—¶é—´æˆ³
3. **å…è´¹ä½¿ç”¨**: æ— éœ€ä»˜è´¹ API
4. **æœ¬åœ°åŒ–**: å®Œå…¨ä¸­æ–‡ä¼˜åŒ–

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å®æ–½**: ä¿®å¤ LLM ä¼˜åŒ–é—®é¢˜
2. **çŸ­æœŸç›®æ ‡**: å®Œæˆ Shownote å’Œ Overview
3. **ä¸­æœŸç›®æ ‡**: å®ç°æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
4. **é•¿æœŸè§„åˆ’**: æŒç»­ä½“éªŒä¼˜åŒ–

---

**äº§å“å®šä½**: æˆä¸ºæœ€ä¸“ä¸šçš„å°å®‡å®™æ’­å®¢å·¥å…·
