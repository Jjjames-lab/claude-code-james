<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŠ¶æ€æ›´æ–° - ç²¾è‹±åä½œç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e7;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #a1a1aa;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            text-align: center;
            display: none;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            text-align: center;
            display: none;
        }

        .helper-text {
            font-size: 12px;
            color: #71717a;
            margin-top: 8px;
        }

        .quick-status {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .quick-status button {
            flex: 1;
            padding: 8px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.05);
        }

        .quick-status button:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .quick-status button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ğŸ“ çŠ¶æ€æ›´æ–°</h1>

            <form id="updateForm">
                <!-- è§’è‰²é€‰æ‹© -->
                <div class="form-group">
                    <label for="roleSelect">ğŸ‘¤ æˆ‘æ˜¯</label>
                    <select id="roleSelect" required>
                        <option value="">é€‰æ‹©ä½ çš„è§’è‰²</option>
                        <option value="architect">æ¶æ„å¸ˆ</option>
                        <option value="frontend">å‰ç«¯å·¥ç¨‹å¸ˆ</option>
                        <option value="backend">åç«¯å·¥ç¨‹å¸ˆ</option>
                        <option value="product">äº§å“ç»ç†</option>
                        <option value="ui">UI/UX è®¾è®¡å¸ˆ</option>
                    </select>
                </div>

                <!-- çŠ¶æ€é€‰æ‹© -->
                <div class="form-group">
                    <label>ğŸ¯ å½“å‰çŠ¶æ€</label>
                    <div class="quick-status">
                        <button type="button" onclick="setStatus('idle')" class="status-btn" data-status="idle">ğŸŸ¢ ç©ºé—²</button>
                        <button type="button" onclick="setStatus('working')" class="status-btn" data-status="working">ğŸŸ¡ å·¥ä½œä¸­</button>
                        <button type="button" onclick="setStatus('blocked')" class="status-btn" data-status="blocked">ğŸ”´ é˜»å¡</button>
                    </div>
                    <input type="hidden" id="statusInput" required>
                </div>

                <!-- ä»»åŠ¡åç§° -->
                <div class="form-group">
                    <label for="taskName">ğŸ’¼ å½“å‰ä»»åŠ¡</label>
                    <input type="text" id="taskName" placeholder="ä¾‹å¦‚ï¼šå¤šå¼•æ“æ¶æ„è®¾è®¡">
                    <div class="helper-text">å¦‚æœçŠ¶æ€æ˜¯"ç©ºé—²"ï¼Œå¯ä»¥ç•™ç©º</div>
                </div>

                <!-- è¿›åº¦ -->
                <div class="form-group">
                    <label for="progress">ğŸ“Š è¿›åº¦: <span id="progressValue">0</span>%</label>
                    <input type="range" id="progress" min="0" max="100" value="0" oninput="updateProgressValue()">
                </div>

                <!-- å·²ç”¨æ—¶é—´ -->
                <div class="form-group">
                    <label for="spentTime">â±ï¸ å·²ç”¨æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="spentTime" min="0" placeholder="ä¾‹å¦‚ï¼š15">
                </div>

                <!-- é¢„è®¡æ—¶é—´ -->
                <div class="form-group">
                    <label for="estimatedTime">â° é¢„è®¡è¿˜éœ€ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="estimatedTime" min="0" placeholder="ä¾‹å¦‚ï¼š35">
                </div>

                <!-- äº‹ä»¶æè¿° -->
                <div class="form-group">
                    <label for="eventMessage">ğŸ“‹ äº‹ä»¶æè¿°</label>
                    <textarea id="eventMessage" rows="3" placeholder="ä¾‹å¦‚ï¼šå¼€å§‹ä»»åŠ¡ã€é‡åˆ°é—®é¢˜ã€å®Œæˆè¿›åº¦50%..."></textarea>
                    <div class="helper-text">è¿™ä¼šè¢«æ·»åŠ åˆ°äº‹ä»¶æµä¸­</div>
                </div>

                <button type="submit">ğŸ’¾ æ›´æ–°çŠ¶æ€</button>
            </form>

            <div id="success" class="success">âœ… æ›´æ–°æˆåŠŸï¼</div>
            <div id="error" class="error">âŒ æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•</div>
        </div>
    </div>

    <script>
        let currentState = null;

        // åŠ è½½å½“å‰çŠ¶æ€
        async function loadState() {
            try {
                const response = await fetch('state.json?t=' + Date.now());
                currentState = await response.json();
            } catch (error) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // è®¾ç½®çŠ¶æ€
        function setStatus(status) {
            document.getElementById('statusInput').value = status;
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.status === status) {
                    btn.classList.add('active');
                }
            });
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgressValue() {
            const progress = document.getElementById('progress').value;
            document.getElementById('progressValue').textContent = progress;
        }

        // æäº¤æ›´æ–°ï¼ˆV2 è‡ªåŠ¨åŒ–ï¼‰
        document.getElementById('updateForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const roleId = document.getElementById('roleSelect').value;
            const status = document.getElementById('statusInput').value;
            const taskName = document.getElementById('taskName').value;
            const progress = parseInt(document.getElementById('progress').value);
            const spentTime = parseInt(document.getElementById('spentTime').value) || 0;
            const estimatedTime = parseInt(document.getElementById('estimatedTime').value) || 0;
            const eventMessage = document.getElementById('eventMessage').value;

            if (!roleId || !status) {
                showError('è¯·é€‰æ‹©è§’è‰²å’ŒçŠ¶æ€');
                return;
            }

            try {
                console.log('ğŸ“ æäº¤çŠ¶æ€æ›´æ–°åˆ°æœåŠ¡å™¨...');

                // è°ƒç”¨æœåŠ¡å™¨ API
                const response = await fetch('/api/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        roleId,
                        status,
                        taskName,
                        progress,
                        spentTime,
                        estimatedTime,
                        eventMessage
                    })
                });

                const result = await response.json();

                if (result.success) {
                    console.log('âœ… æ›´æ–°æˆåŠŸ');
                    showSuccess();
                    clearForm();
                } else {
                    console.error('âŒ æ›´æ–°å¤±è´¥:', result.error);
                    showError(result.error || 'æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
                showError('ç½‘ç»œé”™è¯¯ï¼š' + error.message + '\nè¯·ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨');
            }
        });

        function showSuccess() {
            const success = document.getElementById('success');
            success.style.display = 'block';
            setTimeout(() => {
                success.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = 'âŒ ' + message;
            error.style.display = 'block';
            setTimeout(() => {
                error.style.display = 'none';
            }, 3000);
        }

        function clearForm() {
            document.getElementById('statusInput').value = '';
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('taskName').value = '';
            document.getElementById('progress').value = 0;
            document.getElementById('progressValue').textContent = '0';
            document.getElementById('spentTime').value = '';
            document.getElementById('estimatedTime').value = '';
            document.getElementById('eventMessage').value = '';
        }

        // åˆå§‹åŠ è½½
        loadState();
    </script>
</body>
</html>
