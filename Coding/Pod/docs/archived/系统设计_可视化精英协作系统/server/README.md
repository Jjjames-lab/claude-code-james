# V2 服务器 - 使用说明

> **可视化精英协作系统 V2** - 自动化版本

---

## 🚀 快速启动

### 方法1: 一键启动（推荐）

#### macOS / Linux

1. 打开终端
2. 复制粘贴以下命令：

```bash
cd "/Users/tbingy/Desktop/Claude Code/Coding/Pod/系统设计_可视化精英协作系统/server" && ./start.sh
```

3. 按回车，等待启动完成

#### Windows

1. 打开文件夹
2. 双击 `start.bat`

### 方法2: 手动启动

```bash
# 1. 进入服务器目录
cd "/Users/tbingy/Desktop/Claude Code/Coding/Pod/系统设计_可视化精英协作系统/server"

# 2. 安装依赖（首次运行）
npm install

# 3. 启动服务器
npm start
```

---

## 🎯 启动后

终端会显示：

```
==================================================
🚀 可视化精英协作系统 V2 已启动！
==================================================

📊 看板地址: http://localhost:3000/demo.html
📝 更新界面: http://localhost:3000/update.html

💡 提示:
   - 按 Ctrl+C 停止服务器
   - 修改状态后看板会自动刷新

==================================================
```

### 自动打开浏览器

复制看板地址到浏览器打开：
```
http://localhost:3000/demo.html
```

---

## 📖 使用方法

### 1. 查看看板

打开浏览器，访问：
```
http://localhost:3000/demo.html
```

你会看到：
- 所有角色的实时状态
- 项目进度
- 事件流
- 任务队列

### 2. 更新状态

打开另一个标签页，访问：
```
http://localhost:3000/update.html
```

填写表单：
1. 选择你的角色
2. 选择状态（🟢空闲 / 🟡工作中 / 🔴阻塞）
3. 填写任务信息（可选）
4. 填写事件描述（可选）
5. 点击"💾 更新状态"

**关键区别**：
- ✅ 不需要下载文件
- ✅ 不需要手动替换
- ✅ 看板会自动刷新（<1秒）

### 3. 停止服务器

在运行服务器的终端按：
```
Ctrl + C
```

---

## ✨ V2 的新功能

### 1. 自动保存

**之前（MVP）**：
- 更新状态 → 下载文件 → 手动替换

**现在（V2）**：
- 更新状态 → 自动保存

### 2. 实时推送

**之前（MVP）**：
- 每30秒刷新一次
- 最坏30秒延迟

**现在（V2）**：
- 状态变化立即推送
- <1秒延迟

### 3. 更好的提示

**之前（MVP）**：
- 下载文件后不知道怎么做

**现在（V2）**：
- 清晰的控制台日志
- 明确的成功/失败提示

---

## ⚠️ 常见问题

### 问题1: 端口被占用

**错误信息**：
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决方案**：

1. 找到占用端口的进程：
   ```bash
   lsof -i :3000
   ```

2. 结束该进程：
   ```bash
   kill -9 <PID>
   ```

3. 重新启动服务器

### 问题2: 依赖安装失败

**错误信息**：
```
npm ERR! ...
```

**解决方案**：

1. 清除缓存：
   ```bash
   npm cache clean --force
   ```

2. 删除 node_modules：
   ```bash
   rm -rf node_modules
   ```

3. 重新安装：
   ```bash
   npm install
   ```

4. 如果还是失败，尝试使用国内镜像：
   ```bash
   npm config set registry https://registry.npmmirror.com
   npm install
   ```

### 问题3: 看板不刷新

**检查清单**：

1. 服务器是否启动？
   - 查看终端是否有"服务器已启动"消息

2. 浏览器控制台是否有错误？
   - 按 F12 打开开发者工具
   - 查看 Console 标签

3. 是否在正确的端口？
   - 确保访问的是 http://localhost:3000

4. 是否有 SSE 连接？
   - 控制台应该显示"✅ SSE 已连接"

### 问题4: 更新失败

**检查清单**：

1. 浏览器控制台是否有错误？
   - 按 F12 打开开发者工具
   - 查看 Console 标签的错误信息

2. 服务器终端是否有错误？
   - 查看终端的红色错误消息

3. 网络是否正常？
   - 检查能否访问 http://localhost:3000/api/state

---

## 🔧 技术细节

### 依赖

- **express**: Web 服务器框架
- **cors**: 跨域资源共享支持

### API 端点

- `GET /api/state` - 获取当前状态
- `POST /api/update` - 更新状态
- `GET /api/stream` - SSE 实时推送

### 数据存储

所有数据存储在 `state.json` 文件中。

---

## 📞 需要帮助？

### 查看文档

- **系统说明**: `../README.md`
- **快速开始**: `../QUICKSTART.md`
- **V2 计划**: `../V2_PLAN.md`

### 联系

如有问题，联系高级助手 AI。

---

## 🎉 享受自动化！

**V2 让协作更简单！**

- ✅ 不再需要手动下载文件
- ✅ 不再需要手动替换
- ✅ 看板实时更新
- ✅ 专注于工作本身

---

**版本**: v2.0
**最后更新**: 2026-01-21
**作者**: 高级助手 AI
