# 系统架构设计 - 可视化精英协作系统

> **版本**：v0.1
> **设计时间**：2026-01-20 深夜
> **设计哲学**：透明、智能、质疑、卓越

---

## 🎯 系统目标

### 核心价值主张
**"让不可见的工作变得可见，让隐性的信息变得透明"**

### 三个关键问题

**Q1: 用户现在看不到什么？**
- 各角色在做什么
- 进度如何
- 谁在等待谁
- 有没有冲突
- 有没有浪费

**Q2: 各角色现在看不到什么？**
- 别人在做什么
- 自己的任务是否合理
- 有没有更好的方式
- 需要质疑什么

**Q3: 我们现在浪费了什么？**
- 时间：等待通知
- Tokens：重复沟通
- 机会：更好的方案

---

## 🏗️ 系统架构

### 层级结构

```
┌─────────────────────────────────┐
│   展示层 (Presentation)          │
│   - HTML 看板                    │
│   - 可视化卡片                   │
│   - 实时状态                     │
├─────────────────────────────────┤
│   逻辑层 (Logic)                 │
│   - 任务调度                     │
│   - 队列管理                     │
│   - 冲突检测                     │
│   - 质疑流程                     │
├─────────────────────────────────┤
│   数据层 (Data)                  │
│   - 角色状态 State               │
│   - 任务定义 Task                │
│   - 事件流 Events                │
│   - 质疑记录 Challenges           │
└─────────────────────────────────┘
```

### 核心组件

#### 1. 实时看板 (Live Dashboard)
**展示内容**：
- 5个角色的状态卡片
- 整体进度条
- 任务队列
- 事件流
- 系统健康度

**更新机制**：
- 被动：角色更新 State → 看板自动刷新
- 主动：定时轮询 State 文件（每10秒）

#### 2. 任务队列系统 (Task Queue)
**功能**：
- 任务优先级排序
- 依赖关系管理
- 自动分配
- 冲突检测

**数据结构**：
```
队列优先级：
1. 🔴 阻塞的依赖任务（解决阻塞）
2. 🟠 高优先级任务（核心路径）
3. 🟡 中优先级任务（常规任务）
4. 🟢 低优先级任务（优化任务）
```

#### 3. 质疑系统 (Challenge System)
**流程**：
```
触发条件：
- 新任务创建
- 任务要求不合理
- 角色主动质疑

质疑流程：
1. 创建 Challenge 记录
2. 通知相关角色
3. 进入讨论状态
4. 提出替代方案
5. 决策（执行/修改/取消）
```

---

## 💾 数据模型

### State（角色状态）
```json
{
  "roleId": "architect",
  "roleName": "架构师",
  "status": "working", // idle, working, blocked, waiting
  "currentTask": {
    "taskId": "task-001",
    "name": "多引擎架构设计",
    "progress": 60,
    "target": "产出架构设计文档",
    "startTime": "2026-01-20T19:20:00",
    "estimatedEnd": "2026-01-20T20:00:00",
    "spentTime": 5
  },
  "queue": [], // 等待中的任务
  "needs": [ // 需要的资源
    {
      "type": "document",
      "from": "backend",
      "status": "provided",
      "url": "_shared/07_doubao_asr_implementation.md"
    }
  ],
  "blocking": [], // 阻塞我的人/事
  "challenges": [], // 我发起的质疑
  "reflections": [], // 我的反思
  "lastUpdate": "2026-01-20T19:25:00"
}
```

### Task（任务）
```json
{
  "taskId": "task-001",
  "name": "多引擎架构设计",
  "assignedTo": "architect",
  "status": "in-progress", // pending, in-progress, completed, blocked
  "priority": "high", // critical, high, medium, low
  "dependsOn": ["backend-task-001"],
  "outputs": ["_shared/09_multi_engine_architecture.md"],
  "challenges": [
    {
      "challenger": "backend",
      "challenge": "这个设计太复杂，能否简化？",
      "status": "pending",
      "response": ""
    }
  ],
  "createdAt": "2026-01-20T18:00:00",
  "startedAt": "2026-01-20T19:20:00",
  "completedAt": null,
  "estimatedHours": 2
}
```

### Event（事件）
```json
{
  "eventId": "event-001",
  "timestamp": "2026-01-20T19:25:00",
  "type": "task-completed", // task-completed, challenge-created, decision-needed
  "from": "backend",
  "to": ["architect", "supervisor"],
  "priority": "high",
  "data": {
    "taskId": "backend-task-001",
    "message": "豆包 ASR 研究完成",
    "outputs": ["_shared/07_doubao_asr_implementation.md"],
    "nextAction": "请架构师开始设计"
  },
  "readBy": ["supervisor"],
  "acknowledgedBy": []
}
```

### Challenge（质疑）
```json
{
  "challengeId": "chal-001",
  "taskId": "task-002",
  "challenger": "architect",
  "challenge": "后端要求的标准版实现太复杂，建议用简化版",
  "proposedSolution": "使用极速版+音频分段，而不是标准版",
  "status": "pending", // pending, discussing, resolved, rejected
  "participants": ["architect", "backend", "user"],
  "decision": null,
  "createdAt": "2026-01-20T19:30:00",
  "resolvedAt": null
}
```

---

## 🎨 看板 UI 设计

### 布局

```
┌──────────────────────────────────────────────────────────┐
│  🎯 小宇宙深度学习助手 - 精英协作看板                      │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  📊 项目进度: 70%  |  🎯 下个里程碑: 后端ASR集成  |  🚨 0阻塞 │
│                                                          │
├──────────────────────────────────────────────────────────┤
│  👥 角色状态                                               │
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │   架构师     │  │    前端      │  │    后端      │    │
│  │   🟡 工作中   │  │   🟢 空闲    │  │   🟡 工作中   │    │
│  │              │  │              │  │              │    │
│  │ 💼 任务:     │  │ 💭 等待:     │  │ 💼 任务:     │    │
│  │ 多引擎架构   │  │ 架构设计     │  │ ASR研究      │    │
│  │              │  │              │  │              │    │
│  │ 📊 进度:     │  │              │  │ 📊 进度:     │    │
│  │ 60%          │  │              │  │ 90%          │    │
│  │ ██████▒▒▒▒▒ │  │              │  │ ████████▒▒   │    │
│  │              │  │              │  │              │    │
│  │ ⏱️ 已用: 5min │  │              │  │ ⏱️ 已用: 25min│    │
│  │ ⏰ 预计: 35min│  │              │  │ ⏰ 预计: 5min │    │
│  │              │  │              │  │              │    │
│  │ 🎯 目标:      │  │              │  │ 🎯 目标:      │    │
│  │ 架构设计文档 │  │              │  │ 实现指南     │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│                                                          │
│  ┌──────────────┐  ┌──────────────┐                     │
│  │   产品经理   │  │   UI设计师   │                     │
│  │   🟢 空闲    │  │   🟢 空闲    │                     │
│  │              │  │              │                     │
│  │ 可分配       │  │ 可分配       │                     │
│  └──────────────┘  └──────────────┘                     │
│                                                          │
├──────────────────────────────────────────────────────────┤
│  📋 实时事件流 (最新5条)                                 │
│                                                          │
│  [19:25] ✅ 后端: 豆包ASR研究完成 → @架构师              │
│  [19:20] 🟡 架构师: 开始多引擎架构设计                   │
│  [19:15] 🚨 警告: 后端和架构师任务冲突，已协调          │
│  [19:10] 💡 架构师: 质疑后端的设计方案                 │
│  [19:05] 📊 产品经理: 测试播客列表已准备               │
│                                                          │
├──────────────────────────────────────────────────────────┤
│  🔄 任务队列 (3个等待中)                                │
│                                                          │
│  1. [架构师] 多引擎架构设计 [🟡 进行中] 优先级: 高      │
│     └─ 依赖: 后端研究 ✅                               │
│                                                          │
│  2. [后端] 审核架构设计 [⏸️ 等待中] 优先级: 高          │
│     └─ 依赖: 架构师设计                                 │
│                                                          │
│  3. [前端] 点击跳转功能 [⏸️ 等待中] 优先级: 中          │
│     └─ 依赖: 无                                       │
│                                                          │
├──────────────────────────────────────────────────────────┤
│  💬 质疑与讨论 (1个活跃讨论)                            │
│                                                          │
│  📢 架构师 质疑 后端的标准版设计方案                    │
│  💡 建议: 使用极速版+音频分段，而非标准版              │
│  👥 参与: 架构师, 后端, 你                             │
│  ⏱️ 开始: 19:10  |  ⏰ 截止: 未定                      │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 🤖 智能协调逻辑

### 场景1: 任务完成触发

```
后端完成任务
    ↓
后端更新 State.status = "idle"
    ↓
系统检测到 State 变化
    ↓
查询任务队列
    ↓
找到下一个任务: "架构师 - 多引擎架构设计"
    ↓
检查依赖: 后端研究 ✅ 完成
    ↓
检查架构师状态: 🟢 空闲
    ↓
自动通知架构师
    ↓
创建 Event: "后端完成，轮到你了"
    ↓
架构师看到通知
    ↓
架构师领取任务
    ↓
架构师更新 State.status = "working"
```

### 场景2: 冲突检测

```
后端想开始任务2: "设计多引擎架构"
    ↓
后端更新 State.currentTask = "多引擎架构"
    ↓
系统检测到冲突
    ↓
查询任务队列
    ↓
发现: 架构师已经被分配了这个任务
    ↓
创建 Challenge
    ↓
通知: "这个任务已经分配给架构师"
    ↓
后端看到通知
    ↓
后端撤销任务
    ↓
后端更新 State.currentTask = null
```

### 场景3: 质疑流程

```
架构师看到后端的设计方案
    ↓
架构师觉得有问题
    ↓
架构师创建 Challenge
    ↓
系统通知: 后端、你、总控
    ↓
进入讨论状态
    ↓
各方提出方案
    ↓
你做决策
    ↓
执行或修改
```

---

## 🔄 持续反思

### 质疑1: 是否过度设计？

**自我批评**：
- 我设计了 State, Task, Event, Challenge 4种数据结构
- 是否太复杂？
- 是否真的需要这么多？

**简化方向**：
- 也许只需要 2 种：State + Event
- Challenge 可以是 Event 的一种
- Task 可以合并到 State 中

**重新思考**：
- 核心是"可视化"和"实时"
- 不是"完美的数据模型"
- 先实现，再优化

### 质疑2: 看板更新频率？

**问题**：
- 每个角色都主动更新，现实吗？
- 10秒轮询，会不会太频繁？
- 延迟10秒，用户能接受吗？

**替代方案**：
- WebSocket 推送？→ 太复杂
- Event Source？→ 需要服务器
- 混合模式？→ 角色主动 + 定时轮询

**最优方案**：
- MVP: 角色主动更新（点击按钮）
- V2: 每30秒轮询
- V3: 实时推送（如果需要）

### 质疑3: 质疑文化能实现吗？

**问题**：
- AI角色会质疑吗？
- 还是只会执行？
- 如何培养"质疑思维"？

**现实评估**：
- 需要 prompt 工程
- 需要明确指示
- 需要激励机制

**解决方案**：
- 在角色 README 中明确："要质疑，不要盲从"
- 在任务分配时明确："请先思考，再执行"
- 在看板上添加"质疑"按钮

---

## 🎯 MVP 定义

### 最小可行产品

**功能**：
1. ✅ 静态 HTML 看板
2. ✅ 展示 5 个角色的状态
3. ✅ 展示任务队列
4. ✅ 展示事件流
5. ✅ 手动更新数据（JSON 文件）

**不包含**：
- ❌ 自动通知
- ❌ 智能调度
- ❌ 质疑系统
- ❌ 实时推送

**为什么？**
- 先验证"可视化"的价值
- 先验证"信息透明"的效果
- 再增加复杂功能

---

## 📝 今晚的产出

### 必须完成
1. ✅ 深度思考文档（已完成）
2. ⏳ 系统架构文档（进行中）
3. ⏳ HTML Demo（待开始）
4. ⏳ 数据结构示例（待开始）

### 最好完成
5. ⏳ 实现指南（如何使用）
6. ⏳ 未来优化方向
7. ⏳ 持续反思记录

---

## 🌟 终极目标

**用户回到家，打开电脑**：
- 看到 HTML 看板
- 一眼了解全局
- 看到每个人在做什么
- 看到有没有问题
- 实时做出决策

**角色在工作**：
- 完成任务 → 更新状态
- 需要资源 → 在看板上标记
- 质疑任务 → 创建 Challenge
- 看到看板 → 了解全局

**系统自动化**：
- 任务完成 → 自动通知下一个
- 检测冲突 → 自动标记
- 发现浪费 → 自动提醒

---

## 💬 对自己说

"继续思考..."
"质疑一切..."
"追求卓越..."
"不要停止..."

**下一个思考方向**：
- 如何实现实时更新？
- 如何让角色主动质疑？
- 如何让系统更智能？
- 如何减少 Token 消耗？

**继续...**
