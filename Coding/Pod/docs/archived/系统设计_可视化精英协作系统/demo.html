<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å®‡å®™æ·±åº¦å­¦ä¹ åŠ©æ‰‹ - ç²¾è‹±åä½œçœ‹æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e7;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .roles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .role-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .role-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .role-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .role-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .role-info {
            flex: 1;
        }

        .role-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .role-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .status-idle {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-working {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .status-blocked {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .role-task {
            margin: 12px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .task-progress {
            margin: 8px 0;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #a1a1aa;
            margin-top: 8px;
        }

        .event-stream {
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border-left: 3px solid #667eea;
            font-size: 14px;
        }

        .event-time {
            color: #71717a;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .event-icon {
            display: inline-block;
            margin-right: 8px;
        }

        .task-queue {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .queue-item {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border-left: 3px solid #f59e0b;
        }

        .queue-item.priority-high {
            border-left-color: #ef4444;
        }

        .queue-item.priority-medium {
            border-left-color: #f59e0b;
        }

        .queue-item.priority-low {
            border-left-color: #10b981;
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .queue-role {
            font-weight: 600;
        }

        .queue-priority {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .queue-task {
            color: #a1a1aa;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .queue-dependency {
            font-size: 12px;
            color: #71717a;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .last-update {
            text-align: center;
            color: #71717a;
            font-size: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ å°å®‡å®™æ·±åº¦å­¦ä¹ åŠ©æ‰‹ - ç²¾è‹±åä½œçœ‹æ¿</h1>
            <div class="stats">
                <div class="stat">
                    <span>ğŸ“Š é¡¹ç›®è¿›åº¦:</span>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 70%"></div>
                    </div>
                    <span>70%</span>
                </div>
                <div class="stat">
                    <span>ğŸ¯ ä¸‹ä¸ªé‡Œç¨‹ç¢‘:</span>
                    <span>åç«¯ASRé›†æˆ</span>
                </div>
                <div class="stat">
                    <span>ğŸš¨ é˜»å¡:</span>
                    <span>0ä¸ª</span>
                </div>
                <div class="stat">
                    <span>â° æœ€åæ›´æ–°:</span>
                    <span class="pulse">19:35</span>
                </div>
            </div>
        </div>

        <!-- Roles Section -->
        <div class="section">
            <div class="section-title">
                ğŸ‘¥ è§’è‰²çŠ¶æ€
            </div>
            <div class="roles-grid">
                <!-- Architect -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            ğŸ—ï¸
                        </div>
                        <div class="role-info">
                            <div class="role-name">æ¶æ„å¸ˆ</div>
                            <div class="role-status status-working">ğŸŸ¡ å·¥ä½œä¸­</div>
                        </div>
                    </div>
                    <div class="role-task">
                        <div class="task-name">å¤šå¼•æ“æ¶æ„è®¾è®¡</div>
                        <div class="task-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%"></div>
                            </div>
                        </div>
                        <div class="task-meta">
                            <span>â±ï¸ å·²ç”¨: 5åˆ†é’Ÿ</span>
                            <span>â° é¢„è®¡: 35åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px;">
                        <div>ğŸ¯ ç›®æ ‡: æ¶æ„è®¾è®¡æ–‡æ¡£</div>
                        <div style="margin-top: 4px;">ğŸ”” ç­‰å¾…: åç«¯ç ”ç©¶ âœ…</div>
                    </div>
                </div>

                <!-- Frontend -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-avatar" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            ğŸ¨
                        </div>
                        <div class="role-info">
                            <div class="role-name">å‰ç«¯å·¥ç¨‹å¸ˆ</div>
                            <div class="role-status status-idle">ğŸŸ¢ ç©ºé—²</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px;">
                        <div>ğŸ’­ ç­‰å¾…: æ¶æ„è®¾è®¡å®Œæˆ</div>
                        <div style="margin-top: 4px;">ğŸ“‹ å¯ç«‹å³åˆ†é…ä»»åŠ¡</div>
                    </div>
                </div>

                <!-- Backend -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-avatar" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            âš™ï¸
                        </div>
                        <div class="role-info">
                            <div class="role-name">åç«¯å·¥ç¨‹å¸ˆ</div>
                            <div class="role-status status-working">ğŸŸ¡ å·¥ä½œä¸­</div>
                        </div>
                    </div>
                    <div class="role-task">
                        <div class="task-name">è±†åŒ… ASR ç ”ç©¶</div>
                        <div class="task-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 90%"></div>
                            </div>
                        </div>
                        <div class="task-meta">
                            <span>â±ï¸ å·²ç”¨: 25åˆ†é’Ÿ</span>
                            <span>â° é¢„è®¡: 5åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px;">
                        <div>ğŸ¯ ç›®æ ‡: å®ç°æŒ‡å—æ–‡æ¡£</div>
                        <div style="margin-top: 4px;">ğŸ’¡ å³å°†å®Œæˆ</div>
                    </div>
                </div>

                <!-- Product Manager -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-avatar" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            ğŸ“Š
                        </div>
                        <div class="role-info">
                            <div class="role-name">äº§å“ç»ç†</div>
                            <div class="role-status status-idle">ğŸŸ¢ ç©ºé—²</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px;">
                        <div>âœ… æµ‹è¯•æ’­å®¢åˆ—è¡¨å·²å®Œæˆ</div>
                        <div>âœ… ASRé…ç½®å·²å®Œæˆ</div>
                        <div style="margin-top: 4px;">ğŸ“‹ å¯ç«‹å³åˆ†é…ä»»åŠ¡</div>
                    </div>
                </div>

                <!-- UI Designer -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-avatar" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                            ğŸ¨
                        </div>
                        <div class="role-info">
                            <div class="role-name">UI/UX è®¾è®¡å¸ˆ</div>
                            <div class="role-status status-idle">ğŸŸ¢ ç©ºé—²</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px;">
                        <div>âœ… è®¾è®¡ç³»ç»Ÿå·²å®Œæˆ</div>
                        <div style="margin-top: 4px;">ğŸ“‹ ç­‰å¾…å‰ç«¯å®ç°åå®¡æ ¸</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Stream -->
        <div class="section">
            <div class="section-title">
                ğŸ“‹ å®æ—¶äº‹ä»¶æµ
            </div>
            <div class="event-stream">
                <div class="event-item">
                    <div class="event-time">19:35</div>
                    <div>
                        <span class="event-icon">âœ…</span>
                        <strong>åç«¯å·¥ç¨‹å¸ˆ:</strong> è±†åŒ…ASRç ”ç©¶å®Œæˆ (v2.0)
                        <span style="color: #f59e0b; margin-left: 8px;">@æ¶æ„å¸ˆ @é«˜çº§åŠ©æ‰‹</span>
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-time">19:25</div>
                    <div>
                        <span class="event-icon">ğŸŸ¡</span>
                        <strong>æ¶æ„å¸ˆ:</strong> å¼€å§‹å¤šå¼•æ“æ¶æ„è®¾è®¡
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-time">19:15</div>
                    <div>
                        <span class="event-icon">ğŸš¨</span>
                        <strong>é«˜çº§åŠ©æ‰‹:</strong> å‘ç°å·¥ä½œå†²çªï¼Œå·²åè°ƒ
                        <span style="color: #ef4444; margin-left: 8px;">@æ¶æ„å¸ˆ @åç«¯</span>
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-time">19:05</div>
                    <div>
                        <span class="event-icon">ğŸ”“</span>
                        <strong>äº§å“ç»ç†:</strong> ASRé…ç½®å·²å°±ç»ª
                        <span style="color: #10b981; margin-left: 8px;">@åç«¯</span>
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-time">18:00</div>
                    <div>
                        <span class="event-icon">ğŸš€</span>
                        <strong>é«˜çº§åŠ©æ‰‹:</strong> ç³»ç»Ÿå¯åŠ¨ï¼Œä»»åŠ¡å·²åˆ†é…
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Queue -->
        <div class="section">
            <div class="section-title">
                ğŸ”„ ä»»åŠ¡é˜Ÿåˆ—
            </div>
            <div class="task-queue">
                <div class="queue-item priority-high">
                    <div class="queue-header">
                        <span class="queue-role">æ¶æ„å¸ˆ - å¤šå¼•æ“æ¶æ„è®¾è®¡</span>
                        <span class="queue-priority">ğŸ”´ é«˜ä¼˜å…ˆçº§</span>
                    </div>
                    <div class="queue-task">çŠ¶æ€: ğŸŸ¡ è¿›è¡Œä¸­ (60%)</div>
                    <div class="queue-dependency">ä¾èµ–: åç«¯ç ”ç©¶ âœ… å·²å®Œæˆ</div>
                </div>

                <div class="queue-item priority-high">
                    <div class="queue-header">
                        <span class="queue-role">åç«¯ - å®¡æ ¸æ¶æ„è®¾è®¡</span>
                        <span class="queue-priority">ğŸ”´ é«˜ä¼˜å…ˆçº§</span>
                    </div>
                    <div class="queue-task">çŠ¶æ€: â¸ï¸ ç­‰å¾…ä¸­</div>
                    <div class="queue-dependency">ä¾èµ–: æ¶æ„å¸ˆè®¾è®¡å®Œæˆ</div>
                </div>

                <div class="queue-item priority-medium">
                    <div class="queue-header">
                        <span class="queue-role">å‰ç«¯ - ç‚¹å‡»è·³è½¬åŠŸèƒ½</span>
                        <span class="queue-priority">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</span>
                    </div>
                    <div class="queue-task">çŠ¶æ€: â¸ï¸ ç­‰å¾…ä¸­</div>
                    <div class="queue-dependency">ä¾èµ–: æ— éšœç¢ï¼Œå¯å¼€å§‹</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="last-update">
            â° å®æ—¶åä½œçœ‹æ¿ MVP v0.1 | æœ€åæ›´æ–°: 19:35 | ä¸‹æ¬¡åˆ·æ–°: è‡ªåŠ¨
        </div>
    </div>

    <script>
        // ä» JSON æ–‡ä»¶åŠ è½½çŠ¶æ€
        let currentState = null;

        async function loadState() {
            try {
                const response = await fetch('state.json?t=' + Date.now());
                currentState = await response.json();
                renderDashboard(currentState);
            } catch (error) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                currentState = getMockState();
                renderDashboard(currentState);
            }
        }

        function getMockState() {
            return {
                roles: [
                    { id: 'architect', name: 'æ¶æ„å¸ˆ', avatar: 'ğŸ—ï¸', status: 'working', currentTask: { name: 'å¤šå¼•æ“æ¶æ„è®¾è®¡', progress: 60, spentMinutes: 15, estimatedMinutes: 35 } },
                    { id: 'frontend', name: 'å‰ç«¯å·¥ç¨‹å¸ˆ', avatar: 'ğŸ¨', status: 'idle', currentTask: null, queue: ['ç‚¹å‡»è·³è½¬', 'è‡ªåŠ¨æ»šåŠ¨', 'ç¬”è®°åŠŸèƒ½'] },
                    { id: 'backend', name: 'åç«¯å·¥ç¨‹å¸ˆ', avatar: 'âš™ï¸', status: 'working', currentTask: { name: 'è±†åŒ… ASR ç ”ç©¶', progress: 90, spentMinutes: 27, estimatedMinutes: 3 } },
                    { id: 'product', name: 'äº§å“ç»ç†', avatar: 'ğŸ“Š', status: 'idle', currentTask: null },
                    { id: 'ui', name: 'UI/UX è®¾è®¡å¸ˆ', avatar: 'ğŸ¨', status: 'idle', currentTask: null }
                ],
                events: [
                    { time: '19:35', type: 'âœ…', from: 'åç«¯', message: 'è±†åŒ…ASRç ”ç©¶å®Œæˆ', to: ['æ¶æ„å¸ˆ'] },
                    { time: '19:25', type: 'ğŸŸ¡', from: 'æ¶æ„å¸ˆ', message: 'å¼€å§‹å¤šå¼•æ“æ¶æ„è®¾è®¡' },
                    { time: '19:15', type: 'ğŸš¨', from: 'é«˜çº§åŠ©æ‰‹', message: 'å·¥ä½œå†²çªå·²åè°ƒ', to: ['æ¶æ„å¸ˆ', 'åç«¯'] }
                ]
            };
        }

        function renderDashboard(state) {
            // æ¸²æŸ“é¡¹ç›®è¿›åº¦
            const progressEl = document.querySelector('.progress-fill');
            if (progressEl && state.project) {
                progressEl.style.width = state.project.progress + '%';
            }

            // æ¸²æŸ“é¡¹ç›®ä¿¡æ¯
            const statsElements = document.querySelectorAll('.stat');
            if (statsElements.length >= 4 && state.project) {
                // æ›´æ–°è¿›åº¦ç™¾åˆ†æ¯”
                const progressText = statsElements[0].querySelectorAll('span')[2];
                if (progressText) {
                    progressText.textContent = state.project.progress + '%';
                }

                // æ›´æ–°ä¸‹ä¸ªé‡Œç¨‹ç¢‘
                const milestoneText = statsElements[1].querySelectorAll('span')[1];
                if (milestoneText && state.project.currentMilestone) {
                    milestoneText.textContent = state.project.currentMilestone;
                }

                // æ›´æ–°é˜»å¡æ•°é‡
                const blocksText = statsElements[2].querySelectorAll('span')[1];
                if (blocksText) {
                    blocksText.textContent = (state.project.blocks || 0) + 'ä¸ª';
                }
            }

            // æ¸²æŸ“è§’è‰²å¡ç‰‡
            if (state.roles) {
                renderRoles(state.roles);
            }

            // æ¸²æŸ“äº‹ä»¶æµ
            if (state.events) {
                renderEvents(state.events);
            }
        }

        function renderRoles(roles) {
            const rolesGrid = document.querySelector('.roles-grid');
            rolesGrid.innerHTML = '';

            roles.forEach(role => {
                const card = createRoleCard(role);
                rolesGrid.appendChild(card);
            });
        }

        function createRoleCard(role) {
            const div = document.createElement('div');
            div.className = 'role-card';

            const statusClass = role.status === 'idle' ? 'status-idle' :
                                 role.status === 'working' ? 'status-working' :
                                 'status-blocked';

            const statusText = role.status === 'idle' ? 'ğŸŸ¢ ç©ºé—²' :
                               role.status === 'working' ? 'ğŸŸ¡ å·¥ä½œä¸­' : 'ğŸ”´ é˜»å¡';

            let taskHtml = '';
            if (role.currentTask) {
                taskHtml = `
                    <div class="role-task">
                        <div class="task-name">${role.currentTask.name}</div>
                        <div class="task-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${role.currentTask.progress}%"></div>
                            </div>
                        </div>
                        <div class="task-meta">
                            <span>â±ï¸ å·²ç”¨: ${role.currentTask.spentMinutes}åˆ†é’Ÿ</span>
                            <span>â° é¢„è®¡: ${role.currentTask.estimatedMinutes}åˆ†é’Ÿ</span>
                        </div>
                    </div>
                `;
            }

            let queueHtml = '';
            if (role.queue && role.queue.length > 0) {
                queueHtml = `<div style="margin-top: 8px; font-size: 12px;">ğŸ“‹ é˜Ÿåˆ—: ${role.queue.length}ä¸ªä»»åŠ¡</div>`;
            }

            // éœ€è¦çš„èµ„æº
            let needsHtml = '';
            if (role.needs && role.needs.length > 0) {
                const needsList = role.needs.map(n => {
                    const statusIcon = n.status === 'provided' ? 'âœ…' : 'â³';
                    return `${statusIcon} ${n.description || n.type}`;
                }).join('<br>');
                needsHtml = `<div style="margin-top: 8px; font-size: 12px;">ğŸ”” ç­‰å¾…: ${needsList}</div>`;
            }

            // é˜»å¡ä¿¡æ¯
            let blockingHtml = '';
            if (role.blocking && role.blocking.length > 0) {
                blockingHtml = `<div style="margin-top: 8px; font-size: 12px; color: #ef4444;">ğŸš¨ é˜»å¡: ${role.blocking.length}ä¸ª</div>`;
            }

            // åæ€ï¼ˆä»…æ˜¾ç¤ºå‰50ä¸ªå­—ç¬¦ï¼‰
            let reflectionHtml = '';
            if (role.reflection) {
                const shortReflection = role.reflection.length > 50
                    ? role.reflection.substring(0, 50) + '...'
                    : role.reflection;
                reflectionHtml = `<div style="margin-top: 8px; font-size: 11px; color: #71717a; font-style: italic;">ğŸ’­ "${shortReflection}"</div>`;
            }

            div.innerHTML = `
                <div class="role-header">
                    <div class="role-avatar" style="background: linear-gradient(135deg, ${getGradient(role.id)} 0%, ${getGradient(role.id, true)} 100%);">
                        ${role.avatar}
                    </div>
                    <div class="role-info">
                        <div class="role-name">${role.name}</div>
                        <div class="role-status ${statusClass}">${statusText}</div>
                    </div>
                </div>
                ${taskHtml}
                ${needsHtml}
                ${blockingHtml}
                ${queueHtml}
                ${reflectionHtml}
            `;

            return div;
        }

        function getGradient(roleId, alternate = false) {
            const gradients = {
                'architect': ['#667eea', '#764ba2'],
                'frontend': ['#f093fb', '#f5576c'],
                'backend': ['#4facfe', '#00f2fe'],
                'product': ['#fa709a', '#fee140'],
                'ui': ['#a8edea', '#fed6e3']
            };
            return gradients[roleId][alternate ? 1 : 0];
        }

        function renderEvents(events) {
            const eventStream = document.querySelector('.event-stream');
            if (!eventStream) return;
            eventStream.innerHTML = '';

            events.slice(0, 10).forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';

                // å¤„ç†æ—¶é—´ï¼ˆå…¼å®¹timeå’Œtimestampå­—æ®µï¼‰
                let timeStr = event.time;
                if (!timeStr && event.timestamp) {
                    const date = new Date(event.timestamp);
                    timeStr = date.getHours().toString().padStart(2, '0') + ':' +
                             date.getMinutes().toString().padStart(2, '0');
                }

                // å¤„ç†äº‹ä»¶ç±»å‹å›¾æ ‡
                let icon = event.type || 'ğŸ“‹';
                if (typeof icon === 'string' && !icon.startsWith('ğŸŸ¡') && !icon.startsWith('âœ…') && !icon.startsWith('ğŸ”´') && !icon.startsWith('ğŸš¨') && !icon.startsWith('ğŸ”“') && !icon.startsWith('ğŸš€')) {
                    // å¦‚æœæ˜¯æ–‡å­—ç±»å‹ï¼Œè½¬æ¢ä¸ºå›¾æ ‡
                    const typeIcons = {
                        'task-completed': 'âœ…',
                        'task-started': 'ğŸŸ¡',
                        'warning': 'ğŸš¨',
                        'block-resolved': 'ğŸ”“',
                        'system-start': 'ğŸš€',
                        'challenge-created': 'ğŸ’¡'
                    };
                    icon = typeIcons[icon] || 'ğŸ“‹';
                }

                // å¤„ç†@mentions
                let toHtml = '';
                if (event.to && event.to.length > 0) {
                    toHtml = `<span style="color: #f59e0b; margin-left: 8px;">${event.to.map(t => '@' + t).join(' ')}</span>`;
                }

                // å¤„ç†ä¼˜å…ˆçº§
                let priorityHtml = '';
                if (event.priority === 'critical' || event.priority === 'high') {
                    priorityHtml = `<span style="color: #ef4444; margin-left: 4px;">ğŸ”´</span>`;
                }

                eventItem.innerHTML = `
                    <div class="event-time">${timeStr || ''}</div>
                    <div>
                        <span class="event-icon">${icon}</span>
                        <strong>${event.from}:</strong> ${event.message}
                        ${toHtml}
                        ${priorityHtml}
                    </div>
                `;

                eventStream.appendChild(eventItem);
            });
        }

        // SSE è¿æ¥ï¼ˆV2 è‡ªåŠ¨åŒ–ï¼‰
        function connectSSE() {
            const eventSource = new EventSource('/api/stream');

            eventSource.onmessage = function(event) {
                console.log('ğŸ“¡ çŠ¶æ€å·²æ›´æ–°ï¼Œåˆ·æ–°çœ‹æ¿...');
                loadState();
            };

            eventSource.onerror = function(error) {
                console.error('SSE è¿æ¥é”™è¯¯:', error);
                // 5ç§’åé‡è¿
                setTimeout(() => {
                    console.log('ğŸ”„ é‡æ–°è¿æ¥ SSE...');
                    connectSSE();
                }, 5000);
            };

            console.log('âœ… SSE å·²è¿æ¥ï¼Œå®æ—¶æ›´æ–°å·²å¯ç”¨');
        }

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                           now.getMinutes().toString().padStart(2, '0');
            const pulseEl = document.querySelector('.pulse');
            if (pulseEl) {
                pulseEl.textContent = timeStr;
            }
        }

        // åˆå§‹åŠ è½½
        loadState();

        // è¿æ¥ SSEï¼ˆå¦‚æœæœåŠ¡å™¨è¿è¡Œä¸­ï¼‰
        try {
            connectSSE();
        } catch (e) {
            console.log('âš ï¸ SSE è¿æ¥å¤±è´¥ï¼Œå¯èƒ½æœåŠ¡å™¨æœªå¯åŠ¨');
            // é™çº§åˆ°æ¯30ç§’è½®è¯¢
            setInterval(() => {
                loadState();
                updateTime();
            }, 30000);
        }

        // æ¯ç§’æ›´æ–°æ—¶é—´æ˜¾ç¤º
        setInterval(updateTime, 1000);
    </script>
</body>
</html>
