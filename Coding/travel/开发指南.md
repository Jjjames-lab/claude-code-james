# AI旅行顾问 - 开发指南

## 快速开始

### 1. 安装依赖

```bash
# 安装所有依赖（根目录 + 前端 + 后端）
npm run install:all

# 或者分别安装
cd frontend && npm install
cd ../backend && npm install
```

### 2. 配置环境变量

在 `backend` 目录下创建 `.env` 文件：

```bash
cd backend
cp .env.example .env
```

编辑 `.env` 文件，填入你的 Anthropic API Key：

```
PORT=3001
ANTHROPIC_API_KEY=your_actual_api_key_here
CORS_ORIGIN=http://localhost:3000
```

### 3. 启动项目

**方式一：同时启动前后端（推荐）**

```bash
npm run dev
```

**方式二：分别启动**

终端1 - 启动后端：
```bash
npm run dev:backend
# 或
cd backend && npm run dev
```

终端2 - 启动前端：
```bash
npm run dev:frontend
# 或
cd frontend && npm start
```

### 4. 访问应用

- 前端：http://localhost:3000
- 后端：http://localhost:3001
- 健康检查：http://localhost:3001/health

---

## 项目结构

```
travel/
├── frontend/                 # React前端
│   ├── src/
│   │   ├── components/      # 组件
│   │   │   ├── ChatWindow.jsx   # 聊天窗口
│   │   │   └── Sidebar.jsx      # 信息侧边栏
│   │   ├── context/         # React Context
│   │   │   └── ChatContext.js  # 聊天状态管理
│   │   ├── services/        # API服务
│   │   │   └── api.js          # 后端API调用
│   │   ├── App.js           # 主应用
│   │   └── index.js         # 入口文件
│   ├── package.json
│   └── tailwind.config.js
│
├── backend/                 # Node.js后端
│   ├── src/
│   │   ├── config/          # 配置
│   │   │   └── config.js
│   │   ├── controllers/     # 控制器
│   │   │   └── chatController.js
│   │   ├── routes/          # 路由
│   │   │   └── chat.js
│   │   └── services/        # 服务层
│   │       └── claudeService.js  # Claude API集成
│   ├── server.js            # 服务器入口
│   ├── .env.example         # 环境变量模板
│   └── package.json
│
└── README.md
```

---

## 技术栈

### 前端
- **React 18**: UI框架
- **Tailwind CSS**: 样式框架
- **Axios**: HTTP客户端
- **React Context**: 状态管理

### 后端
- **Node.js**: 运行时
- **Express**: Web框架
- **Anthropic SDK**: Claude API集成
- **CORS**: 跨域支持

---

## API接口

### POST /api/chat
发送聊天消息

**请求**:
```json
{
  "message": "我想去越南玩7天",
  "collectedInfo": {
    "destination": "越南",
    "origin": "北京",
    "duration": null,
    "departureDate": null,
    "travelers": null,
    "budget": null,
    "preferences": []
  },
  "conversationHistory": []
}
```

**响应**:
```json
{
  "reply": "太好了！越南是个很美的国家...",
  "extractedInfo": {
    "duration": "7天"
  },
  "conversationHistory": [...]
}
```

### POST /api/chat/reset
重置对话

**响应**:
```json
{
  "message": "对话已重置",
  "initialState": {...}
}
```

---

## 开发注意事项

### 1. AI人设的一致性

修改 `backend/src/services/claudeService.js` 中的 `SYSTEM_PROMPT` 来调整AI的人设和说话风格。

### 2. 前端状态管理

当前使用 React Context 进行状态管理，如果状态变复杂，可以考虑：
- Redux Toolkit
- Zustand
- Recoil

### 3. 信息提取逻辑

当前的信息提取使用简单的关键词匹配，位于 `extractInfoFromMessage` 函数。

后续优化方向：
- 使用AI提取（让Claude返回结构化数据）
- 使用正则表达式优化
- 使用NLP库

---

## 常见问题

### Q: 前端无法连接后端？
A: 检查以下几点：
1. 后端是否正常运行（访问 http://localhost:3001/health）
2. `.env` 文件中的 CORS_ORIGIN 是否正确
3. 前端 `src/services/api.js` 中的 API_BASE_URL 是否正确

### Q: Claude API调用失败？
A: 检查：
1. API Key是否正确
2. 是否有足够的配额
3. 网络连接是否正常

### Q: 前端样式不生效？
A: 确保安装了所有依赖：
```bash
cd frontend
npm install
```

---

## 下一步计划

- [ ] Phase 2: 优化对话能力和信息提取
- [ ] Phase 3: 添加数据爬虫和知识库
- [ ] Phase 4: 实现行程生成引擎
- [ ] Phase 5: UI/UX优化和测试

---

## 贡献指南

1. Fork项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启Pull Request

---

## 许可证

ISC
