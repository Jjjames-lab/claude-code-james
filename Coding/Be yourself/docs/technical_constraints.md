---
version: "1.0"
date: "2026-01-29"
last_updated: "2026-01-29"
updates:
  - date: "2026-01-29"
    note: "初版，从对话中提炼"
---

# 技术约束 | Technical Constraints

> 本文档描述产品的技术限制、成本考量和实现约束

---

## 核心约束

### 1. 前端限制

**当前形态**：单页HTML（demo阶段）

**约束**：
- 无后端存储（仅localStorage）
- 无实时同步
- 无用户系统
- 刷新后数据保留（localStorage）

**影响**：
- 无法实现多设备同步
- 无法实现长期记忆（重启后丢失）
- 依赖浏览器存储

### 2. 记忆成本

**用户关注**：
> "如果所有都记忆，可能会需要大量的tokens吧...从技术角度，这个记忆能力蛮难的吧"

**解决方案**：记忆分层

| 层级 | 内容 | 存储方式 | 成本 |
|------|------|----------|------|
| 用户画像 | 目标、底线、特征 | 结构化KV（localStorage） | 低 |
| 关键模式 | "面对冲突倾向于内省" | 压缩摘要 | 低 |
| 重要事件 | "1月22日提到同事XX" | 向量索引（简化版） | 中 |
| 对话历史 | 最近N轮对话 | 滑动窗口 | 中 |
| 原始细节 | 所有内容 | 不存储 | - |

### 3. AI调用成本

**约束**：
- 当前无真实AI API（demo阶段）
- 使用预设响应模板
- 未来集成需考虑成本

**成本控制策略**：
- 记忆分层减少token
- 只在必要时调用AI
- 缓存常见响应
- 用户可配置AI调用频率

---

## 记忆系统设计

### 设计目标

用户期望：
> "我所有的表达能够被记录下来...你得判断下...如果不全记忆或想不起来我们之前聊的内容，又会很不智能"

**平衡点**：记住对的，用对的时候想起来

### 记忆激活机制

```
用户说："我那个同事..."
→ 检索用户画像（你是产品经理）
→ 检索中短期记忆（最近提到过XX同事）
→ 检索模式（你之前提到过不善面对冲突）
→ 生成回应："你说的是那个让你内耗的同事吗？"
```

### 存储方案（未来实现）

#### 用户画像层（必须记住）

```json
{
  "name": "James",
  "role": "产品经理",
  "traits": ["视觉敏感", "碎片学习", "内省型"],
  "long_term_goal": null,
  "short_term_goal": null,
  "bottom_line": null,
  "communication_style": "发散、跳跃"
}
```

#### 关键模式层（压缩摘要）

```
当用户说"内耗"时，提取模式：
- 触发场景：做决定前、发东西前、看到别人做得好
- 应对方式：倾向于回避
- 情绪特征：高敏感

存储为摘要，不存储原始对话
```

#### 重要事件层（向量索引）

```
事件：
- 日期：2026-01-22
- 类型：内耗记录
- 关键词：视频剪辑、学习障碍、自我怀疑
- 摘要：用户说想学视频剪辑但觉得自己学不会

未来可通过关键词检索唤醒
```

#### 对话历史层（滑动窗口）

```
保留最近10轮对话（约2000 tokens）
用于理解当前对话上下文
```

---

## 前端架构（demo阶段）

### 当前技术栈

| 层级 | 技术 | 备注 |
|------|------|------|
| 结构 | 单HTML文件 | 无构建工具 |
| 样式 | CSS-in-HTML | 原子化设计 |
| 交互 | 原生JavaScript | 无框架 |
| 存储 | localStorage | 持久化 |
| 部署 | 直接打开 | 无服务器 |

### 模块划分

```
index.html
├── CSS (设计系统)
├── HTML结构 (三栏布局)
└── JS逻辑
    ├── 状态管理
    ├── 对话系统
    ├── 记忆系统
    └── UI交互
```

---

## 设计权衡

### 1. 记忆 vs 成本

| 选择 | 优点 | 缺点 |
|------|------|------|
| 全量记忆 | 绝对智能 | 成本高、隐私风险 |
| 全不记忆 | 成本低 | 不智能、重复问 |
| 分层记忆（当前） | 平衡 | 实现复杂 |

### 2. 主动 vs 被动

| 选择 | 优点 | 缺点 |
|------|------|------|
| 主动推荐 | 更有价值 | 可能打扰 |
| 完全被动 | 不打扰 | 不够智能 |
| 被动优先（当前） | 平衡 | 需要判断时机 |

### 3. 统一 vs 多角色

| 选择 | 优点 | 缺点 |
|------|------|------|
| 多角色 | 角度丰富 | 用户感到分裂 |
| 统一伙伴 | 统一体验 | 角度可能不够 |

---

## 待解决问题

### 1. 记忆持久化

**问题**：localStorage有限制，换浏览器丢失

**方案**：
- A. 导出导入JSON
- B. 云端存储（需用户系统）
- C. 接受当前限制（demo阶段）

### 2. 多设备同步

**问题**：无法在手机和电脑之间同步

**方案**：
- A. 暂时不做（demo阶段）
- B. 导出导入
- C. 未来加用户系统

### 3. 长期记忆

**问题**：超过滑动窗口后遗忘

**方案**：
- A. 定期摘要压缩
- B. 只保留关键事件
- C. 接受遗忘（更真实？）

---

## 参考资料

> Tolan产品深度调研.pdf - 参考其记忆系统设计
> iterations/v0.md - 初始需求记录

---

*文档版本：1.0*
*最后更新：2026-01-29*
*基于对话：2026-01-29 James与Claude的产品讨论*
